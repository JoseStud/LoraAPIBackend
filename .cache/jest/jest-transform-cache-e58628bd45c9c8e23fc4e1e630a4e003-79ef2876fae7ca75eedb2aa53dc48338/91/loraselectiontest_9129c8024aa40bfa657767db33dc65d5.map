{"version":3,"names":["fs","require","path","global","TextEncoder","TextDecoder","templatePath","resolve","__dirname","template","readFileSync","fnMatch","match","loraGalleryFnSource","Error","JSDOM","setupDom","dom","runScripts","document","window","HTMLElement","beforeEach","test","vm","Function","loraGallery","$watch","init","expect","Array","isArray","selectedLoras","toBe","selectEvent","CustomEvent","detail","id","dispatchEvent","includes","deselectEvent"],"sources":["lora-selection.test.js"],"sourcesContent":["/**\n * Unit test for lora selection event mapping\n */\n\n/** @jest-environment jsdom */\n\nconst fs = require('fs');\nconst path = require('path');\n// Polyfill TextEncoder/TextDecoder for jsdom in some Node versions\nif (typeof global.TextEncoder === 'undefined') {\n  const { TextEncoder, TextDecoder } = require('util');\n  global.TextEncoder = TextEncoder;\n  global.TextDecoder = TextDecoder;\n}\n\n// Load loraGallery implementation from template file (extract function body)\nconst templatePath = path.resolve(__dirname, '../../app/frontend/templates/pages/loras.html');\nconst template = fs.readFileSync(templatePath, 'utf8');\n\n// Extract the loraGallery function definition from the template\nconst fnMatch = template.match(/function loraGallery\\s*\\(\\)\\s*\\{([\\s\\S]*?)\\n\\}\\n/);\nlet loraGalleryFnSource = null;\nif (fnMatch) {\n  loraGalleryFnSource = fnMatch[0];\n} else {\n  throw new Error('Could not extract loraGallery function from template');\n}\n\n// Create a sandboxed function and evaluate it\nconst { JSDOM } = require('jsdom');\n\nfunction setupDom() {\n  const dom = new JSDOM(`<!doctype html><html><body><div id=\"lora-root\"></div></body></html>`, { runScripts: 'outside-only' });\n  global.document = dom.window.document;\n  global.window = dom.window;\n  global.HTMLElement = dom.window.HTMLElement;\n}\n\nbeforeEach(() => {\n  setupDom();\n});\n\ntest('loraGallery updates selectedLoras on lora-selected / lora-deselected events', () => {\n  // Evaluate the function in the JSDOM window context\n  const vm = new Function('window', 'document', `${loraGalleryFnSource}; return loraGallery;`);\n  const loraGallery = vm(global.window, global.document)();\n  // Provide minimal Alpine stubs used by the component (e.g., $watch)\n  loraGallery.$watch = function() {};\n  if (typeof loraGallery.init === 'function') loraGallery.init();\n\n  // Attach to a dummy element to emulate Alpine.$data semantics (not needed here)\n  expect(Array.isArray(loraGallery.selectedLoras)).toBe(true);\n\n  // Dispatch lora-selected event\n  const selectEvent = new global.window.CustomEvent('lora-selected', { detail: { id: 'abc-1' } });\n  global.window.document.dispatchEvent(selectEvent);\n  // Allow any synchronous handlers to run\n  expect(loraGallery.selectedLoras.includes('abc-1')).toBe(true);\n\n  // Dispatch lora-deselected\n  const deselectEvent = new global.window.CustomEvent('lora-deselected', { detail: { id: 'abc-1' } });\n  global.window.document.dispatchEvent(deselectEvent);\n  expect(loraGallery.selectedLoras.includes('abc-1')).toBe(false);\n});\n"],"mappings":"AAAA;AACA;AACA;;AAEA;;AAEA,MAAMA,EAAE,GAAGC,OAAO,CAAC,IAAI,CAAC;AACxB,MAAMC,IAAI,GAAGD,OAAO,CAAC,MAAM,CAAC;AAC5B;AACA,IAAI,OAAOE,MAAM,CAACC,WAAW,KAAK,WAAW,EAAE;EAC7C,MAAM;IAAEA,WAAW;IAAEC;EAAY,CAAC,GAAGJ,OAAO,CAAC,MAAM,CAAC;EACpDE,MAAM,CAACC,WAAW,GAAGA,WAAW;EAChCD,MAAM,CAACE,WAAW,GAAGA,WAAW;AAClC;;AAEA;AACA,MAAMC,YAAY,GAAGJ,IAAI,CAACK,OAAO,CAACC,SAAS,EAAE,+CAA+C,CAAC;AAC7F,MAAMC,QAAQ,GAAGT,EAAE,CAACU,YAAY,CAACJ,YAAY,EAAE,MAAM,CAAC;;AAEtD;AACA,MAAMK,OAAO,GAAGF,QAAQ,CAACG,KAAK,CAAC,kDAAkD,CAAC;AAClF,IAAIC,mBAAmB,GAAG,IAAI;AAC9B,IAAIF,OAAO,EAAE;EACXE,mBAAmB,GAAGF,OAAO,CAAC,CAAC,CAAC;AAClC,CAAC,MAAM;EACL,MAAM,IAAIG,KAAK,CAAC,sDAAsD,CAAC;AACzE;;AAEA;AACA,MAAM;EAAEC;AAAM,CAAC,GAAGd,OAAO,CAAC,OAAO,CAAC;AAElC,SAASe,QAAQA,CAAA,EAAG;EAClB,MAAMC,GAAG,GAAG,IAAIF,KAAK,CAAC,qEAAqE,EAAE;IAAEG,UAAU,EAAE;EAAe,CAAC,CAAC;EAC5Hf,MAAM,CAACgB,QAAQ,GAAGF,GAAG,CAACG,MAAM,CAACD,QAAQ;EACrChB,MAAM,CAACiB,MAAM,GAAGH,GAAG,CAACG,MAAM;EAC1BjB,MAAM,CAACkB,WAAW,GAAGJ,GAAG,CAACG,MAAM,CAACC,WAAW;AAC7C;AAEAC,UAAU,CAAC,MAAM;EACfN,QAAQ,CAAC,CAAC;AACZ,CAAC,CAAC;AAEFO,IAAI,CAAC,6EAA6E,EAAE,MAAM;EACxF;EACA,MAAMC,EAAE,GAAG,IAAIC,QAAQ,CAAC,QAAQ,EAAE,UAAU,EAAE,GAAGZ,mBAAmB,uBAAuB,CAAC;EAC5F,MAAMa,WAAW,GAAGF,EAAE,CAACrB,MAAM,CAACiB,MAAM,EAAEjB,MAAM,CAACgB,QAAQ,CAAC,CAAC,CAAC;EACxD;EACAO,WAAW,CAACC,MAAM,GAAG,YAAW,CAAC,CAAC;EAClC,IAAI,OAAOD,WAAW,CAACE,IAAI,KAAK,UAAU,EAAEF,WAAW,CAACE,IAAI,CAAC,CAAC;;EAE9D;EACAC,MAAM,CAACC,KAAK,CAACC,OAAO,CAACL,WAAW,CAACM,aAAa,CAAC,CAAC,CAACC,IAAI,CAAC,IAAI,CAAC;;EAE3D;EACA,MAAMC,WAAW,GAAG,IAAI/B,MAAM,CAACiB,MAAM,CAACe,WAAW,CAAC,eAAe,EAAE;IAAEC,MAAM,EAAE;MAAEC,EAAE,EAAE;IAAQ;EAAE,CAAC,CAAC;EAC/FlC,MAAM,CAACiB,MAAM,CAACD,QAAQ,CAACmB,aAAa,CAACJ,WAAW,CAAC;EACjD;EACAL,MAAM,CAACH,WAAW,CAACM,aAAa,CAACO,QAAQ,CAAC,OAAO,CAAC,CAAC,CAACN,IAAI,CAAC,IAAI,CAAC;;EAE9D;EACA,MAAMO,aAAa,GAAG,IAAIrC,MAAM,CAACiB,MAAM,CAACe,WAAW,CAAC,iBAAiB,EAAE;IAAEC,MAAM,EAAE;MAAEC,EAAE,EAAE;IAAQ;EAAE,CAAC,CAAC;EACnGlC,MAAM,CAACiB,MAAM,CAACD,QAAQ,CAACmB,aAAa,CAACE,aAAa,CAAC;EACnDX,MAAM,CAACH,WAAW,CAACM,aAAa,CAACO,QAAQ,CAAC,OAAO,CAAC,CAAC,CAACN,IAAI,CAAC,KAAK,CAAC;AACjE,CAAC,CAAC","ignoreList":[]}