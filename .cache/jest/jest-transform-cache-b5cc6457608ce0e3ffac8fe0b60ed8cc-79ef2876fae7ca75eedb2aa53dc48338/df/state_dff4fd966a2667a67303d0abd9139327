401a0fe6ea35e4ac8bba32eee23a2793
/**
 * Generation Studio - State Management Module
 * 
 * Handles state initialization and management for the generation studio component.
 */

/**
 * Creates and manages state for the generation studio
 */
const generationState = {
  /**
   * Creates initial state
   */
  createInitialState() {
    return {
      // Generation Parameters
      params: {
        prompt: '',
        negative_prompt: '',
        width: 512,
        height: 512,
        steps: 20,
        cfg_scale: 7.0,
        seed: -1,
        batch_count: 1,
        batch_size: 1
      },
      // Core State
      activeJobs: [],
      recentResults: [],
      systemStatus: {},
      // UI State
      isGenerating: false,
      showHistory: false,
      showModal: false,
      selectedResult: null,
      showToast: false,
      toastMessage: '',
      // Network State
      websocket: null,
      pollInterval: null,
      isConnected: false,
      // Configuration
      config: {
        pollIntervalMs: 2000,
        maxRecentResults: 50,
        toastDuration: 3000,
        maxRetries: 3
      }
    };
  },
  /**
   * Updates generation parameters
   */
  updateParams(state, newParams) {
    const validParams = this.validateParams(newParams);
    state.params = {
      ...state.params,
      ...validParams
    };
    return state;
  },
  /**
   * Validates generation parameters
   */
  validateParams(params) {
    const validated = {};
    if (params.prompt !== undefined) {
      validated.prompt = String(params.prompt).trim();
    }
    if (params.negative_prompt !== undefined) {
      validated.negative_prompt = String(params.negative_prompt).trim();
    }
    if (params.width !== undefined) {
      const width = Number(params.width);
      validated.width = width >= 64 && width <= 2048 ? width : 512;
    }
    if (params.height !== undefined) {
      const height = Number(params.height);
      validated.height = height >= 64 && height <= 2048 ? height : 512;
    }
    if (params.steps !== undefined) {
      const steps = Number(params.steps);
      validated.steps = steps >= 1 && steps <= 150 ? steps : 20;
    }
    if (params.cfg_scale !== undefined) {
      const cfg = Number(params.cfg_scale);
      validated.cfg_scale = cfg >= 1 && cfg <= 30 ? cfg : 7.0;
    }
    if (params.seed !== undefined) {
      const seed = Number(params.seed);
      validated.seed = Number.isInteger(seed) ? seed : -1;
    }
    if (params.batch_count !== undefined) {
      const count = Number(params.batch_count);
      validated.batch_count = count >= 1 && count <= 10 ? count : 1;
    }
    if (params.batch_size !== undefined) {
      const size = Number(params.batch_size);
      validated.batch_size = size >= 1 && size <= 4 ? size : 1;
    }
    return validated;
  },
  /**
   * Adds a new job to active jobs
   */
  addActiveJob(state, jobData) {
    const newJob = {
      id: jobData.id || Date.now().toString(),
      prompt: jobData.prompt || state.params.prompt,
      negative_prompt: jobData.negative_prompt || state.params.negative_prompt,
      width: jobData.width || state.params.width,
      height: jobData.height || state.params.height,
      steps: jobData.steps || state.params.steps,
      cfg_scale: jobData.cfg_scale || state.params.cfg_scale,
      seed: jobData.seed || state.params.seed,
      batch_count: jobData.batch_count || state.params.batch_count,
      batch_size: jobData.batch_size || state.params.batch_size,
      status: jobData.status || 'queued',
      progress: jobData.progress || 0,
      current_step: 0,
      total_steps: jobData.steps || state.params.steps,
      created_at: jobData.created_at || new Date().toISOString(),
      start_time: null,
      eta: null
    };
    state.activeJobs.unshift(newJob);
    return newJob;
  },
  /**
   * Updates an active job
   */
  updateActiveJob(state, jobId, updates) {
    const jobIndex = state.activeJobs.findIndex(job => job.id === jobId);
    if (jobIndex !== -1) {
      state.activeJobs[jobIndex] = {
        ...state.activeJobs[jobIndex],
        ...updates
      };
      return state.activeJobs[jobIndex];
    }
    return null;
  },
  /**
   * Removes a job from active jobs
   */
  removeActiveJob(state, jobId) {
    const initialLength = state.activeJobs.length;
    state.activeJobs = state.activeJobs.filter(job => job.id !== jobId);
    return state.activeJobs.length !== initialLength;
  },
  /**
   * Adds a result to recent results
   */
  addRecentResult(state, resultData) {
    const newResult = {
      id: resultData.id || Date.now().toString(),
      job_id: resultData.job_id,
      prompt: resultData.prompt,
      negative_prompt: resultData.negative_prompt,
      image_url: resultData.image_url,
      thumbnail_url: resultData.thumbnail_url,
      width: resultData.width,
      height: resultData.height,
      steps: resultData.steps,
      cfg_scale: resultData.cfg_scale,
      seed: resultData.seed,
      batch_count: resultData.batch_count,
      batch_size: resultData.batch_size,
      created_at: resultData.created_at || new Date().toISOString(),
      file_size: resultData.file_size,
      generation_time: resultData.generation_time,
      model_used: resultData.model_used
    };
    state.recentResults.unshift(newResult);

    // Limit the number of results kept in memory
    const maxResults = state.showHistory ? state.config.maxRecentResults : 10;
    if (state.recentResults.length > maxResults) {
      state.recentResults = state.recentResults.slice(0, maxResults);
    }
    return newResult;
  },
  /**
   * Removes a result from recent results
   */
  removeRecentResult(state, resultId) {
    const initialLength = state.recentResults.length;
    state.recentResults = state.recentResults.filter(result => result.id !== resultId);
    return state.recentResults.length !== initialLength;
  },
  /**
   * Updates system status
   */
  updateSystemStatus(state, statusData) {
    state.systemStatus = {
      ...state.systemStatus,
      ...statusData,
      last_updated: Date.now()
    };
    return state.systemStatus;
  },
  /**
   * Sets generation status
   */
  setGenerationStatus(state, isGenerating) {
    state.isGenerating = Boolean(isGenerating);
    return state.isGenerating;
  },
  /**
   * Sets connection status
   */
  setConnectionStatus(state, isConnected) {
    state.isConnected = Boolean(isConnected);
    return state.isConnected;
  },
  /**
   * Shows toast notification
   */
  showToast(state, message, type = 'success') {
    state.toastMessage = String(message);
    state.showToast = true;

    // Auto-hide after configured duration
    setTimeout(() => {
      state.showToast = false;
      state.toastMessage = '';
    }, state.config.toastDuration);
    return {
      message,
      type
    };
  },
  /**
   * Hides toast notification
   */
  hideToast(state) {
    state.showToast = false;
    state.toastMessage = '';
    return state;
  },
  /**
   * Shows result modal
   */
  showResultModal(state, result) {
    state.selectedResult = result;
    state.showModal = true;
    return state;
  },
  /**
   * Hides result modal
   */
  hideResultModal(state) {
    state.selectedResult = null;
    state.showModal = false;
    return state;
  },
  /**
   * Toggles history view
   */
  toggleHistory(state) {
    state.showHistory = !state.showHistory;
    return state.showHistory;
  },
  /**
   * Gets job by ID
   */
  getJobById(state, jobId) {
    return state.activeJobs.find(job => job.id === jobId) || null;
  },
  /**
   * Gets result by ID
   */
  getResultById(state, resultId) {
    return state.recentResults.find(result => result.id === resultId) || null;
  },
  /**
   * Gets generation statistics
   */
  getStatistics(state) {
    const totalJobs = state.activeJobs.length;
    const processingJobs = state.activeJobs.filter(job => job.status === 'processing').length;
    const queuedJobs = state.activeJobs.filter(job => job.status === 'queued').length;
    const completedToday = state.recentResults.filter(result => {
      const today = new Date().toDateString();
      const resultDate = new Date(result.created_at).toDateString();
      return today === resultDate;
    }).length;
    return {
      totalActiveJobs: totalJobs,
      processingJobs,
      queuedJobs,
      completedToday,
      totalResults: state.recentResults.length,
      isSystemHealthy: this.isSystemHealthy(state),
      averageGenerationTime: this.calculateAverageGenerationTime(state)
    };
  },
  /**
   * Checks if system is healthy
   */
  isSystemHealthy(state) {
    const now = Date.now();
    const lastUpdate = state.systemStatus.last_updated || 0;
    const timeSinceUpdate = now - lastUpdate;

    // Consider system healthy if:
    // - Last update was within 30 seconds
    // - No stuck jobs (processing for more than 10 minutes)
    // - Connection is active

    const isRecent = timeSinceUpdate < 30000;
    const hasStuckJobs = state.activeJobs.some(job => {
      if (job.status === 'processing' && job.start_time) {
        const processingTime = now - job.start_time;
        return processingTime > 600000; // 10 minutes
      }
      return false;
    });
    return isRecent && !hasStuckJobs && state.isConnected;
  },
  /**
   * Calculates average generation time
   */
  calculateAverageGenerationTime(state) {
    const resultsWithTime = state.recentResults.filter(result => result.generation_time);
    if (resultsWithTime.length === 0) return 0;
    const totalTime = resultsWithTime.reduce((sum, result) => sum + result.generation_time, 0);
    return totalTime / resultsWithTime.length;
  },
  /**
   * Clears all state (for cleanup)
   */
  clearState(state) {
    Object.assign(state, this.createInitialState());
    return state;
  },
  /**
   * Exports state for persistence
   */
  exportState(state) {
    return {
      params: state.params,
      recentResults: state.recentResults.slice(0, 10),
      // Only export recent 10
      config: state.config,
      timestamp: Date.now()
    };
  },
  /**
   * Imports state from persistence
   */
  importState(state, importedData) {
    if (importedData.params) {
      state.params = {
        ...state.params,
        ...this.validateParams(importedData.params)
      };
    }
    if (Array.isArray(importedData.recentResults)) {
      state.recentResults = importedData.recentResults;
    }
    if (importedData.config) {
      state.config = {
        ...state.config,
        ...importedData.config
      };
    }
    return state;
  }
};

// Export for use in other modules
if (typeof module !== 'undefined' && module.exports) {
  module.exports = {
    generationState
  };
} else if (typeof window !== 'undefined') {
  window.generationState = generationState;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJnZW5lcmF0aW9uU3RhdGUiLCJjcmVhdGVJbml0aWFsU3RhdGUiLCJwYXJhbXMiLCJwcm9tcHQiLCJuZWdhdGl2ZV9wcm9tcHQiLCJ3aWR0aCIsImhlaWdodCIsInN0ZXBzIiwiY2ZnX3NjYWxlIiwic2VlZCIsImJhdGNoX2NvdW50IiwiYmF0Y2hfc2l6ZSIsImFjdGl2ZUpvYnMiLCJyZWNlbnRSZXN1bHRzIiwic3lzdGVtU3RhdHVzIiwiaXNHZW5lcmF0aW5nIiwic2hvd0hpc3RvcnkiLCJzaG93TW9kYWwiLCJzZWxlY3RlZFJlc3VsdCIsInNob3dUb2FzdCIsInRvYXN0TWVzc2FnZSIsIndlYnNvY2tldCIsInBvbGxJbnRlcnZhbCIsImlzQ29ubmVjdGVkIiwiY29uZmlnIiwicG9sbEludGVydmFsTXMiLCJtYXhSZWNlbnRSZXN1bHRzIiwidG9hc3REdXJhdGlvbiIsIm1heFJldHJpZXMiLCJ1cGRhdGVQYXJhbXMiLCJzdGF0ZSIsIm5ld1BhcmFtcyIsInZhbGlkUGFyYW1zIiwidmFsaWRhdGVQYXJhbXMiLCJ2YWxpZGF0ZWQiLCJ1bmRlZmluZWQiLCJTdHJpbmciLCJ0cmltIiwiTnVtYmVyIiwiY2ZnIiwiaXNJbnRlZ2VyIiwiY291bnQiLCJzaXplIiwiYWRkQWN0aXZlSm9iIiwiam9iRGF0YSIsIm5ld0pvYiIsImlkIiwiRGF0ZSIsIm5vdyIsInRvU3RyaW5nIiwic3RhdHVzIiwicHJvZ3Jlc3MiLCJjdXJyZW50X3N0ZXAiLCJ0b3RhbF9zdGVwcyIsImNyZWF0ZWRfYXQiLCJ0b0lTT1N0cmluZyIsInN0YXJ0X3RpbWUiLCJldGEiLCJ1bnNoaWZ0IiwidXBkYXRlQWN0aXZlSm9iIiwiam9iSWQiLCJ1cGRhdGVzIiwiam9iSW5kZXgiLCJmaW5kSW5kZXgiLCJqb2IiLCJyZW1vdmVBY3RpdmVKb2IiLCJpbml0aWFsTGVuZ3RoIiwibGVuZ3RoIiwiZmlsdGVyIiwiYWRkUmVjZW50UmVzdWx0IiwicmVzdWx0RGF0YSIsIm5ld1Jlc3VsdCIsImpvYl9pZCIsImltYWdlX3VybCIsInRodW1ibmFpbF91cmwiLCJmaWxlX3NpemUiLCJnZW5lcmF0aW9uX3RpbWUiLCJtb2RlbF91c2VkIiwibWF4UmVzdWx0cyIsInNsaWNlIiwicmVtb3ZlUmVjZW50UmVzdWx0IiwicmVzdWx0SWQiLCJyZXN1bHQiLCJ1cGRhdGVTeXN0ZW1TdGF0dXMiLCJzdGF0dXNEYXRhIiwibGFzdF91cGRhdGVkIiwic2V0R2VuZXJhdGlvblN0YXR1cyIsIkJvb2xlYW4iLCJzZXRDb25uZWN0aW9uU3RhdHVzIiwibWVzc2FnZSIsInR5cGUiLCJzZXRUaW1lb3V0IiwiaGlkZVRvYXN0Iiwic2hvd1Jlc3VsdE1vZGFsIiwiaGlkZVJlc3VsdE1vZGFsIiwidG9nZ2xlSGlzdG9yeSIsImdldEpvYkJ5SWQiLCJmaW5kIiwiZ2V0UmVzdWx0QnlJZCIsImdldFN0YXRpc3RpY3MiLCJ0b3RhbEpvYnMiLCJwcm9jZXNzaW5nSm9icyIsInF1ZXVlZEpvYnMiLCJjb21wbGV0ZWRUb2RheSIsInRvZGF5IiwidG9EYXRlU3RyaW5nIiwicmVzdWx0RGF0ZSIsInRvdGFsQWN0aXZlSm9icyIsInRvdGFsUmVzdWx0cyIsImlzU3lzdGVtSGVhbHRoeSIsImF2ZXJhZ2VHZW5lcmF0aW9uVGltZSIsImNhbGN1bGF0ZUF2ZXJhZ2VHZW5lcmF0aW9uVGltZSIsImxhc3RVcGRhdGUiLCJ0aW1lU2luY2VVcGRhdGUiLCJpc1JlY2VudCIsImhhc1N0dWNrSm9icyIsInNvbWUiLCJwcm9jZXNzaW5nVGltZSIsInJlc3VsdHNXaXRoVGltZSIsInRvdGFsVGltZSIsInJlZHVjZSIsInN1bSIsImNsZWFyU3RhdGUiLCJPYmplY3QiLCJhc3NpZ24iLCJleHBvcnRTdGF0ZSIsInRpbWVzdGFtcCIsImltcG9ydFN0YXRlIiwiaW1wb3J0ZWREYXRhIiwiQXJyYXkiLCJpc0FycmF5IiwibW9kdWxlIiwiZXhwb3J0cyIsIndpbmRvdyJdLCJzb3VyY2VzIjpbInN0YXRlLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogR2VuZXJhdGlvbiBTdHVkaW8gLSBTdGF0ZSBNYW5hZ2VtZW50IE1vZHVsZVxuICogXG4gKiBIYW5kbGVzIHN0YXRlIGluaXRpYWxpemF0aW9uIGFuZCBtYW5hZ2VtZW50IGZvciB0aGUgZ2VuZXJhdGlvbiBzdHVkaW8gY29tcG9uZW50LlxuICovXG5cbi8qKlxuICogQ3JlYXRlcyBhbmQgbWFuYWdlcyBzdGF0ZSBmb3IgdGhlIGdlbmVyYXRpb24gc3R1ZGlvXG4gKi9cbmNvbnN0IGdlbmVyYXRpb25TdGF0ZSA9IHtcbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGluaXRpYWwgc3RhdGVcbiAgICAgKi9cbiAgICBjcmVhdGVJbml0aWFsU3RhdGUoKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAvLyBHZW5lcmF0aW9uIFBhcmFtZXRlcnNcbiAgICAgICAgICAgIHBhcmFtczoge1xuICAgICAgICAgICAgICAgIHByb21wdDogJycsXG4gICAgICAgICAgICAgICAgbmVnYXRpdmVfcHJvbXB0OiAnJyxcbiAgICAgICAgICAgICAgICB3aWR0aDogNTEyLFxuICAgICAgICAgICAgICAgIGhlaWdodDogNTEyLFxuICAgICAgICAgICAgICAgIHN0ZXBzOiAyMCxcbiAgICAgICAgICAgICAgICBjZmdfc2NhbGU6IDcuMCxcbiAgICAgICAgICAgICAgICBzZWVkOiAtMSxcbiAgICAgICAgICAgICAgICBiYXRjaF9jb3VudDogMSxcbiAgICAgICAgICAgICAgICBiYXRjaF9zaXplOiAxXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyBDb3JlIFN0YXRlXG4gICAgICAgICAgICBhY3RpdmVKb2JzOiBbXSxcbiAgICAgICAgICAgIHJlY2VudFJlc3VsdHM6IFtdLFxuICAgICAgICAgICAgc3lzdGVtU3RhdHVzOiB7fSxcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLy8gVUkgU3RhdGVcbiAgICAgICAgICAgIGlzR2VuZXJhdGluZzogZmFsc2UsXG4gICAgICAgICAgICBzaG93SGlzdG9yeTogZmFsc2UsXG4gICAgICAgICAgICBzaG93TW9kYWw6IGZhbHNlLFxuICAgICAgICAgICAgc2VsZWN0ZWRSZXN1bHQ6IG51bGwsXG4gICAgICAgICAgICBzaG93VG9hc3Q6IGZhbHNlLFxuICAgICAgICAgICAgdG9hc3RNZXNzYWdlOiAnJyxcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLy8gTmV0d29yayBTdGF0ZVxuICAgICAgICAgICAgd2Vic29ja2V0OiBudWxsLFxuICAgICAgICAgICAgcG9sbEludGVydmFsOiBudWxsLFxuICAgICAgICAgICAgaXNDb25uZWN0ZWQ6IGZhbHNlLFxuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyBDb25maWd1cmF0aW9uXG4gICAgICAgICAgICBjb25maWc6IHtcbiAgICAgICAgICAgICAgICBwb2xsSW50ZXJ2YWxNczogMjAwMCxcbiAgICAgICAgICAgICAgICBtYXhSZWNlbnRSZXN1bHRzOiA1MCxcbiAgICAgICAgICAgICAgICB0b2FzdER1cmF0aW9uOiAzMDAwLFxuICAgICAgICAgICAgICAgIG1heFJldHJpZXM6IDNcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9LFxuICAgIFxuICAgIC8qKlxuICAgICAqIFVwZGF0ZXMgZ2VuZXJhdGlvbiBwYXJhbWV0ZXJzXG4gICAgICovXG4gICAgdXBkYXRlUGFyYW1zKHN0YXRlLCBuZXdQYXJhbXMpIHtcbiAgICAgICAgY29uc3QgdmFsaWRQYXJhbXMgPSB0aGlzLnZhbGlkYXRlUGFyYW1zKG5ld1BhcmFtcyk7XG4gICAgICAgIHN0YXRlLnBhcmFtcyA9IHsgLi4uc3RhdGUucGFyYW1zLCAuLi52YWxpZFBhcmFtcyB9O1xuICAgICAgICByZXR1cm4gc3RhdGU7XG4gICAgfSxcbiAgICBcbiAgICAvKipcbiAgICAgKiBWYWxpZGF0ZXMgZ2VuZXJhdGlvbiBwYXJhbWV0ZXJzXG4gICAgICovXG4gICAgdmFsaWRhdGVQYXJhbXMocGFyYW1zKSB7XG4gICAgICAgIGNvbnN0IHZhbGlkYXRlZCA9IHt9O1xuICAgICAgICBcbiAgICAgICAgaWYgKHBhcmFtcy5wcm9tcHQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdmFsaWRhdGVkLnByb21wdCA9IFN0cmluZyhwYXJhbXMucHJvbXB0KS50cmltKCk7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGlmIChwYXJhbXMubmVnYXRpdmVfcHJvbXB0ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHZhbGlkYXRlZC5uZWdhdGl2ZV9wcm9tcHQgPSBTdHJpbmcocGFyYW1zLm5lZ2F0aXZlX3Byb21wdCkudHJpbSgpO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBpZiAocGFyYW1zLndpZHRoICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIGNvbnN0IHdpZHRoID0gTnVtYmVyKHBhcmFtcy53aWR0aCk7XG4gICAgICAgICAgICB2YWxpZGF0ZWQud2lkdGggPSB3aWR0aCA+PSA2NCAmJiB3aWR0aCA8PSAyMDQ4ID8gd2lkdGggOiA1MTI7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGlmIChwYXJhbXMuaGVpZ2h0ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIGNvbnN0IGhlaWdodCA9IE51bWJlcihwYXJhbXMuaGVpZ2h0KTtcbiAgICAgICAgICAgIHZhbGlkYXRlZC5oZWlnaHQgPSBoZWlnaHQgPj0gNjQgJiYgaGVpZ2h0IDw9IDIwNDggPyBoZWlnaHQgOiA1MTI7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGlmIChwYXJhbXMuc3RlcHMgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgY29uc3Qgc3RlcHMgPSBOdW1iZXIocGFyYW1zLnN0ZXBzKTtcbiAgICAgICAgICAgIHZhbGlkYXRlZC5zdGVwcyA9IHN0ZXBzID49IDEgJiYgc3RlcHMgPD0gMTUwID8gc3RlcHMgOiAyMDtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgaWYgKHBhcmFtcy5jZmdfc2NhbGUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgY29uc3QgY2ZnID0gTnVtYmVyKHBhcmFtcy5jZmdfc2NhbGUpO1xuICAgICAgICAgICAgdmFsaWRhdGVkLmNmZ19zY2FsZSA9IGNmZyA+PSAxICYmIGNmZyA8PSAzMCA/IGNmZyA6IDcuMDtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgaWYgKHBhcmFtcy5zZWVkICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIGNvbnN0IHNlZWQgPSBOdW1iZXIocGFyYW1zLnNlZWQpO1xuICAgICAgICAgICAgdmFsaWRhdGVkLnNlZWQgPSBOdW1iZXIuaXNJbnRlZ2VyKHNlZWQpID8gc2VlZCA6IC0xO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBpZiAocGFyYW1zLmJhdGNoX2NvdW50ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIGNvbnN0IGNvdW50ID0gTnVtYmVyKHBhcmFtcy5iYXRjaF9jb3VudCk7XG4gICAgICAgICAgICB2YWxpZGF0ZWQuYmF0Y2hfY291bnQgPSBjb3VudCA+PSAxICYmIGNvdW50IDw9IDEwID8gY291bnQgOiAxO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBpZiAocGFyYW1zLmJhdGNoX3NpemUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgY29uc3Qgc2l6ZSA9IE51bWJlcihwYXJhbXMuYmF0Y2hfc2l6ZSk7XG4gICAgICAgICAgICB2YWxpZGF0ZWQuYmF0Y2hfc2l6ZSA9IHNpemUgPj0gMSAmJiBzaXplIDw9IDQgPyBzaXplIDogMTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgcmV0dXJuIHZhbGlkYXRlZDtcbiAgICB9LFxuICAgIFxuICAgIC8qKlxuICAgICAqIEFkZHMgYSBuZXcgam9iIHRvIGFjdGl2ZSBqb2JzXG4gICAgICovXG4gICAgYWRkQWN0aXZlSm9iKHN0YXRlLCBqb2JEYXRhKSB7XG4gICAgICAgIGNvbnN0IG5ld0pvYiA9IHtcbiAgICAgICAgICAgIGlkOiBqb2JEYXRhLmlkIHx8IERhdGUubm93KCkudG9TdHJpbmcoKSxcbiAgICAgICAgICAgIHByb21wdDogam9iRGF0YS5wcm9tcHQgfHwgc3RhdGUucGFyYW1zLnByb21wdCxcbiAgICAgICAgICAgIG5lZ2F0aXZlX3Byb21wdDogam9iRGF0YS5uZWdhdGl2ZV9wcm9tcHQgfHwgc3RhdGUucGFyYW1zLm5lZ2F0aXZlX3Byb21wdCxcbiAgICAgICAgICAgIHdpZHRoOiBqb2JEYXRhLndpZHRoIHx8IHN0YXRlLnBhcmFtcy53aWR0aCxcbiAgICAgICAgICAgIGhlaWdodDogam9iRGF0YS5oZWlnaHQgfHwgc3RhdGUucGFyYW1zLmhlaWdodCxcbiAgICAgICAgICAgIHN0ZXBzOiBqb2JEYXRhLnN0ZXBzIHx8IHN0YXRlLnBhcmFtcy5zdGVwcyxcbiAgICAgICAgICAgIGNmZ19zY2FsZTogam9iRGF0YS5jZmdfc2NhbGUgfHwgc3RhdGUucGFyYW1zLmNmZ19zY2FsZSxcbiAgICAgICAgICAgIHNlZWQ6IGpvYkRhdGEuc2VlZCB8fCBzdGF0ZS5wYXJhbXMuc2VlZCxcbiAgICAgICAgICAgIGJhdGNoX2NvdW50OiBqb2JEYXRhLmJhdGNoX2NvdW50IHx8IHN0YXRlLnBhcmFtcy5iYXRjaF9jb3VudCxcbiAgICAgICAgICAgIGJhdGNoX3NpemU6IGpvYkRhdGEuYmF0Y2hfc2l6ZSB8fCBzdGF0ZS5wYXJhbXMuYmF0Y2hfc2l6ZSxcbiAgICAgICAgICAgIHN0YXR1czogam9iRGF0YS5zdGF0dXMgfHwgJ3F1ZXVlZCcsXG4gICAgICAgICAgICBwcm9ncmVzczogam9iRGF0YS5wcm9ncmVzcyB8fCAwLFxuICAgICAgICAgICAgY3VycmVudF9zdGVwOiAwLFxuICAgICAgICAgICAgdG90YWxfc3RlcHM6IGpvYkRhdGEuc3RlcHMgfHwgc3RhdGUucGFyYW1zLnN0ZXBzLFxuICAgICAgICAgICAgY3JlYXRlZF9hdDogam9iRGF0YS5jcmVhdGVkX2F0IHx8IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgICAgICAgIHN0YXJ0X3RpbWU6IG51bGwsXG4gICAgICAgICAgICBldGE6IG51bGxcbiAgICAgICAgfTtcbiAgICAgICAgXG4gICAgICAgIHN0YXRlLmFjdGl2ZUpvYnMudW5zaGlmdChuZXdKb2IpO1xuICAgICAgICByZXR1cm4gbmV3Sm9iO1xuICAgIH0sXG4gICAgXG4gICAgLyoqXG4gICAgICogVXBkYXRlcyBhbiBhY3RpdmUgam9iXG4gICAgICovXG4gICAgdXBkYXRlQWN0aXZlSm9iKHN0YXRlLCBqb2JJZCwgdXBkYXRlcykge1xuICAgICAgICBjb25zdCBqb2JJbmRleCA9IHN0YXRlLmFjdGl2ZUpvYnMuZmluZEluZGV4KGpvYiA9PiBqb2IuaWQgPT09IGpvYklkKTtcbiAgICAgICAgaWYgKGpvYkluZGV4ICE9PSAtMSkge1xuICAgICAgICAgICAgc3RhdGUuYWN0aXZlSm9ic1tqb2JJbmRleF0gPSB7IC4uLnN0YXRlLmFjdGl2ZUpvYnNbam9iSW5kZXhdLCAuLi51cGRhdGVzIH07XG4gICAgICAgICAgICByZXR1cm4gc3RhdGUuYWN0aXZlSm9ic1tqb2JJbmRleF07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfSxcbiAgICBcbiAgICAvKipcbiAgICAgKiBSZW1vdmVzIGEgam9iIGZyb20gYWN0aXZlIGpvYnNcbiAgICAgKi9cbiAgICByZW1vdmVBY3RpdmVKb2Ioc3RhdGUsIGpvYklkKSB7XG4gICAgICAgIGNvbnN0IGluaXRpYWxMZW5ndGggPSBzdGF0ZS5hY3RpdmVKb2JzLmxlbmd0aDtcbiAgICAgICAgc3RhdGUuYWN0aXZlSm9icyA9IHN0YXRlLmFjdGl2ZUpvYnMuZmlsdGVyKGpvYiA9PiBqb2IuaWQgIT09IGpvYklkKTtcbiAgICAgICAgcmV0dXJuIHN0YXRlLmFjdGl2ZUpvYnMubGVuZ3RoICE9PSBpbml0aWFsTGVuZ3RoO1xuICAgIH0sXG4gICAgXG4gICAgLyoqXG4gICAgICogQWRkcyBhIHJlc3VsdCB0byByZWNlbnQgcmVzdWx0c1xuICAgICAqL1xuICAgIGFkZFJlY2VudFJlc3VsdChzdGF0ZSwgcmVzdWx0RGF0YSkge1xuICAgICAgICBjb25zdCBuZXdSZXN1bHQgPSB7XG4gICAgICAgICAgICBpZDogcmVzdWx0RGF0YS5pZCB8fCBEYXRlLm5vdygpLnRvU3RyaW5nKCksXG4gICAgICAgICAgICBqb2JfaWQ6IHJlc3VsdERhdGEuam9iX2lkLFxuICAgICAgICAgICAgcHJvbXB0OiByZXN1bHREYXRhLnByb21wdCxcbiAgICAgICAgICAgIG5lZ2F0aXZlX3Byb21wdDogcmVzdWx0RGF0YS5uZWdhdGl2ZV9wcm9tcHQsXG4gICAgICAgICAgICBpbWFnZV91cmw6IHJlc3VsdERhdGEuaW1hZ2VfdXJsLFxuICAgICAgICAgICAgdGh1bWJuYWlsX3VybDogcmVzdWx0RGF0YS50aHVtYm5haWxfdXJsLFxuICAgICAgICAgICAgd2lkdGg6IHJlc3VsdERhdGEud2lkdGgsXG4gICAgICAgICAgICBoZWlnaHQ6IHJlc3VsdERhdGEuaGVpZ2h0LFxuICAgICAgICAgICAgc3RlcHM6IHJlc3VsdERhdGEuc3RlcHMsXG4gICAgICAgICAgICBjZmdfc2NhbGU6IHJlc3VsdERhdGEuY2ZnX3NjYWxlLFxuICAgICAgICAgICAgc2VlZDogcmVzdWx0RGF0YS5zZWVkLFxuICAgICAgICAgICAgYmF0Y2hfY291bnQ6IHJlc3VsdERhdGEuYmF0Y2hfY291bnQsXG4gICAgICAgICAgICBiYXRjaF9zaXplOiByZXN1bHREYXRhLmJhdGNoX3NpemUsXG4gICAgICAgICAgICBjcmVhdGVkX2F0OiByZXN1bHREYXRhLmNyZWF0ZWRfYXQgfHwgbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgICAgICAgICAgZmlsZV9zaXplOiByZXN1bHREYXRhLmZpbGVfc2l6ZSxcbiAgICAgICAgICAgIGdlbmVyYXRpb25fdGltZTogcmVzdWx0RGF0YS5nZW5lcmF0aW9uX3RpbWUsXG4gICAgICAgICAgICBtb2RlbF91c2VkOiByZXN1bHREYXRhLm1vZGVsX3VzZWRcbiAgICAgICAgfTtcbiAgICAgICAgXG4gICAgICAgIHN0YXRlLnJlY2VudFJlc3VsdHMudW5zaGlmdChuZXdSZXN1bHQpO1xuICAgICAgICBcbiAgICAgICAgLy8gTGltaXQgdGhlIG51bWJlciBvZiByZXN1bHRzIGtlcHQgaW4gbWVtb3J5XG4gICAgICAgIGNvbnN0IG1heFJlc3VsdHMgPSBzdGF0ZS5zaG93SGlzdG9yeSA/IHN0YXRlLmNvbmZpZy5tYXhSZWNlbnRSZXN1bHRzIDogMTA7XG4gICAgICAgIGlmIChzdGF0ZS5yZWNlbnRSZXN1bHRzLmxlbmd0aCA+IG1heFJlc3VsdHMpIHtcbiAgICAgICAgICAgIHN0YXRlLnJlY2VudFJlc3VsdHMgPSBzdGF0ZS5yZWNlbnRSZXN1bHRzLnNsaWNlKDAsIG1heFJlc3VsdHMpO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICByZXR1cm4gbmV3UmVzdWx0O1xuICAgIH0sXG4gICAgXG4gICAgLyoqXG4gICAgICogUmVtb3ZlcyBhIHJlc3VsdCBmcm9tIHJlY2VudCByZXN1bHRzXG4gICAgICovXG4gICAgcmVtb3ZlUmVjZW50UmVzdWx0KHN0YXRlLCByZXN1bHRJZCkge1xuICAgICAgICBjb25zdCBpbml0aWFsTGVuZ3RoID0gc3RhdGUucmVjZW50UmVzdWx0cy5sZW5ndGg7XG4gICAgICAgIHN0YXRlLnJlY2VudFJlc3VsdHMgPSBzdGF0ZS5yZWNlbnRSZXN1bHRzLmZpbHRlcihyZXN1bHQgPT4gcmVzdWx0LmlkICE9PSByZXN1bHRJZCk7XG4gICAgICAgIHJldHVybiBzdGF0ZS5yZWNlbnRSZXN1bHRzLmxlbmd0aCAhPT0gaW5pdGlhbExlbmd0aDtcbiAgICB9LFxuICAgIFxuICAgIC8qKlxuICAgICAqIFVwZGF0ZXMgc3lzdGVtIHN0YXR1c1xuICAgICAqL1xuICAgIHVwZGF0ZVN5c3RlbVN0YXR1cyhzdGF0ZSwgc3RhdHVzRGF0YSkge1xuICAgICAgICBzdGF0ZS5zeXN0ZW1TdGF0dXMgPSB7XG4gICAgICAgICAgICAuLi5zdGF0ZS5zeXN0ZW1TdGF0dXMsXG4gICAgICAgICAgICAuLi5zdGF0dXNEYXRhLFxuICAgICAgICAgICAgbGFzdF91cGRhdGVkOiBEYXRlLm5vdygpXG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBzdGF0ZS5zeXN0ZW1TdGF0dXM7XG4gICAgfSxcbiAgICBcbiAgICAvKipcbiAgICAgKiBTZXRzIGdlbmVyYXRpb24gc3RhdHVzXG4gICAgICovXG4gICAgc2V0R2VuZXJhdGlvblN0YXR1cyhzdGF0ZSwgaXNHZW5lcmF0aW5nKSB7XG4gICAgICAgIHN0YXRlLmlzR2VuZXJhdGluZyA9IEJvb2xlYW4oaXNHZW5lcmF0aW5nKTtcbiAgICAgICAgcmV0dXJuIHN0YXRlLmlzR2VuZXJhdGluZztcbiAgICB9LFxuICAgIFxuICAgIC8qKlxuICAgICAqIFNldHMgY29ubmVjdGlvbiBzdGF0dXNcbiAgICAgKi9cbiAgICBzZXRDb25uZWN0aW9uU3RhdHVzKHN0YXRlLCBpc0Nvbm5lY3RlZCkge1xuICAgICAgICBzdGF0ZS5pc0Nvbm5lY3RlZCA9IEJvb2xlYW4oaXNDb25uZWN0ZWQpO1xuICAgICAgICByZXR1cm4gc3RhdGUuaXNDb25uZWN0ZWQ7XG4gICAgfSxcbiAgICBcbiAgICAvKipcbiAgICAgKiBTaG93cyB0b2FzdCBub3RpZmljYXRpb25cbiAgICAgKi9cbiAgICBzaG93VG9hc3Qoc3RhdGUsIG1lc3NhZ2UsIHR5cGUgPSAnc3VjY2VzcycpIHtcbiAgICAgICAgc3RhdGUudG9hc3RNZXNzYWdlID0gU3RyaW5nKG1lc3NhZ2UpO1xuICAgICAgICBzdGF0ZS5zaG93VG9hc3QgPSB0cnVlO1xuICAgICAgICBcbiAgICAgICAgLy8gQXV0by1oaWRlIGFmdGVyIGNvbmZpZ3VyZWQgZHVyYXRpb25cbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICBzdGF0ZS5zaG93VG9hc3QgPSBmYWxzZTtcbiAgICAgICAgICAgIHN0YXRlLnRvYXN0TWVzc2FnZSA9ICcnO1xuICAgICAgICB9LCBzdGF0ZS5jb25maWcudG9hc3REdXJhdGlvbik7XG4gICAgICAgIFxuICAgICAgICByZXR1cm4geyBtZXNzYWdlLCB0eXBlIH07XG4gICAgfSxcbiAgICBcbiAgICAvKipcbiAgICAgKiBIaWRlcyB0b2FzdCBub3RpZmljYXRpb25cbiAgICAgKi9cbiAgICBoaWRlVG9hc3Qoc3RhdGUpIHtcbiAgICAgICAgc3RhdGUuc2hvd1RvYXN0ID0gZmFsc2U7XG4gICAgICAgIHN0YXRlLnRvYXN0TWVzc2FnZSA9ICcnO1xuICAgICAgICByZXR1cm4gc3RhdGU7XG4gICAgfSxcbiAgICBcbiAgICAvKipcbiAgICAgKiBTaG93cyByZXN1bHQgbW9kYWxcbiAgICAgKi9cbiAgICBzaG93UmVzdWx0TW9kYWwoc3RhdGUsIHJlc3VsdCkge1xuICAgICAgICBzdGF0ZS5zZWxlY3RlZFJlc3VsdCA9IHJlc3VsdDtcbiAgICAgICAgc3RhdGUuc2hvd01vZGFsID0gdHJ1ZTtcbiAgICAgICAgcmV0dXJuIHN0YXRlO1xuICAgIH0sXG4gICAgXG4gICAgLyoqXG4gICAgICogSGlkZXMgcmVzdWx0IG1vZGFsXG4gICAgICovXG4gICAgaGlkZVJlc3VsdE1vZGFsKHN0YXRlKSB7XG4gICAgICAgIHN0YXRlLnNlbGVjdGVkUmVzdWx0ID0gbnVsbDtcbiAgICAgICAgc3RhdGUuc2hvd01vZGFsID0gZmFsc2U7XG4gICAgICAgIHJldHVybiBzdGF0ZTtcbiAgICB9LFxuICAgIFxuICAgIC8qKlxuICAgICAqIFRvZ2dsZXMgaGlzdG9yeSB2aWV3XG4gICAgICovXG4gICAgdG9nZ2xlSGlzdG9yeShzdGF0ZSkge1xuICAgICAgICBzdGF0ZS5zaG93SGlzdG9yeSA9ICFzdGF0ZS5zaG93SGlzdG9yeTtcbiAgICAgICAgcmV0dXJuIHN0YXRlLnNob3dIaXN0b3J5O1xuICAgIH0sXG4gICAgXG4gICAgLyoqXG4gICAgICogR2V0cyBqb2IgYnkgSURcbiAgICAgKi9cbiAgICBnZXRKb2JCeUlkKHN0YXRlLCBqb2JJZCkge1xuICAgICAgICByZXR1cm4gc3RhdGUuYWN0aXZlSm9icy5maW5kKGpvYiA9PiBqb2IuaWQgPT09IGpvYklkKSB8fCBudWxsO1xuICAgIH0sXG4gICAgXG4gICAgLyoqXG4gICAgICogR2V0cyByZXN1bHQgYnkgSURcbiAgICAgKi9cbiAgICBnZXRSZXN1bHRCeUlkKHN0YXRlLCByZXN1bHRJZCkge1xuICAgICAgICByZXR1cm4gc3RhdGUucmVjZW50UmVzdWx0cy5maW5kKHJlc3VsdCA9PiByZXN1bHQuaWQgPT09IHJlc3VsdElkKSB8fCBudWxsO1xuICAgIH0sXG4gICAgXG4gICAgLyoqXG4gICAgICogR2V0cyBnZW5lcmF0aW9uIHN0YXRpc3RpY3NcbiAgICAgKi9cbiAgICBnZXRTdGF0aXN0aWNzKHN0YXRlKSB7XG4gICAgICAgIGNvbnN0IHRvdGFsSm9icyA9IHN0YXRlLmFjdGl2ZUpvYnMubGVuZ3RoO1xuICAgICAgICBjb25zdCBwcm9jZXNzaW5nSm9icyA9IHN0YXRlLmFjdGl2ZUpvYnMuZmlsdGVyKGpvYiA9PiBqb2Iuc3RhdHVzID09PSAncHJvY2Vzc2luZycpLmxlbmd0aDtcbiAgICAgICAgY29uc3QgcXVldWVkSm9icyA9IHN0YXRlLmFjdGl2ZUpvYnMuZmlsdGVyKGpvYiA9PiBqb2Iuc3RhdHVzID09PSAncXVldWVkJykubGVuZ3RoO1xuICAgICAgICBjb25zdCBjb21wbGV0ZWRUb2RheSA9IHN0YXRlLnJlY2VudFJlc3VsdHMuZmlsdGVyKHJlc3VsdCA9PiB7XG4gICAgICAgICAgICBjb25zdCB0b2RheSA9IG5ldyBEYXRlKCkudG9EYXRlU3RyaW5nKCk7XG4gICAgICAgICAgICBjb25zdCByZXN1bHREYXRlID0gbmV3IERhdGUocmVzdWx0LmNyZWF0ZWRfYXQpLnRvRGF0ZVN0cmluZygpO1xuICAgICAgICAgICAgcmV0dXJuIHRvZGF5ID09PSByZXN1bHREYXRlO1xuICAgICAgICB9KS5sZW5ndGg7XG4gICAgICAgIFxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgdG90YWxBY3RpdmVKb2JzOiB0b3RhbEpvYnMsXG4gICAgICAgICAgICBwcm9jZXNzaW5nSm9icyxcbiAgICAgICAgICAgIHF1ZXVlZEpvYnMsXG4gICAgICAgICAgICBjb21wbGV0ZWRUb2RheSxcbiAgICAgICAgICAgIHRvdGFsUmVzdWx0czogc3RhdGUucmVjZW50UmVzdWx0cy5sZW5ndGgsXG4gICAgICAgICAgICBpc1N5c3RlbUhlYWx0aHk6IHRoaXMuaXNTeXN0ZW1IZWFsdGh5KHN0YXRlKSxcbiAgICAgICAgICAgIGF2ZXJhZ2VHZW5lcmF0aW9uVGltZTogdGhpcy5jYWxjdWxhdGVBdmVyYWdlR2VuZXJhdGlvblRpbWUoc3RhdGUpXG4gICAgICAgIH07XG4gICAgfSxcbiAgICBcbiAgICAvKipcbiAgICAgKiBDaGVja3MgaWYgc3lzdGVtIGlzIGhlYWx0aHlcbiAgICAgKi9cbiAgICBpc1N5c3RlbUhlYWx0aHkoc3RhdGUpIHtcbiAgICAgICAgY29uc3Qgbm93ID0gRGF0ZS5ub3coKTtcbiAgICAgICAgY29uc3QgbGFzdFVwZGF0ZSA9IHN0YXRlLnN5c3RlbVN0YXR1cy5sYXN0X3VwZGF0ZWQgfHwgMDtcbiAgICAgICAgY29uc3QgdGltZVNpbmNlVXBkYXRlID0gbm93IC0gbGFzdFVwZGF0ZTtcbiAgICAgICAgXG4gICAgICAgIC8vIENvbnNpZGVyIHN5c3RlbSBoZWFsdGh5IGlmOlxuICAgICAgICAvLyAtIExhc3QgdXBkYXRlIHdhcyB3aXRoaW4gMzAgc2Vjb25kc1xuICAgICAgICAvLyAtIE5vIHN0dWNrIGpvYnMgKHByb2Nlc3NpbmcgZm9yIG1vcmUgdGhhbiAxMCBtaW51dGVzKVxuICAgICAgICAvLyAtIENvbm5lY3Rpb24gaXMgYWN0aXZlXG4gICAgICAgIFxuICAgICAgICBjb25zdCBpc1JlY2VudCA9IHRpbWVTaW5jZVVwZGF0ZSA8IDMwMDAwO1xuICAgICAgICBjb25zdCBoYXNTdHVja0pvYnMgPSBzdGF0ZS5hY3RpdmVKb2JzLnNvbWUoam9iID0+IHtcbiAgICAgICAgICAgIGlmIChqb2Iuc3RhdHVzID09PSAncHJvY2Vzc2luZycgJiYgam9iLnN0YXJ0X3RpbWUpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBwcm9jZXNzaW5nVGltZSA9IG5vdyAtIGpvYi5zdGFydF90aW1lO1xuICAgICAgICAgICAgICAgIHJldHVybiBwcm9jZXNzaW5nVGltZSA+IDYwMDAwMDsgLy8gMTAgbWludXRlc1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9KTtcbiAgICAgICAgXG4gICAgICAgIHJldHVybiBpc1JlY2VudCAmJiAhaGFzU3R1Y2tKb2JzICYmIHN0YXRlLmlzQ29ubmVjdGVkO1xuICAgIH0sXG4gICAgXG4gICAgLyoqXG4gICAgICogQ2FsY3VsYXRlcyBhdmVyYWdlIGdlbmVyYXRpb24gdGltZVxuICAgICAqL1xuICAgIGNhbGN1bGF0ZUF2ZXJhZ2VHZW5lcmF0aW9uVGltZShzdGF0ZSkge1xuICAgICAgICBjb25zdCByZXN1bHRzV2l0aFRpbWUgPSBzdGF0ZS5yZWNlbnRSZXN1bHRzLmZpbHRlcihyZXN1bHQgPT4gcmVzdWx0LmdlbmVyYXRpb25fdGltZSk7XG4gICAgICAgIFxuICAgICAgICBpZiAocmVzdWx0c1dpdGhUaW1lLmxlbmd0aCA9PT0gMCkgcmV0dXJuIDA7XG4gICAgICAgIFxuICAgICAgICBjb25zdCB0b3RhbFRpbWUgPSByZXN1bHRzV2l0aFRpbWUucmVkdWNlKChzdW0sIHJlc3VsdCkgPT4gc3VtICsgcmVzdWx0LmdlbmVyYXRpb25fdGltZSwgMCk7XG4gICAgICAgIHJldHVybiB0b3RhbFRpbWUgLyByZXN1bHRzV2l0aFRpbWUubGVuZ3RoO1xuICAgIH0sXG4gICAgXG4gICAgLyoqXG4gICAgICogQ2xlYXJzIGFsbCBzdGF0ZSAoZm9yIGNsZWFudXApXG4gICAgICovXG4gICAgY2xlYXJTdGF0ZShzdGF0ZSkge1xuICAgICAgICBPYmplY3QuYXNzaWduKHN0YXRlLCB0aGlzLmNyZWF0ZUluaXRpYWxTdGF0ZSgpKTtcbiAgICAgICAgcmV0dXJuIHN0YXRlO1xuICAgIH0sXG4gICAgXG4gICAgLyoqXG4gICAgICogRXhwb3J0cyBzdGF0ZSBmb3IgcGVyc2lzdGVuY2VcbiAgICAgKi9cbiAgICBleHBvcnRTdGF0ZShzdGF0ZSkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgcGFyYW1zOiBzdGF0ZS5wYXJhbXMsXG4gICAgICAgICAgICByZWNlbnRSZXN1bHRzOiBzdGF0ZS5yZWNlbnRSZXN1bHRzLnNsaWNlKDAsIDEwKSwgLy8gT25seSBleHBvcnQgcmVjZW50IDEwXG4gICAgICAgICAgICBjb25maWc6IHN0YXRlLmNvbmZpZyxcbiAgICAgICAgICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKVxuICAgICAgICB9O1xuICAgIH0sXG4gICAgXG4gICAgLyoqXG4gICAgICogSW1wb3J0cyBzdGF0ZSBmcm9tIHBlcnNpc3RlbmNlXG4gICAgICovXG4gICAgaW1wb3J0U3RhdGUoc3RhdGUsIGltcG9ydGVkRGF0YSkge1xuICAgICAgICBpZiAoaW1wb3J0ZWREYXRhLnBhcmFtcykge1xuICAgICAgICAgICAgc3RhdGUucGFyYW1zID0geyAuLi5zdGF0ZS5wYXJhbXMsIC4uLnRoaXMudmFsaWRhdGVQYXJhbXMoaW1wb3J0ZWREYXRhLnBhcmFtcykgfTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoaW1wb3J0ZWREYXRhLnJlY2VudFJlc3VsdHMpKSB7XG4gICAgICAgICAgICBzdGF0ZS5yZWNlbnRSZXN1bHRzID0gaW1wb3J0ZWREYXRhLnJlY2VudFJlc3VsdHM7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGlmIChpbXBvcnRlZERhdGEuY29uZmlnKSB7XG4gICAgICAgICAgICBzdGF0ZS5jb25maWcgPSB7IC4uLnN0YXRlLmNvbmZpZywgLi4uaW1wb3J0ZWREYXRhLmNvbmZpZyB9O1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICByZXR1cm4gc3RhdGU7XG4gICAgfVxufTtcblxuLy8gRXhwb3J0IGZvciB1c2UgaW4gb3RoZXIgbW9kdWxlc1xuaWYgKHR5cGVvZiBtb2R1bGUgIT09ICd1bmRlZmluZWQnICYmIG1vZHVsZS5leHBvcnRzKSB7XG4gICAgbW9kdWxlLmV4cG9ydHMgPSB7IGdlbmVyYXRpb25TdGF0ZSB9O1xufSBlbHNlIGlmICh0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJykge1xuICAgIHdpbmRvdy5nZW5lcmF0aW9uU3RhdGUgPSBnZW5lcmF0aW9uU3RhdGU7XG59XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsTUFBTUEsZUFBZSxHQUFHO0VBQ3BCO0FBQ0o7QUFDQTtFQUNJQyxrQkFBa0JBLENBQUEsRUFBRztJQUNqQixPQUFPO01BQ0g7TUFDQUMsTUFBTSxFQUFFO1FBQ0pDLE1BQU0sRUFBRSxFQUFFO1FBQ1ZDLGVBQWUsRUFBRSxFQUFFO1FBQ25CQyxLQUFLLEVBQUUsR0FBRztRQUNWQyxNQUFNLEVBQUUsR0FBRztRQUNYQyxLQUFLLEVBQUUsRUFBRTtRQUNUQyxTQUFTLEVBQUUsR0FBRztRQUNkQyxJQUFJLEVBQUUsQ0FBQyxDQUFDO1FBQ1JDLFdBQVcsRUFBRSxDQUFDO1FBQ2RDLFVBQVUsRUFBRTtNQUNoQixDQUFDO01BRUQ7TUFDQUMsVUFBVSxFQUFFLEVBQUU7TUFDZEMsYUFBYSxFQUFFLEVBQUU7TUFDakJDLFlBQVksRUFBRSxDQUFDLENBQUM7TUFFaEI7TUFDQUMsWUFBWSxFQUFFLEtBQUs7TUFDbkJDLFdBQVcsRUFBRSxLQUFLO01BQ2xCQyxTQUFTLEVBQUUsS0FBSztNQUNoQkMsY0FBYyxFQUFFLElBQUk7TUFDcEJDLFNBQVMsRUFBRSxLQUFLO01BQ2hCQyxZQUFZLEVBQUUsRUFBRTtNQUVoQjtNQUNBQyxTQUFTLEVBQUUsSUFBSTtNQUNmQyxZQUFZLEVBQUUsSUFBSTtNQUNsQkMsV0FBVyxFQUFFLEtBQUs7TUFFbEI7TUFDQUMsTUFBTSxFQUFFO1FBQ0pDLGNBQWMsRUFBRSxJQUFJO1FBQ3BCQyxnQkFBZ0IsRUFBRSxFQUFF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