f75c57fa831d3a395f16012ad8f7090a
/**
 * PWA Manager - Service Worker Module
 * 
 * Handles service worker registration, lifecycle management, and updates.
 */

/**
 * Service Worker management operations
 */
const pwaServiceWorker = {
  /**
   * Registers the service worker
   */
  async register(swPath = '/sw.js', scope = '/') {
    if (!('serviceWorker' in navigator)) {
      throw new Error('Service Worker not supported');
    }
    try {
      const registration = await navigator.serviceWorker.register(swPath, {
        scope
      });
      if (window.DevLogger?.debug) {
        window.DevLogger.debug('[PWA] Service Worker registered:', registration);
      }
      return registration;
    } catch (error) {
      if (window.DevLogger?.debug) {
        window.DevLogger.debug('[PWA] Service Worker registration failed:', error);
      }
      throw new Error(`Service Worker registration failed: ${error.message}`);
    }
  },
  /**
   * Sets up service worker event listeners
   */
  setupEventListeners(registration, callbacks = {}) {
    if (!registration) return () => {};

    // Handle updates
    const handleUpdateFound = () => {
      const newWorker = registration.installing;
      if (!newWorker) return;
      const handleStateChange = () => {
        if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
          if (callbacks.onUpdateAvailable) {
            callbacks.onUpdateAvailable(newWorker);
          }
        }
      };
      newWorker.addEventListener('statechange', handleStateChange);
    };

    // Handle controller changes
    const handleControllerChange = () => {
      if (callbacks.onControllerChange) {
        callbacks.onControllerChange();
      } else {
        window.location.reload();
      }
    };
    registration.addEventListener('updatefound', handleUpdateFound);
    navigator.serviceWorker.addEventListener('controllerchange', handleControllerChange);

    // Return cleanup function
    return () => {
      registration.removeEventListener('updatefound', handleUpdateFound);
      navigator.serviceWorker.removeEventListener('controllerchange', handleControllerChange);
    };
  },
  /**
   * Checks for service worker updates
   */
  async checkForUpdates(registration) {
    if (!registration) return false;
    try {
      await registration.update();
      return true;
    } catch (error) {
      if (window.DevLogger?.debug) {
        window.DevLogger.debug('[PWA] Update check failed:', error);
      }
      return false;
    }
  },
  /**
   * Activates a waiting service worker
   */
  activateWaiting(registration) {
    if (registration?.waiting) {
      registration.waiting.postMessage({
        type: 'SKIP_WAITING'
      });
      return true;
    }
    return false;
  },
  /**
   * Gets the current service worker state
   */
  getState(registration) {
    if (!registration) {
      return {
        state: 'not_registered',
        hasUpdate: false
      };
    }
    return {
      state: registration.active ? 'active' : 'inactive',
      hasUpdate: Boolean(registration.waiting),
      installing: Boolean(registration.installing),
      scope: registration.scope,
      updateViaCache: registration.updateViaCache
    };
  },
  /**
   * Unregisters the service worker
   */
  async unregister(registration) {
    if (!registration) return false;
    try {
      const result = await registration.unregister();
      if (window.DevLogger?.debug) {
        window.DevLogger.debug('[PWA] Service Worker unregistered:', result);
      }
      return result;
    } catch (error) {
      if (window.DevLogger?.debug) {
        window.DevLogger.debug('[PWA] Service Worker unregistration failed:', error);
      }
      return false;
    }
  },
  /**
   * Posts a message to the service worker
   */
  postMessage(registration, message) {
    if (registration?.active) {
      registration.active.postMessage(message);
      return true;
    }
    return false;
  },
  /**
   * Posts a message to service worker with response
   */
  postMessageWithResponse(registration, message, timeout = 5000) {
    return new Promise((resolve, reject) => {
      if (!registration?.active) {
        reject(new Error('No active service worker'));
        return;
      }
      const messageChannel = new MessageChannel();
      const timeoutId = setTimeout(() => {
        reject(new Error('Service Worker response timeout'));
      }, timeout);
      messageChannel.port1.onmessage = event => {
        clearTimeout(timeoutId);
        resolve(event.data);
      };
      try {
        registration.active.postMessage(message, [messageChannel.port2]);
      } catch (error) {
        clearTimeout(timeoutId);
        reject(error);
      }
    });
  },
  /**
   * Gets all service worker registrations
   */
  async getAllRegistrations() {
    if (!('serviceWorker' in navigator)) return [];
    try {
      return await navigator.serviceWorker.getRegistrations();
    } catch (error) {
      return [];
    }
  },
  /**
   * Checks if service worker is supported
   */
  isSupported() {
    return 'serviceWorker' in navigator;
  },
  /**
   * Gets service worker capabilities
   */
  getCapabilities() {
    return {
      serviceWorker: 'serviceWorker' in navigator,
      pushManager: 'PushManager' in window,
      notification: 'Notification' in window,
      backgroundSync: 'serviceWorker' in navigator && 'sync' in window.ServiceWorkerRegistration.prototype,
      backgroundFetch: 'serviceWorker' in navigator && 'BackgroundFetch' in window,
      periodicBackgroundSync: 'serviceWorker' in navigator && 'periodicSync' in window.ServiceWorkerRegistration.prototype
    };
  },
  /**
   * Handles service worker errors
   */
  handleError(error, context = 'unknown') {
    const errorMessage = `Service Worker error in ${context}: ${error.message}`;
    if (window.DevLogger?.error) {
      window.DevLogger.error('[PWA]', errorMessage, error);
    }

    // Could dispatch custom event for error handling
    window.dispatchEvent(new CustomEvent('sw-error', {
      detail: {
        error,
        context,
        message: errorMessage
      }
    }));
    return errorMessage;
  },
  /**
   * Validates service worker script
   */
  async validateScript(swPath) {
    try {
      const response = await fetch(swPath, {
        cache: 'no-cache'
      });
      return response.ok;
    } catch (error) {
      return false;
    }
  },
  /**
   * Gets service worker performance metrics
   */
  getPerformanceMetrics(registration) {
    if (!registration) return null;
    const metrics = {
      registrationTime: registration.installing?.scriptURL ? Date.now() : null,
      scope: registration.scope,
      updateViaCache: registration.updateViaCache
    };

    // Add navigation API timing if available
    if (window.performance?.getEntriesByType) {
      const navigationEntries = window.performance.getEntriesByType('navigation');
      if (navigationEntries.length > 0) {
        const entry = navigationEntries[0];
        metrics.pageLoadTime = entry.loadEventEnd - entry.loadEventStart;
        metrics.domContentLoadedTime = entry.domContentLoadedEventEnd - entry.domContentLoadedEventStart;
      }
    }
    return metrics;
  }
};

// Export for use in other modules
if (typeof module !== 'undefined' && module.exports) {
  module.exports = {
    pwaServiceWorker
  };
} else if (typeof window !== 'undefined') {
  window.pwaServiceWorker = pwaServiceWorker;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJwd2FTZXJ2aWNlV29ya2VyIiwicmVnaXN0ZXIiLCJzd1BhdGgiLCJzY29wZSIsIm5hdmlnYXRvciIsIkVycm9yIiwicmVnaXN0cmF0aW9uIiwic2VydmljZVdvcmtlciIsIndpbmRvdyIsIkRldkxvZ2dlciIsImRlYnVnIiwiZXJyb3IiLCJtZXNzYWdlIiwic2V0dXBFdmVudExpc3RlbmVycyIsImNhbGxiYWNrcyIsImhhbmRsZVVwZGF0ZUZvdW5kIiwibmV3V29ya2VyIiwiaW5zdGFsbGluZyIsImhhbmRsZVN0YXRlQ2hhbmdlIiwic3RhdGUiLCJjb250cm9sbGVyIiwib25VcGRhdGVBdmFpbGFibGUiLCJhZGRFdmVudExpc3RlbmVyIiwiaGFuZGxlQ29udHJvbGxlckNoYW5nZSIsIm9uQ29udHJvbGxlckNoYW5nZSIsImxvY2F0aW9uIiwicmVsb2FkIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsImNoZWNrRm9yVXBkYXRlcyIsInVwZGF0ZSIsImFjdGl2YXRlV2FpdGluZyIsIndhaXRpbmciLCJwb3N0TWVzc2FnZSIsInR5cGUiLCJnZXRTdGF0ZSIsImhhc1VwZGF0ZSIsImFjdGl2ZSIsIkJvb2xlYW4iLCJ1cGRhdGVWaWFDYWNoZSIsInVucmVnaXN0ZXIiLCJyZXN1bHQiLCJwb3N0TWVzc2FnZVdpdGhSZXNwb25zZSIsInRpbWVvdXQiLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsIm1lc3NhZ2VDaGFubmVsIiwiTWVzc2FnZUNoYW5uZWwiLCJ0aW1lb3V0SWQiLCJzZXRUaW1lb3V0IiwicG9ydDEiLCJvbm1lc3NhZ2UiLCJldmVudCIsImNsZWFyVGltZW91dCIsImRhdGEiLCJwb3J0MiIsImdldEFsbFJlZ2lzdHJhdGlvbnMiLCJnZXRSZWdpc3RyYXRpb25zIiwiaXNTdXBwb3J0ZWQiLCJnZXRDYXBhYmlsaXRpZXMiLCJwdXNoTWFuYWdlciIsIm5vdGlmaWNhdGlvbiIsImJhY2tncm91bmRTeW5jIiwiU2VydmljZVdvcmtlclJlZ2lzdHJhdGlvbiIsInByb3RvdHlwZSIsImJhY2tncm91bmRGZXRjaCIsInBlcmlvZGljQmFja2dyb3VuZFN5bmMiLCJoYW5kbGVFcnJvciIsImNvbnRleHQiLCJlcnJvck1lc3NhZ2UiLCJkaXNwYXRjaEV2ZW50IiwiQ3VzdG9tRXZlbnQiLCJkZXRhaWwiLCJ2YWxpZGF0ZVNjcmlwdCIsInJlc3BvbnNlIiwiZmV0Y2giLCJjYWNoZSIsIm9rIiwiZ2V0UGVyZm9ybWFuY2VNZXRyaWNzIiwibWV0cmljcyIsInJlZ2lzdHJhdGlvblRpbWUiLCJzY3JpcHRVUkwiLCJEYXRlIiwibm93IiwicGVyZm9ybWFuY2UiLCJnZXRFbnRyaWVzQnlUeXBlIiwibmF2aWdhdGlvbkVudHJpZXMiLCJsZW5ndGgiLCJlbnRyeSIsInBhZ2VMb2FkVGltZSIsImxvYWRFdmVudEVuZCIsImxvYWRFdmVudFN0YXJ0IiwiZG9tQ29udGVudExvYWRlZFRpbWUiLCJkb21Db250ZW50TG9hZGVkRXZlbnRFbmQiLCJkb21Db250ZW50TG9hZGVkRXZlbnRTdGFydCIsIm1vZHVsZSIsImV4cG9ydHMiXSwic291cmNlcyI6WyJzZXJ2aWNlLXdvcmtlci5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIFBXQSBNYW5hZ2VyIC0gU2VydmljZSBXb3JrZXIgTW9kdWxlXG4gKiBcbiAqIEhhbmRsZXMgc2VydmljZSB3b3JrZXIgcmVnaXN0cmF0aW9uLCBsaWZlY3ljbGUgbWFuYWdlbWVudCwgYW5kIHVwZGF0ZXMuXG4gKi9cblxuLyoqXG4gKiBTZXJ2aWNlIFdvcmtlciBtYW5hZ2VtZW50IG9wZXJhdGlvbnNcbiAqL1xuY29uc3QgcHdhU2VydmljZVdvcmtlciA9IHtcbiAgICAvKipcbiAgICAgKiBSZWdpc3RlcnMgdGhlIHNlcnZpY2Ugd29ya2VyXG4gICAgICovXG4gICAgYXN5bmMgcmVnaXN0ZXIoc3dQYXRoID0gJy9zdy5qcycsIHNjb3BlID0gJy8nKSB7XG4gICAgICAgIGlmICghKCdzZXJ2aWNlV29ya2VyJyBpbiBuYXZpZ2F0b3IpKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1NlcnZpY2UgV29ya2VyIG5vdCBzdXBwb3J0ZWQnKTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IHJlZ2lzdHJhdGlvbiA9IGF3YWl0IG5hdmlnYXRvci5zZXJ2aWNlV29ya2VyLnJlZ2lzdGVyKHN3UGF0aCwgeyBzY29wZSB9KTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgaWYgKHdpbmRvdy5EZXZMb2dnZXI/LmRlYnVnKSB7XG4gICAgICAgICAgICAgICAgd2luZG93LkRldkxvZ2dlci5kZWJ1ZygnW1BXQV0gU2VydmljZSBXb3JrZXIgcmVnaXN0ZXJlZDonLCByZWdpc3RyYXRpb24pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgXG4gICAgICAgICAgICByZXR1cm4gcmVnaXN0cmF0aW9uO1xuICAgICAgICAgICAgXG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICBpZiAod2luZG93LkRldkxvZ2dlcj8uZGVidWcpIHtcbiAgICAgICAgICAgICAgICB3aW5kb3cuRGV2TG9nZ2VyLmRlYnVnKCdbUFdBXSBTZXJ2aWNlIFdvcmtlciByZWdpc3RyYXRpb24gZmFpbGVkOicsIGVycm9yKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgU2VydmljZSBXb3JrZXIgcmVnaXN0cmF0aW9uIGZhaWxlZDogJHtlcnJvci5tZXNzYWdlfWApO1xuICAgICAgICB9XG4gICAgfSxcbiAgICBcbiAgICAvKipcbiAgICAgKiBTZXRzIHVwIHNlcnZpY2Ugd29ya2VyIGV2ZW50IGxpc3RlbmVyc1xuICAgICAqL1xuICAgIHNldHVwRXZlbnRMaXN0ZW5lcnMocmVnaXN0cmF0aW9uLCBjYWxsYmFja3MgPSB7fSkge1xuICAgICAgICBpZiAoIXJlZ2lzdHJhdGlvbikgcmV0dXJuICgpID0+IHt9O1xuICAgICAgICBcbiAgICAgICAgLy8gSGFuZGxlIHVwZGF0ZXNcbiAgICAgICAgY29uc3QgaGFuZGxlVXBkYXRlRm91bmQgPSAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBuZXdXb3JrZXIgPSByZWdpc3RyYXRpb24uaW5zdGFsbGluZztcbiAgICAgICAgICAgIGlmICghbmV3V29ya2VyKSByZXR1cm47XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGNvbnN0IGhhbmRsZVN0YXRlQ2hhbmdlID0gKCkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChuZXdXb3JrZXIuc3RhdGUgPT09ICdpbnN0YWxsZWQnICYmIG5hdmlnYXRvci5zZXJ2aWNlV29ya2VyLmNvbnRyb2xsZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNhbGxiYWNrcy5vblVwZGF0ZUF2YWlsYWJsZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2tzLm9uVXBkYXRlQXZhaWxhYmxlKG5ld1dvcmtlcik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBuZXdXb3JrZXIuYWRkRXZlbnRMaXN0ZW5lcignc3RhdGVjaGFuZ2UnLCBoYW5kbGVTdGF0ZUNoYW5nZSk7XG4gICAgICAgIH07XG4gICAgICAgIFxuICAgICAgICAvLyBIYW5kbGUgY29udHJvbGxlciBjaGFuZ2VzXG4gICAgICAgIGNvbnN0IGhhbmRsZUNvbnRyb2xsZXJDaGFuZ2UgPSAoKSA9PiB7XG4gICAgICAgICAgICBpZiAoY2FsbGJhY2tzLm9uQ29udHJvbGxlckNoYW5nZSkge1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrcy5vbkNvbnRyb2xsZXJDaGFuZ2UoKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLnJlbG9hZCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICBcbiAgICAgICAgcmVnaXN0cmF0aW9uLmFkZEV2ZW50TGlzdGVuZXIoJ3VwZGF0ZWZvdW5kJywgaGFuZGxlVXBkYXRlRm91bmQpO1xuICAgICAgICBuYXZpZ2F0b3Iuc2VydmljZVdvcmtlci5hZGRFdmVudExpc3RlbmVyKCdjb250cm9sbGVyY2hhbmdlJywgaGFuZGxlQ29udHJvbGxlckNoYW5nZSk7XG4gICAgICAgIFxuICAgICAgICAvLyBSZXR1cm4gY2xlYW51cCBmdW5jdGlvblxuICAgICAgICByZXR1cm4gKCkgPT4ge1xuICAgICAgICAgICAgcmVnaXN0cmF0aW9uLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3VwZGF0ZWZvdW5kJywgaGFuZGxlVXBkYXRlRm91bmQpO1xuICAgICAgICAgICAgbmF2aWdhdG9yLnNlcnZpY2VXb3JrZXIucmVtb3ZlRXZlbnRMaXN0ZW5lcignY29udHJvbGxlcmNoYW5nZScsIGhhbmRsZUNvbnRyb2xsZXJDaGFuZ2UpO1xuICAgICAgICB9O1xuICAgIH0sXG4gICAgXG4gICAgLyoqXG4gICAgICogQ2hlY2tzIGZvciBzZXJ2aWNlIHdvcmtlciB1cGRhdGVzXG4gICAgICovXG4gICAgYXN5bmMgY2hlY2tGb3JVcGRhdGVzKHJlZ2lzdHJhdGlvbikge1xuICAgICAgICBpZiAoIXJlZ2lzdHJhdGlvbikgcmV0dXJuIGZhbHNlO1xuICAgICAgICBcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGF3YWl0IHJlZ2lzdHJhdGlvbi51cGRhdGUoKTtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgaWYgKHdpbmRvdy5EZXZMb2dnZXI/LmRlYnVnKSB7XG4gICAgICAgICAgICAgICAgd2luZG93LkRldkxvZ2dlci5kZWJ1ZygnW1BXQV0gVXBkYXRlIGNoZWNrIGZhaWxlZDonLCBlcnJvcik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICB9LFxuICAgIFxuICAgIC8qKlxuICAgICAqIEFjdGl2YXRlcyBhIHdhaXRpbmcgc2VydmljZSB3b3JrZXJcbiAgICAgKi9cbiAgICBhY3RpdmF0ZVdhaXRpbmcocmVnaXN0cmF0aW9uKSB7XG4gICAgICAgIGlmIChyZWdpc3RyYXRpb24/LndhaXRpbmcpIHtcbiAgICAgICAgICAgIHJlZ2lzdHJhdGlvbi53YWl0aW5nLnBvc3RNZXNzYWdlKHsgdHlwZTogJ1NLSVBfV0FJVElORycgfSk7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfSxcbiAgICBcbiAgICAvKipcbiAgICAgKiBHZXRzIHRoZSBjdXJyZW50IHNlcnZpY2Ugd29ya2VyIHN0YXRlXG4gICAgICovXG4gICAgZ2V0U3RhdGUocmVnaXN0cmF0aW9uKSB7XG4gICAgICAgIGlmICghcmVnaXN0cmF0aW9uKSB7XG4gICAgICAgICAgICByZXR1cm4geyBzdGF0ZTogJ25vdF9yZWdpc3RlcmVkJywgaGFzVXBkYXRlOiBmYWxzZSB9O1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgc3RhdGU6IHJlZ2lzdHJhdGlvbi5hY3RpdmUgPyAnYWN0aXZlJyA6ICdpbmFjdGl2ZScsXG4gICAgICAgICAgICBoYXNVcGRhdGU6IEJvb2xlYW4ocmVnaXN0cmF0aW9uLndhaXRpbmcpLFxuICAgICAgICAgICAgaW5zdGFsbGluZzogQm9vbGVhbihyZWdpc3RyYXRpb24uaW5zdGFsbGluZyksXG4gICAgICAgICAgICBzY29wZTogcmVnaXN0cmF0aW9uLnNjb3BlLFxuICAgICAgICAgICAgdXBkYXRlVmlhQ2FjaGU6IHJlZ2lzdHJhdGlvbi51cGRhdGVWaWFDYWNoZVxuICAgICAgICB9O1xuICAgIH0sXG4gICAgXG4gICAgLyoqXG4gICAgICogVW5yZWdpc3RlcnMgdGhlIHNlcnZpY2Ugd29ya2VyXG4gICAgICovXG4gICAgYXN5bmMgdW5yZWdpc3RlcihyZWdpc3RyYXRpb24pIHtcbiAgICAgICAgaWYgKCFyZWdpc3RyYXRpb24pIHJldHVybiBmYWxzZTtcbiAgICAgICAgXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCByZWdpc3RyYXRpb24udW5yZWdpc3RlcigpO1xuICAgICAgICAgICAgaWYgKHdpbmRvdy5EZXZMb2dnZXI/LmRlYnVnKSB7XG4gICAgICAgICAgICAgICAgd2luZG93LkRldkxvZ2dlci5kZWJ1ZygnW1BXQV0gU2VydmljZSBXb3JrZXIgdW5yZWdpc3RlcmVkOicsIHJlc3VsdCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgaWYgKHdpbmRvdy5EZXZMb2dnZXI/LmRlYnVnKSB7XG4gICAgICAgICAgICAgICAgd2luZG93LkRldkxvZ2dlci5kZWJ1ZygnW1BXQV0gU2VydmljZSBXb3JrZXIgdW5yZWdpc3RyYXRpb24gZmFpbGVkOicsIGVycm9yKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgIH0sXG4gICAgXG4gICAgLyoqXG4gICAgICogUG9zdHMgYSBtZXNzYWdlIHRvIHRoZSBzZXJ2aWNlIHdvcmtlclxuICAgICAqL1xuICAgIHBvc3RNZXNzYWdlKHJlZ2lzdHJhdGlvbiwgbWVzc2FnZSkge1xuICAgICAgICBpZiAocmVnaXN0cmF0aW9uPy5hY3RpdmUpIHtcbiAgICAgICAgICAgIHJlZ2lzdHJhdGlvbi5hY3RpdmUucG9zdE1lc3NhZ2UobWVzc2FnZSk7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfSxcbiAgICBcbiAgICAvKipcbiAgICAgKiBQb3N0cyBhIG1lc3NhZ2UgdG8gc2VydmljZSB3b3JrZXIgd2l0aCByZXNwb25zZVxuICAgICAqL1xuICAgIHBvc3RNZXNzYWdlV2l0aFJlc3BvbnNlKHJlZ2lzdHJhdGlvbiwgbWVzc2FnZSwgdGltZW91dCA9IDUwMDApIHtcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgICAgIGlmICghcmVnaXN0cmF0aW9uPy5hY3RpdmUpIHtcbiAgICAgICAgICAgICAgICByZWplY3QobmV3IEVycm9yKCdObyBhY3RpdmUgc2VydmljZSB3b3JrZXInKSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgXG4gICAgICAgICAgICBjb25zdCBtZXNzYWdlQ2hhbm5lbCA9IG5ldyBNZXNzYWdlQ2hhbm5lbCgpO1xuICAgICAgICAgICAgY29uc3QgdGltZW91dElkID0gc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgcmVqZWN0KG5ldyBFcnJvcignU2VydmljZSBXb3JrZXIgcmVzcG9uc2UgdGltZW91dCcpKTtcbiAgICAgICAgICAgIH0sIHRpbWVvdXQpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBtZXNzYWdlQ2hhbm5lbC5wb3J0MS5vbm1lc3NhZ2UgPSAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQodGltZW91dElkKTtcbiAgICAgICAgICAgICAgICByZXNvbHZlKGV2ZW50LmRhdGEpO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICByZWdpc3RyYXRpb24uYWN0aXZlLnBvc3RNZXNzYWdlKG1lc3NhZ2UsIFttZXNzYWdlQ2hhbm5lbC5wb3J0Ml0pO1xuICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQodGltZW91dElkKTtcbiAgICAgICAgICAgICAgICByZWplY3QoZXJyb3IpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9LFxuICAgIFxuICAgIC8qKlxuICAgICAqIEdldHMgYWxsIHNlcnZpY2Ugd29ya2VyIHJlZ2lzdHJhdGlvbnNcbiAgICAgKi9cbiAgICBhc3luYyBnZXRBbGxSZWdpc3RyYXRpb25zKCkge1xuICAgICAgICBpZiAoISgnc2VydmljZVdvcmtlcicgaW4gbmF2aWdhdG9yKSkgcmV0dXJuIFtdO1xuICAgICAgICBcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHJldHVybiBhd2FpdCBuYXZpZ2F0b3Iuc2VydmljZVdvcmtlci5nZXRSZWdpc3RyYXRpb25zKCk7XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH1cbiAgICB9LFxuICAgIFxuICAgIC8qKlxuICAgICAqIENoZWNrcyBpZiBzZXJ2aWNlIHdvcmtlciBpcyBzdXBwb3J0ZWRcbiAgICAgKi9cbiAgICBpc1N1cHBvcnRlZCgpIHtcbiAgICAgICAgcmV0dXJuICdzZXJ2aWNlV29ya2VyJyBpbiBuYXZpZ2F0b3I7XG4gICAgfSxcbiAgICBcbiAgICAvKipcbiAgICAgKiBHZXRzIHNlcnZpY2Ugd29ya2VyIGNhcGFiaWxpdGllc1xuICAgICAqL1xuICAgIGdldENhcGFiaWxpdGllcygpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHNlcnZpY2VXb3JrZXI6ICdzZXJ2aWNlV29ya2VyJyBpbiBuYXZpZ2F0b3IsXG4gICAgICAgICAgICBwdXNoTWFuYWdlcjogJ1B1c2hNYW5hZ2VyJyBpbiB3aW5kb3csXG4gICAgICAgICAgICBub3RpZmljYXRpb246ICdOb3RpZmljYXRpb24nIGluIHdpbmRvdyxcbiAgICAgICAgICAgIGJhY2tncm91bmRTeW5jOiAnc2VydmljZVdvcmtlcicgaW4gbmF2aWdhdG9yICYmICdzeW5jJyBpbiB3aW5kb3cuU2VydmljZVdvcmtlclJlZ2lzdHJhdGlvbi5wcm90b3R5cGUsXG4gICAgICAgICAgICBiYWNrZ3JvdW5kRmV0Y2g6ICdzZXJ2aWNlV29ya2VyJyBpbiBuYXZpZ2F0b3IgJiYgJ0JhY2tncm91bmRGZXRjaCcgaW4gd2luZG93LFxuICAgICAgICAgICAgcGVyaW9kaWNCYWNrZ3JvdW5kU3luYzogJ3NlcnZpY2VXb3JrZXInIGluIG5hdmlnYXRvciAmJiAncGVyaW9kaWNTeW5jJyBpbiB3aW5kb3cuU2VydmljZVdvcmtlclJlZ2lzdHJhdGlvbi5wcm90b3R5cGVcbiAgICAgICAgfTtcbiAgICB9LFxuICAgIFxuICAgIC8qKlxuICAgICAqIEhhbmRsZXMgc2VydmljZSB3b3JrZXIgZXJyb3JzXG4gICAgICovXG4gICAgaGFuZGxlRXJyb3IoZXJyb3IsIGNvbnRleHQgPSAndW5rbm93bicpIHtcbiAgICAgICAgY29uc3QgZXJyb3JNZXNzYWdlID0gYFNlcnZpY2UgV29ya2VyIGVycm9yIGluICR7Y29udGV4dH06ICR7ZXJyb3IubWVzc2FnZX1gO1xuICAgICAgICBcbiAgICAgICAgaWYgKHdpbmRvdy5EZXZMb2dnZXI/LmVycm9yKSB7XG4gICAgICAgICAgICB3aW5kb3cuRGV2TG9nZ2VyLmVycm9yKCdbUFdBXScsIGVycm9yTWVzc2FnZSwgZXJyb3IpO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICAvLyBDb3VsZCBkaXNwYXRjaCBjdXN0b20gZXZlbnQgZm9yIGVycm9yIGhhbmRsaW5nXG4gICAgICAgIHdpbmRvdy5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgnc3ctZXJyb3InLCB7XG4gICAgICAgICAgICBkZXRhaWw6IHsgZXJyb3IsIGNvbnRleHQsIG1lc3NhZ2U6IGVycm9yTWVzc2FnZSB9XG4gICAgICAgIH0pKTtcbiAgICAgICAgXG4gICAgICAgIHJldHVybiBlcnJvck1lc3NhZ2U7XG4gICAgfSxcbiAgICBcbiAgICAvKipcbiAgICAgKiBWYWxpZGF0ZXMgc2VydmljZSB3b3JrZXIgc2NyaXB0XG4gICAgICovXG4gICAgYXN5bmMgdmFsaWRhdGVTY3JpcHQoc3dQYXRoKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKHN3UGF0aCwgeyBjYWNoZTogJ25vLWNhY2hlJyB9KTtcbiAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5vaztcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgIH0sXG4gICAgXG4gICAgLyoqXG4gICAgICogR2V0cyBzZXJ2aWNlIHdvcmtlciBwZXJmb3JtYW5jZSBtZXRyaWNzXG4gICAgICovXG4gICAgZ2V0UGVyZm9ybWFuY2VNZXRyaWNzKHJlZ2lzdHJhdGlvbikge1xuICAgICAgICBpZiAoIXJlZ2lzdHJhdGlvbikgcmV0dXJuIG51bGw7XG4gICAgICAgIFxuICAgICAgICBjb25zdCBtZXRyaWNzID0ge1xuICAgICAgICAgICAgcmVnaXN0cmF0aW9uVGltZTogcmVnaXN0cmF0aW9uLmluc3RhbGxpbmc/LnNjcmlwdFVSTCA/IERhdGUubm93KCkgOiBudWxsLFxuICAgICAgICAgICAgc2NvcGU6IHJlZ2lzdHJhdGlvbi5zY29wZSxcbiAgICAgICAgICAgIHVwZGF0ZVZpYUNhY2hlOiByZWdpc3RyYXRpb24udXBkYXRlVmlhQ2FjaGVcbiAgICAgICAgfTtcbiAgICAgICAgXG4gICAgICAgIC8vIEFkZCBuYXZpZ2F0aW9uIEFQSSB0aW1pbmcgaWYgYXZhaWxhYmxlXG4gICAgICAgIGlmICh3aW5kb3cucGVyZm9ybWFuY2U/LmdldEVudHJpZXNCeVR5cGUpIHtcbiAgICAgICAgICAgIGNvbnN0IG5hdmlnYXRpb25FbnRyaWVzID0gd2luZG93LnBlcmZvcm1hbmNlLmdldEVudHJpZXNCeVR5cGUoJ25hdmlnYXRpb24nKTtcbiAgICAgICAgICAgIGlmIChuYXZpZ2F0aW9uRW50cmllcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgZW50cnkgPSBuYXZpZ2F0aW9uRW50cmllc1swXTtcbiAgICAgICAgICAgICAgICBtZXRyaWNzLnBhZ2VMb2FkVGltZSA9IGVudHJ5LmxvYWRFdmVudEVuZCAtIGVudHJ5LmxvYWRFdmVudFN0YXJ0O1xuICAgICAgICAgICAgICAgIG1ldHJpY3MuZG9tQ29udGVudExvYWRlZFRpbWUgPSBlbnRyeS5kb21Db250ZW50TG9hZGVkRXZlbnRFbmQgLSBlbnRyeS5kb21Db250ZW50TG9hZGVkRXZlbnRTdGFydDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgcmV0dXJuIG1ldHJpY3M7XG4gICAgfVxufTtcblxuLy8gRXhwb3J0IGZvciB1c2UgaW4gb3RoZXIgbW9kdWxlc1xuaWYgKHR5cGVvZiBtb2R1bGUgIT09ICd1bmRlZmluZWQnICYmIG1vZHVsZS5leHBvcnRzKSB7XG4gICAgbW9kdWxlLmV4cG9ydHMgPSB7IHB3YVNlcnZpY2VXb3JrZXIgfTtcbn0gZWxzZSBpZiAodHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICB3aW5kb3cucHdhU2VydmljZVdvcmtlciA9IHB3YVNlcnZpY2VXb3JrZXI7XG59XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsTUFBTUEsZ0JBQWdCLEdBQUc7RUFDckI7QUFDSjtBQUNBO0VBQ0ksTUFBTUMsUUFBUUEsQ0FBQ0MsTUFBTSxHQUFHLFFBQVEsRUFBRUMsS0FBSyxHQUFHLEdBQUcsRUFBRTtJQUMzQyxJQUFJLEVBQUUsZUFBZSxJQUFJQyxTQUFTLENBQUMsRUFBRTtNQUNqQyxNQUFNLElBQUlDLEtBQUssQ0FBQyw4QkFBOEIsQ0FBQztJQUNuRDtJQUVBLElBQUk7TUFDQSxNQUFNQyxZQUFZLEdBQUcsTUFBTUYsU0FBUyxDQUFDRyxhQUFhLENBQUNOLFFBQVEsQ0FBQ0MsTUFBTSxFQUFFO1FBQUVDO01BQU0sQ0FBQyxDQUFDO01BRTlFLElBQUlLLE1BQU0sQ0FBQ0MsU0FBUyxFQUFFQyxLQUFLLEVBQUU7UUFDekJGLE1BQU0sQ0FBQ0MsU0FBUyxDQUFDQyxLQUFLLENBQUMsa0NBQWtDLEVBQUVKLFlBQVksQ0FBQztNQUM1RTtNQUVBLE9BQU9BLFlBQVk7SUFFdkIsQ0FBQyxDQUFDLE9BQU9LLEtBQUssRUFBRTtNQUNaLElBQUlILE1BQU0sQ0FBQ0MsU0FBUyxFQUFFQyxLQUFLLEVBQUU7UUFDekJGLE1BQU0sQ0FBQ0MsU0FBUyxDQUFDQyxLQUFLLENBQUMsMkNBQTJDLEVBQUVDLEtBQUssQ0FBQztNQUM5RTtNQUNBLE1BQU0sSUFBSU4sS0FBSyxDQUFDLHVDQUF1Q00sS0FBSyxDQUFDQyxPQUFPLEVBQUUsQ0FBQztJQUMzRTtFQUNKLENBQUM7RUFFRDtBQUNKO0FBQ0E7RUFDSUMsbUJBQW1CQSxDQUFDUCxZQUFZLEVBQUVRLFNBQVMsR0FBRyxDQUFDLENBQUMsRUFBRTtJQUM5QyxJQUFJLENBQUNSLFlBQVksRUFBRSxPQUFPLE1BQU0sQ0FBQyxDQUFDOztJQUVsQztJQUNBLE1BQU1TLGlCQUFpQixHQUFHQSxDQUFBLEtBQU07TUFDNUIsTUFBTUMsU0FBUyxHQUFHVixZQUFZLENBQUNXLFVBQVU7TUFDekMsSUFBSSxDQUFDRCxTQUFTLEVBQUU7TUFFaEIsTUFBTUUsaUJBQWlCLEdBQUdBLENBQUEsS0FBTTtRQUM1QixJQUFJRixTQUFTLENBQUNHLEtBQUssS0FBSyxXQUFXLElBQUlmLFNBQVMsQ0FBQ0csYUFBYSxDQUFDYSxVQUFVLEVBQUU7VUFDdkUsSUFBSU4sU0FBUyxDQUFDTyxpQkFBaUIsRUFBRTtZQUM3QlAsU0FBUyxDQUFDTyxpQkFBaUIsQ0FBQ0wsU0FBUyxDQUFDO1VBQzFDO1FBQ0o7TUFDSixDQUFDO01BRURBLFNBQVMsQ0FBQ00sZ0JBQWdCLENBQUMsYUFBYSxFQUFFSixpQkFBaUIsQ0FBQztJQUNoRSxDQUFDOztJQUVEO0lBQ0EsTUFBTUssc0JBQXNCLEdBQUdBLENBQUEsS0FBTTtNQUNqQyxJQUFJVCxTQUFTLENBQUNVLGtCQUFrQixFQUFFO1FBQzlCVixTQUFTLENBQUNVLGtCQUFrQixDQUFDLENBQUM7TUFDbEMsQ0FBQyxNQUFNO1FBQ0hoQixNQUFNLENBQUNpQixRQUFRLENBQUNDLE1BQU0sQ0FBQyxDQUFDO01BQzVCO0lBQ0osQ0FBQztJQUVEcEIsWUFBWSxDQUFDZ0IsZ0JBQWdCLENBQUMsYUFBYSxFQUFFUCxpQkFBaUIsQ0FBQztJQUMvRFgsU0FBUyxDQUFDRyxhQUFhLENBQUNlLGdCQUFnQixDQUFDLGtCQUFrQixFQUFFQyxzQkFBc0IsQ0FBQzs7SUFFcEY7SUFDQSxPQUFPLE1BQU07TUFDVGpCLFlBQVksQ0FBQ3FCLG1CQUFtQixDQUFDLGFBQWEsRUFBRVosaUJBQWlCLENBQUM7TUFDbEVYLFNBQVMsQ0FBQ0csYUFBYSxDQUFDb0IsbUJBQW1CLENBQUMsa0JBQWtCLEVBQUVKLHNCQUFzQixDQUFDO0lBQzNGLENBQUM7RUFDTCxDQUFDO0VBRUQ7QUFDSjtBQUNBO0VBQ0ksTUFBTUssZUFBZUEsQ0FBQ3RCLFlBQVksRUFBRTtJQUNoQyxJQUFJLENBQUNBLFlBQVksRUFBRSxPQUFPLEtBQUs7SUFFL0IsSUFBSTtNQUNBLE1BQU1BLFlBQVksQ0FBQ3VCLE1BQU0sQ0FBQyxDQUFDO01BQzNCLE9BQU8sSUFBSTtJQUNmLENBQUMsQ0FBQyxPQUFPbEIsS0FBSyxFQUFFO01BQ1osSUFBSUgsTUFBTSxDQUFDQyxTQUFTLEVBQUVDLEtBQUssRUFBRTtRQUN6QkYsTUFBTSxDQUFDQyxTQUFTLENBQUNDLEtBQUssQ0FBQyw0QkFBNEIsRUFBRUMsS0FBSyxDQUFDO01BQy9EO01BQ0EsT0FBTyxLQUFLO0lBQ2hCO0VBQ0osQ0FBQztFQUVEO0FBQ0o7QUFDQTtFQUNJbUIsZUFBZUEsQ0FBQ3hCLFlBQVksRUFBRTtJQUMxQixJQUFJQSxZQUFZLEVBQUV5QixPQUFPLEVBQUU7TUFDdkJ6QixZQUFZLENBQUN5QixPQUFPLENBQUNDLFdBQVcsQ0FBQztRQUFFQyxJQUFJLEVBQUU7TUFBZSxDQUFDLENBQUM7TUFDMUQsT0FBTyxJQUFJO0lBQ2Y7SUFDQSxPQUFPLEtBQUs7RUFDaEIsQ0FBQztFQUVEO0FBQ0o7QUFDQTtFQUNJQyxRQUFRQSxDQUFDNUIsWUFBWSxFQUFFO0lBQ25CLElBQUksQ0FBQ0EsWUFBWSxFQUFFO01BQ2YsT0FBTztRQUFFYSxLQUFLLEVBQUUsZ0JBQWdCO1FBQUVnQixTQUFTLEVBQUU7TUFBTSxDQUFDO0lBQ3hEO0lBRUEsT0FBTztNQUNIaEIsS0FBSyxFQUFFYixZQUFZLENBQUM4QixNQUFNLEdBQUcsUUFBUSxHQUFHLFVBQVU7TUFDbERELFNBQVMsRUFBRUUsT0FBTyxDQUFDL0IsWUFBWSxDQUFDeUIsT0FBTyxDQUFDO01BQ3hDZCxVQUFVLEVBQUVvQixPQUFPLENBQUMvQixZQUFZLENBQUNXLFVBQVUsQ0FBQztNQUM1Q2QsS0FBSyxFQUFFRyxZQUFZLENBQUNILEtBQUs7TUFDekJtQyxjQUFjLEVBQUVoQyxZQUFZLENBQUNnQztJQUNqQyxDQUFDO0VBQ0wsQ0FBQztFQUVEO0FBQ0o7QUFDQTtFQUNJLE1BQU1DLFVBQVVBLENBQUNqQyxZQUFZLEVBQUU7SUFDM0IsSUFBSSxDQUFDQSxZQUFZLEVBQUUsT0FBTyxLQUFLO0lBRS9CLElBQUk7TUFDQSxNQUFNa0MsTUFBTSxHQUFHLE1BQU1sQyxZQUFZLENBQUNpQyxVQUFVLENBQUMsQ0FBQztNQUM5QyxJQUFJL0IsTUFBTSxDQUFDQyxTQUFTLEVBQUVDLEtBQUssRUFBRTtRQUN6QkYsTUFBTSxDQUFDQyxTQUFTLENBQUNDLEtBQUssQ0FBQyxvQ0FBb0MsRUFBRThCLE1BQU0sQ0FBQztNQUN4RTtNQUNBLE9BQU9BLE1BQU07SUFDakIsQ0FBQyxDQUFDLE9BQU83QixLQUFLLEVBQUU7TUFDWixJQUFJSCxNQUFNLENBQUNDLFNBQVMsRUFBRUMsS0FBSyxFQUFFO1FBQ3pCRixNQUFNLENBQUNDLFNBQVMsQ0FBQ0MsS0FBSyxDQUFDLDZDQUE2QyxFQUFFQyxLQUFLLENBQUM7TUFDaEY7TUFDQSxPQUFPLEtBQUs7SUFDaEI7RUFDSixDQUFDO0VBRUQ7QUFDSjtBQUNBO0VBQ0lxQixXQUFXQSxDQUFDMUIsWUFBWSxFQUFFTSxPQUFPLEVBQUU7SUFDL0IsSUFBSU4sWUFBWSxFQUFFOEIsTUFBTSxFQUFFO01BQ3RCOUIsWUFBWSxDQUFDOEIsTUFBTSxDQUFDSixXQUFXLENBQUNwQixPQUFPLENBQUM7TUFDeEMsT0FBTyxJQUFJO0lBQ2Y7SUFDQSxPQUFPLEtBQUs7RUFDaEIsQ0FBQztFQUVEO0FBQ0o7QUFDQTtFQUNJNkIsdUJBQXVCQSxDQUFDbkMsWUFBWSxFQUFFTSxPQUFPLEVBQUU4QixPQUFPLEdBQUcsSUFBSSxFQUFFO0lBQzNELE9BQU8sSUFBSUMsT0FBTyxDQUFDLENBQUNDLE9BQU8sRUFBRUMsTUFBTSxLQUFLO01BQ3BDLElBQUksQ0FBQ3ZDLFlBQVksRUFBRThCLE1BQU0sRUFBRTtRQUN2QlMsTUFBTSxDQUFDLElBQUl4QyxLQUFLLENBQUMsMEJBQTBCLENBQUMsQ0FBQztRQUM3QztNQUNKO01BRUEsTUFBTXlDLGNBQWMsR0FBRyxJQUFJQyxjQUFjLENBQUMsQ0FBQztNQUMzQyxNQUFNQyxTQUFTLEdBQUdDLFVBQVUsQ0FBQyxNQUFNO1FBQy9CSixNQUFNLENBQUMsSUFBSXhDLEtBQUssQ0FBQyxpQ0FBaUMsQ0FBQyxDQUFDO01BQ3hELENBQUMsRUFBRXFDLE9BQU8sQ0FBQztNQUVYSSxjQUFjLENBQUNJLEtBQUssQ0FBQ0MsU0FBUyxHQUFJQyxLQUFLLElBQUs7UUFDeENDLFlBQVksQ0FBQ0wsU0FBUyxDQUFDO1FBQ3ZCSixPQUFPLENBQUNRLEtBQUssQ0FBQ0UsSUFBSSxDQUFDO01BQ3ZCLENBQUM7TUFFRCxJQUFJO1FBQ0FoRCxZQUFZLENBQUM4QixNQUFNLENBQUNKLFdBQVcsQ0FBQ3BCLE9BQU8sRUFBRSxDQUFDa0MsY0FBYyxDQUFDUyxLQUFLLENBQUMsQ0FBQztNQUNwRSxDQUFDLENBQUMsT0FBTzVDLEtBQUssRUFBRTtRQUNaMEMsWUFBWSxDQUFDTCxTQUFTLENBQUM7UUFDdkJILE1BQU0sQ0FBQ2xDLEtBQUssQ0FBQztNQUNqQjtJQUNKLENBQUMsQ0FBQztFQUNOLENBQUM7RUFFRDtBQUNKO0FBQ0E7RUFDSSxNQUFNNkMsbUJBQW1CQSxDQUFBLEVBQUc7SUFDeEIsSUFBSSxFQUFFLGVBQWUsSUFBSXBELFNBQVMsQ0FBQyxFQUFFLE9BQU8sRUFBRTtJQUU5QyxJQUFJO01BQ0EsT0FBTyxNQUFNQSxTQUFTLENBQUNHLGFBQWEsQ0FBQ2tELGdCQUFnQixDQUFDLENBQUM7SUFDM0QsQ0FBQyxDQUFDLE9BQU85QyxLQUFLLEVBQUU7TUFDWixPQUFPLEVBQUU7SUFDYjtFQUNKLENBQUM7RUFFRDtBQUNKO0FBQ0E7RUFDSStDLFdBQVdBLENBQUEsRUFBRztJQUNWLE9BQU8sZUFBZSxJQUFJdEQsU0FBUztFQUN2QyxDQUFDO0VBRUQ7QUFDSjtBQUNBO0VBQ0l1RCxlQUFlQSxDQUFBLEVBQUc7SUFDZCxPQUFPO01BQ0hwRCxhQUFhLEVBQUUsZUFBZSxJQUFJSCxTQUFTO01BQzNDd0QsV0FBVyxFQUFFLGFBQWEsSUFBSXBELE1BQU07TUFDcENxRCxZQUFZLEVBQUUsY0FBYyxJQUFJckQsTUFBTTtNQUN0Q3NELGNBQWMsRUFBRSxlQUFlLElBQUkxRCxTQUFTLElBQUksTUFBTSxJQUFJSSxNQUFNLENBQUN1RCx5QkFBeUIsQ0FBQ0MsU0FBUztNQUNwR0MsZUFBZSxFQUFFLGVBQWUsSUFBSTdELFNBQVMsSUFBSSxpQkFBaUIsSUFBSUksTUFBTTtNQUM1RTBELHNCQUFzQixFQUFFLGVBQWUsSUFBSTlELFNBQVMsSUFBSSxjQUFjLElBQUlJLE1BQU0sQ0FBQ3VELHlCQUF5QixDQUFDQztJQUMvRyxDQUFDO0VBQ0wsQ0FBQztFQUVEO0FBQ0o7QUFDQTtFQUNJRyxXQUFXQSxDQUFDeEQsS0FBSyxFQUFFeUQsT0FBTyxHQUFHLFNBQVMsRUFBRTtJQUNwQyxNQUFNQyxZQUFZLEdBQUcsMkJBQTJCRCxPQUFPLEtBQUt6RCxLQUFLLENBQUNDLE9BQU8sRUFBRTtJQUUzRSxJQUFJSixNQUFNLENBQUNDLFNBQVMsRUFBRUUsS0FBSyxFQUFFO01BQ3pCSCxNQUFNLENBQUNDLFNBQVMsQ0FBQ0UsS0FBSyxDQUFDLE9BQU8sRUFBRTBELFlBQVksRUFBRTFELEtBQUssQ0FBQztJQUN4RDs7SUFFQTtJQUNBSCxNQUFNLENBQUM4RCxhQUFhLENBQUMsSUFBSUMsV0FBVyxDQUFDLFVBQVUsRUFBRTtNQUM3Q0MsTUFBTSxFQUFFO1FBQUU3RCxLQUFLO1FBQUV5RCxPQUFPO1FBQUV4RCxPQUFPLEVBQUV5RDtNQUFhO0lBQ3BELENBQUMsQ0FBQyxDQUFDO0lBRUgsT0FBT0EsWUFBWTtFQUN2QixDQUFDO0VBRUQ7QUFDSjtBQUNBO0VBQ0ksTUFBTUksY0FBY0EsQ0FBQ3ZFLE1BQU0sRUFBRTtJQUN6QixJQUFJO01BQ0EsTUFBTXdFLFFBQVEsR0FBRyxNQUFNQyxLQUFLLENBQUN6RSxNQUFNLEVBQUU7UUFBRTBFLEtBQUssRUFBRTtNQUFXLENBQUMsQ0FBQztNQUMzRCxPQUFPRixRQUFRLENBQUNHLEVBQUU7SUFDdEIsQ0FBQyxDQUFDLE9BQU9sRSxLQUFLLEVBQUU7TUFDWixPQUFPLEtBQUs7SUFDaEI7RUFDSixDQUFDO0VBRUQ7QUFDSjtBQUNBO0VBQ0ltRSxxQkFBcUJBLENBQUN4RSxZQUFZLEVBQUU7SUFDaEMsSUFBSSxDQUFDQSxZQUFZLEVBQUUsT0FBTyxJQUFJO0lBRTlCLE1BQU15RSxPQUFPLEdBQUc7TUFDWkMsZ0JBQWdCLEVBQUUxRSxZQUFZLENBQUNXLFVBQVUsRUFBRWdFLFNBQVMsR0FBR0MsSUFBSSxDQUFDQyxHQUFHLENBQUMsQ0FBQyxHQUFHLElBQUk7TUFDeEVoRixLQUFLLEVBQUVHLFlBQVksQ0FBQ0gsS0FBSztNQUN6Qm1DLGNBQWMsRUFBRWhDLFlBQVksQ0FBQ2dDO0lBQ2pDLENBQUM7O0lBRUQ7SUFDQSxJQUFJOUIsTUFBTSxDQUFDNEUsV0FBVyxFQUFFQyxnQkFBZ0IsRUFBRTtNQUN0QyxNQUFNQyxpQkFBaUIsR0FBRzlFLE1BQU0sQ0FBQzRFLFdBQVcsQ0FBQ0MsZ0JBQWdCLENBQUMsWUFBWSxDQUFDO01BQzNFLElBQUlDLGlCQUFpQixDQUFDQyxNQUFNLEdBQUcsQ0FBQyxFQUFFO1FBQzlCLE1BQU1DLEtBQUssR0FBR0YsaUJBQWlCLENBQUMsQ0FBQyxDQUFDO1FBQ2xDUCxPQUFPLENBQUNVLFlBQVksR0FBR0QsS0FBSyxDQUFDRSxZQUFZLEdBQUdGLEtBQUssQ0FBQ0csY0FBYztRQUNoRVosT0FBTyxDQUFDYSxvQkFBb0IsR0FBR0osS0FBSyxDQUFDSyx3QkFBd0IsR0FBR0wsS0FBSyxDQUFDTSwwQkFBMEI7TUFDcEc7SUFDSjtJQUVBLE9BQU9mLE9BQU87RUFDbEI7QUFDSixDQUFDOztBQUVEO0FBQ0EsSUFBSSxPQUFPZ0IsTUFBTSxLQUFLLFdBQVcsSUFBSUEsTUFBTSxDQUFDQyxPQUFPLEVBQUU7RUFDakRELE1BQU0sQ0FBQ0MsT0FBTyxHQUFHO0lBQUVoRztFQUFpQixDQUFDO0FBQ3pDLENBQUMsTUFBTSxJQUFJLE9BQU9RLE1BQU0sS0FBSyxXQUFXLEVBQUU7RUFDdENBLE1BQU0sQ0FBQ1IsZ0JBQWdCLEdBQUdBLGdCQUFnQjtBQUM5QyIsImlnbm9yZUxpc3QiOltdfQ==