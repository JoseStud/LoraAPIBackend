660da3e4fb3bd3854f7aa07656013f9c
/**
 * PWA Manager - Offline Management Module
 * 
 * Handles offline detection, action queuing, and background synchronization.
 */

/**
 * Offline management and synchronization operations
 */
const pwaOffline = {
  /**
   * Initializes offline detection and management
   */
  init(callbacks = {}) {
    const state = {
      isOnline: navigator.onLine,
      queuedActions: this.loadQueuedActions(),
      callbacks
    };
    this.setupEventListeners(state);
    this.updateOnlineStatus(state.isOnline, callbacks);
    return state;
  },
  /**
   * Sets up online/offline event listeners
   */
  setupEventListeners(state) {
    const handleOnline = () => {
      state.isOnline = true;
      this.updateOnlineStatus(true, state.callbacks);
      this.syncPendingActions(state);
    };
    const handleOffline = () => {
      state.isOnline = false;
      this.updateOnlineStatus(false, state.callbacks);
    };
    const handleVisibilityChange = () => {
      if (!document.hidden && state.isOnline) {
        this.syncPendingActions(state);
      }
    };
    window.addEventListener('online', handleOnline);
    window.addEventListener('offline', handleOffline);
    document.addEventListener('visibilitychange', handleVisibilityChange);

    // Return cleanup function
    return () => {
      window.removeEventListener('online', handleOnline);
      window.removeEventListener('offline', handleOffline);
      document.removeEventListener('visibilitychange', handleVisibilityChange);
    };
  },
  /**
   * Updates online status and triggers callbacks
   */
  updateOnlineStatus(isOnline, callbacks = {}) {
    if (isOnline) {
      if (callbacks.onOnline) callbacks.onOnline();
    } else {
      if (callbacks.onOffline) callbacks.onOffline();
    }

    // Dispatch custom event
    window.dispatchEvent(new CustomEvent('pwa-connection-change', {
      detail: {
        isOnline,
        timestamp: Date.now()
      }
    }));
  },
  /**
   * Creates offline indicator UI
   */
  createOfflineIndicator(options = {}) {
    const {
      message = "You're offline. Some features may be limited.",
      className = 'pwa-offline-indicator'
    } = options;
    const indicator = document.createElement('div');
    indicator.id = 'offline-indicator';
    indicator.className = `${className} fixed top-0 left-0 right-0 bg-yellow-500 text-white text-center py-2 text-sm font-medium transform -translate-y-full transition-transform duration-300 z-50`;
    indicator.innerHTML = `
            <div class="flex items-center justify-center space-x-2">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                </svg>
                <span>${message}</span>
            </div>
        `;
    return indicator;
  },
  /**
   * Shows/hides offline indicator
   */
  toggleOfflineIndicator(show) {
    const indicator = document.getElementById('offline-indicator');
    if (!indicator) return;
    if (show) {
      indicator.classList.remove('-translate-y-full');
    } else {
      indicator.classList.add('-translate-y-full');
    }
  },
  /**
   * Loads queued actions from storage
   */
  loadQueuedActions() {
    try {
      const stored = localStorage.getItem('pwa-queued-actions');
      const actions = stored ? JSON.parse(stored) : [];
      return Array.isArray(actions) ? actions : [];
    } catch (error) {
      return [];
    }
  },
  /**
   * Saves queued actions to storage
   */
  saveQueuedActions(actions) {
    try {
      localStorage.setItem('pwa-queued-actions', JSON.stringify(actions));
      return true;
    } catch (error) {
      if (window.DevLogger?.error) {
        window.DevLogger.error('[PWA] Failed to save queued actions:', error);
      }
      return false;
    }
  },
  /**
   * Queues an action for later execution
   */
  queueAction(action, state) {
    const queuedAction = {
      id: this.generateActionId(),
      timestamp: Date.now(),
      retryCount: 0,
      ...action
    };
    if (!state) {
      // Standalone mode - load current queue
      const currentQueue = this.loadQueuedActions();
      currentQueue.push(queuedAction);
      this.saveQueuedActions(currentQueue);
      return queuedAction;
    }
    state.queuedActions.push(queuedAction);
    this.saveQueuedActions(state.queuedActions);
    return queuedAction;
  },
  /**
   * Removes an action from the queue
   */
  removeQueuedAction(actionId, state) {
    if (!state) {
      const currentQueue = this.loadQueuedActions();
      const updated = currentQueue.filter(action => action.id !== actionId);
      this.saveQueuedActions(updated);
      return updated;
    }
    state.queuedActions = state.queuedActions.filter(action => action.id !== actionId);
    this.saveQueuedActions(state.queuedActions);
    return state.queuedActions;
  },
  /**
   * Syncs pending actions when online
   */
  async syncPendingActions(state, callbacks = {}) {
    if (!state.isOnline || !state.queuedActions.length) return;
    const actionsToSync = [...state.queuedActions];
    const syncedActions = [];
    const failedActions = [];
    for (const action of actionsToSync) {
      try {
        const success = await this.executeAction(action);
        if (success) {
          syncedActions.push(action);
          this.removeQueuedAction(action.id, state);
        } else {
          action.retryCount = (action.retryCount || 0) + 1;
          if (action.retryCount >= 3) {
            failedActions.push(action);
            this.removeQueuedAction(action.id, state);
          }
        }
      } catch (error) {
        action.retryCount = (action.retryCount || 0) + 1;
        action.lastError = error.message;
        if (action.retryCount >= 3) {
          failedActions.push(action);
          this.removeQueuedAction(action.id, state);
        }
      }
    }

    // Trigger callbacks
    if (syncedActions.length > 0 && callbacks.onSyncSuccess) {
      callbacks.onSyncSuccess(syncedActions);
    }
    if (failedActions.length > 0 && callbacks.onSyncFailure) {
      callbacks.onSyncFailure(failedActions);
    }
    return {
      synced: syncedActions.length,
      failed: failedActions.length,
      remaining: state.queuedActions.length
    };
  },
  /**
   * Executes a queued action
   */
  async executeAction(action) {
    const {
      url,
      options,
      type
    } = action;
    if (type === 'fetch') {
      try {
        const response = await fetch(url, options);
        return response.ok;
      } catch (error) {
        return false;
      }
    }
    if (type === 'custom' && action.execute) {
      try {
        return await action.execute();
      } catch (error) {
        return false;
      }
    }
    return false;
  },
  /**
   * Generates a unique action ID
   */
  generateActionId() {
    return `action_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
  },
  /**
   * Intercepts fetch requests for offline handling
   */
  interceptFetch(isOnline, queueHandler) {
    const originalFetch = window.fetch;
    window.fetch = async (url, options = {}) => {
      try {
        // Always attempt the request first
        const response = await originalFetch(url, options);
        if (response.ok) {
          return response;
        }

        // If request failed and we're offline, queue it
        if (!isOnline && options.method && options.method !== 'GET') {
          queueHandler({
            url,
            options,
            type: 'fetch'
          });
          return new Response(JSON.stringify({
            success: false,
            message: 'Action queued for when connection is restored',
            offline: true,
            queued: true
          }), {
            status: 202,
            headers: {
              'Content-Type': 'application/json'
            }
          });
        }
        return response;
      } catch (error) {
        // If we're offline and this is a modifying request, queue it
        if (!isOnline && options.method && options.method !== 'GET') {
          queueHandler({
            url,
            options,
            type: 'fetch'
          });
          return new Response(JSON.stringify({
            success: false,
            message: 'Action queued for when connection is restored',
            offline: true,
            queued: true
          }), {
            status: 202,
            headers: {
              'Content-Type': 'application/json'
            }
          });
        }

        // For GET requests or when online, return offline response
        return new Response(JSON.stringify({
          success: false,
          message: 'You are offline. Please check your connection.',
          offline: true
        }), {
          status: 503,
          headers: {
            'Content-Type': 'application/json'
          }
        });
      }
    };

    // Return restore function
    return () => {
      window.fetch = originalFetch;
    };
  },
  /**
   * Gets offline status information
   */
  getOfflineStatus(state) {
    return {
      isOnline: state ? state.isOnline : navigator.onLine,
      queuedActionsCount: state ? state.queuedActions.length : this.loadQueuedActions().length,
      lastOnlineTime: this.getLastOnlineTime(),
      offlineDuration: this.getOfflineDuration(),
      connectionType: this.getConnectionType(),
      networkQuality: this.getNetworkQuality()
    };
  },
  /**
   * Gets last known online time
   */
  getLastOnlineTime() {
    const lastOnline = localStorage.getItem('pwa-last-online');
    return lastOnline ? new Date(parseInt(lastOnline)) : null;
  },
  /**
   * Sets last online time
   */
  setLastOnlineTime() {
    localStorage.setItem('pwa-last-online', Date.now().toString());
  },
  /**
   * Gets offline duration
   */
  getOfflineDuration() {
    if (navigator.onLine) return 0;
    const lastOnline = this.getLastOnlineTime();
    if (!lastOnline) return null;
    return Date.now() - lastOnline.getTime();
  },
  /**
   * Gets connection type if available
   */
  getConnectionType() {
    if ('connection' in navigator) {
      return {
        effectiveType: navigator.connection.effectiveType,
        type: navigator.connection.type,
        downlink: navigator.connection.downlink,
        rtt: navigator.connection.rtt,
        saveData: navigator.connection.saveData
      };
    }
    return null;
  },
  /**
   * Estimates network quality
   */
  getNetworkQuality() {
    if (!('connection' in navigator)) return 'unknown';
    const connection = navigator.connection;
    if (connection.effectiveType === '4g' && connection.downlink > 10) {
      return 'excellent';
    } else if (connection.effectiveType === '4g' || connection.downlink > 5) {
      return 'good';
    } else if (connection.effectiveType === '3g' || connection.downlink > 1) {
      return 'fair';
    } else {
      return 'poor';
    }
  },
  /**
   * Clears all queued actions
   */
  clearQueuedActions(state) {
    if (state) {
      state.queuedActions = [];
    }
    localStorage.removeItem('pwa-queued-actions');
  },
  /**
   * Gets queued actions summary
   */
  getQueuedActionsSummary(state) {
    const actions = state ? state.queuedActions : this.loadQueuedActions();
    const summary = {
      total: actions.length,
      byType: {},
      oldestAction: null,
      newestAction: null,
      failedActions: actions.filter(a => a.retryCount >= 3).length,
      retryingActions: actions.filter(a => a.retryCount > 0 && a.retryCount < 3).length
    };
    actions.forEach(action => {
      const type = action.type || 'unknown';
      summary.byType[type] = (summary.byType[type] || 0) + 1;
      if (!summary.oldestAction || action.timestamp < summary.oldestAction.timestamp) {
        summary.oldestAction = action;
      }
      if (!summary.newestAction || action.timestamp > summary.newestAction.timestamp) {
        summary.newestAction = action;
      }
    });
    return summary;
  }
};

// Export for use in other modules
if (typeof module !== 'undefined' && module.exports) {
  module.exports = {
    pwaOffline
  };
} else if (typeof window !== 'undefined') {
  window.pwaOffline = pwaOffline;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJwd2FPZmZsaW5lIiwiaW5pdCIsImNhbGxiYWNrcyIsInN0YXRlIiwiaXNPbmxpbmUiLCJuYXZpZ2F0b3IiLCJvbkxpbmUiLCJxdWV1ZWRBY3Rpb25zIiwibG9hZFF1ZXVlZEFjdGlvbnMiLCJzZXR1cEV2ZW50TGlzdGVuZXJzIiwidXBkYXRlT25saW5lU3RhdHVzIiwiaGFuZGxlT25saW5lIiwic3luY1BlbmRpbmdBY3Rpb25zIiwiaGFuZGxlT2ZmbGluZSIsImhhbmRsZVZpc2liaWxpdHlDaGFuZ2UiLCJkb2N1bWVudCIsImhpZGRlbiIsIndpbmRvdyIsImFkZEV2ZW50TGlzdGVuZXIiLCJyZW1vdmVFdmVudExpc3RlbmVyIiwib25PbmxpbmUiLCJvbk9mZmxpbmUiLCJkaXNwYXRjaEV2ZW50IiwiQ3VzdG9tRXZlbnQiLCJkZXRhaWwiLCJ0aW1lc3RhbXAiLCJEYXRlIiwibm93IiwiY3JlYXRlT2ZmbGluZUluZGljYXRvciIsIm9wdGlvbnMiLCJtZXNzYWdlIiwiY2xhc3NOYW1lIiwiaW5kaWNhdG9yIiwiY3JlYXRlRWxlbWVudCIsImlkIiwiaW5uZXJIVE1MIiwidG9nZ2xlT2ZmbGluZUluZGljYXRvciIsInNob3ciLCJnZXRFbGVtZW50QnlJZCIsImNsYXNzTGlzdCIsInJlbW92ZSIsImFkZCIsInN0b3JlZCIsImxvY2FsU3RvcmFnZSIsImdldEl0ZW0iLCJhY3Rpb25zIiwiSlNPTiIsInBhcnNlIiwiQXJyYXkiLCJpc0FycmF5IiwiZXJyb3IiLCJzYXZlUXVldWVkQWN0aW9ucyIsInNldEl0ZW0iLCJzdHJpbmdpZnkiLCJEZXZMb2dnZXIiLCJxdWV1ZUFjdGlvbiIsImFjdGlvbiIsInF1ZXVlZEFjdGlvbiIsImdlbmVyYXRlQWN0aW9uSWQiLCJyZXRyeUNvdW50IiwiY3VycmVudFF1ZXVlIiwicHVzaCIsInJlbW92ZVF1ZXVlZEFjdGlvbiIsImFjdGlvbklkIiwidXBkYXRlZCIsImZpbHRlciIsImxlbmd0aCIsImFjdGlvbnNUb1N5bmMiLCJzeW5jZWRBY3Rpb25zIiwiZmFpbGVkQWN0aW9ucyIsInN1Y2Nlc3MiLCJleGVjdXRlQWN0aW9uIiwibGFzdEVycm9yIiwib25TeW5jU3VjY2VzcyIsIm9uU3luY0ZhaWx1cmUiLCJzeW5jZWQiLCJmYWlsZWQiLCJyZW1haW5pbmciLCJ1cmwiLCJ0eXBlIiwicmVzcG9uc2UiLCJmZXRjaCIsIm9rIiwiZXhlY3V0ZSIsIk1hdGgiLCJyYW5kb20iLCJ0b1N0cmluZyIsInN1YnN0ciIsImludGVyY2VwdEZldGNoIiwicXVldWVIYW5kbGVyIiwib3JpZ2luYWxGZXRjaCIsIm1ldGhvZCIsIlJlc3BvbnNlIiwib2ZmbGluZSIsInF1ZXVlZCIsInN0YXR1cyIsImhlYWRlcnMiLCJnZXRPZmZsaW5lU3RhdHVzIiwicXVldWVkQWN0aW9uc0NvdW50IiwibGFzdE9ubGluZVRpbWUiLCJnZXRMYXN0T25saW5lVGltZSIsIm9mZmxpbmVEdXJhdGlvbiIsImdldE9mZmxpbmVEdXJhdGlvbiIsImNvbm5lY3Rpb25UeXBlIiwiZ2V0Q29ubmVjdGlvblR5cGUiLCJuZXR3b3JrUXVhbGl0eSIsImdldE5ldHdvcmtRdWFsaXR5IiwibGFzdE9ubGluZSIsInBhcnNlSW50Iiwic2V0TGFzdE9ubGluZVRpbWUiLCJnZXRUaW1lIiwiZWZmZWN0aXZlVHlwZSIsImNvbm5lY3Rpb24iLCJkb3dubGluayIsInJ0dCIsInNhdmVEYXRhIiwiY2xlYXJRdWV1ZWRBY3Rpb25zIiwicmVtb3ZlSXRlbSIsImdldFF1ZXVlZEFjdGlvbnNTdW1tYXJ5Iiwic3VtbWFyeSIsInRvdGFsIiwiYnlUeXBlIiwib2xkZXN0QWN0aW9uIiwibmV3ZXN0QWN0aW9uIiwiYSIsInJldHJ5aW5nQWN0aW9ucyIsImZvckVhY2giLCJtb2R1bGUiLCJleHBvcnRzIl0sInNvdXJjZXMiOlsib2ZmbGluZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIFBXQSBNYW5hZ2VyIC0gT2ZmbGluZSBNYW5hZ2VtZW50IE1vZHVsZVxuICogXG4gKiBIYW5kbGVzIG9mZmxpbmUgZGV0ZWN0aW9uLCBhY3Rpb24gcXVldWluZywgYW5kIGJhY2tncm91bmQgc3luY2hyb25pemF0aW9uLlxuICovXG5cbi8qKlxuICogT2ZmbGluZSBtYW5hZ2VtZW50IGFuZCBzeW5jaHJvbml6YXRpb24gb3BlcmF0aW9uc1xuICovXG5jb25zdCBwd2FPZmZsaW5lID0ge1xuICAgIC8qKlxuICAgICAqIEluaXRpYWxpemVzIG9mZmxpbmUgZGV0ZWN0aW9uIGFuZCBtYW5hZ2VtZW50XG4gICAgICovXG4gICAgaW5pdChjYWxsYmFja3MgPSB7fSkge1xuICAgICAgICBjb25zdCBzdGF0ZSA9IHtcbiAgICAgICAgICAgIGlzT25saW5lOiBuYXZpZ2F0b3Iub25MaW5lLFxuICAgICAgICAgICAgcXVldWVkQWN0aW9uczogdGhpcy5sb2FkUXVldWVkQWN0aW9ucygpLFxuICAgICAgICAgICAgY2FsbGJhY2tzXG4gICAgICAgIH07XG4gICAgICAgIFxuICAgICAgICB0aGlzLnNldHVwRXZlbnRMaXN0ZW5lcnMoc3RhdGUpO1xuICAgICAgICB0aGlzLnVwZGF0ZU9ubGluZVN0YXR1cyhzdGF0ZS5pc09ubGluZSwgY2FsbGJhY2tzKTtcbiAgICAgICAgXG4gICAgICAgIHJldHVybiBzdGF0ZTtcbiAgICB9LFxuICAgIFxuICAgIC8qKlxuICAgICAqIFNldHMgdXAgb25saW5lL29mZmxpbmUgZXZlbnQgbGlzdGVuZXJzXG4gICAgICovXG4gICAgc2V0dXBFdmVudExpc3RlbmVycyhzdGF0ZSkge1xuICAgICAgICBjb25zdCBoYW5kbGVPbmxpbmUgPSAoKSA9PiB7XG4gICAgICAgICAgICBzdGF0ZS5pc09ubGluZSA9IHRydWU7XG4gICAgICAgICAgICB0aGlzLnVwZGF0ZU9ubGluZVN0YXR1cyh0cnVlLCBzdGF0ZS5jYWxsYmFja3MpO1xuICAgICAgICAgICAgdGhpcy5zeW5jUGVuZGluZ0FjdGlvbnMoc3RhdGUpO1xuICAgICAgICB9O1xuICAgICAgICBcbiAgICAgICAgY29uc3QgaGFuZGxlT2ZmbGluZSA9ICgpID0+IHtcbiAgICAgICAgICAgIHN0YXRlLmlzT25saW5lID0gZmFsc2U7XG4gICAgICAgICAgICB0aGlzLnVwZGF0ZU9ubGluZVN0YXR1cyhmYWxzZSwgc3RhdGUuY2FsbGJhY2tzKTtcbiAgICAgICAgfTtcbiAgICAgICAgXG4gICAgICAgIGNvbnN0IGhhbmRsZVZpc2liaWxpdHlDaGFuZ2UgPSAoKSA9PiB7XG4gICAgICAgICAgICBpZiAoIWRvY3VtZW50LmhpZGRlbiAmJiBzdGF0ZS5pc09ubGluZSkge1xuICAgICAgICAgICAgICAgIHRoaXMuc3luY1BlbmRpbmdBY3Rpb25zKHN0YXRlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgXG4gICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdvbmxpbmUnLCBoYW5kbGVPbmxpbmUpO1xuICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignb2ZmbGluZScsIGhhbmRsZU9mZmxpbmUpO1xuICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCd2aXNpYmlsaXR5Y2hhbmdlJywgaGFuZGxlVmlzaWJpbGl0eUNoYW5nZSk7XG4gICAgICAgIFxuICAgICAgICAvLyBSZXR1cm4gY2xlYW51cCBmdW5jdGlvblxuICAgICAgICByZXR1cm4gKCkgPT4ge1xuICAgICAgICAgICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ29ubGluZScsIGhhbmRsZU9ubGluZSk7XG4gICAgICAgICAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcignb2ZmbGluZScsIGhhbmRsZU9mZmxpbmUpO1xuICAgICAgICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcigndmlzaWJpbGl0eWNoYW5nZScsIGhhbmRsZVZpc2liaWxpdHlDaGFuZ2UpO1xuICAgICAgICB9O1xuICAgIH0sXG4gICAgXG4gICAgLyoqXG4gICAgICogVXBkYXRlcyBvbmxpbmUgc3RhdHVzIGFuZCB0cmlnZ2VycyBjYWxsYmFja3NcbiAgICAgKi9cbiAgICB1cGRhdGVPbmxpbmVTdGF0dXMoaXNPbmxpbmUsIGNhbGxiYWNrcyA9IHt9KSB7XG4gICAgICAgIGlmIChpc09ubGluZSkge1xuICAgICAgICAgICAgaWYgKGNhbGxiYWNrcy5vbk9ubGluZSkgY2FsbGJhY2tzLm9uT25saW5lKCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpZiAoY2FsbGJhY2tzLm9uT2ZmbGluZSkgY2FsbGJhY2tzLm9uT2ZmbGluZSgpO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICAvLyBEaXNwYXRjaCBjdXN0b20gZXZlbnRcbiAgICAgICAgd2luZG93LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCdwd2EtY29ubmVjdGlvbi1jaGFuZ2UnLCB7XG4gICAgICAgICAgICBkZXRhaWw6IHsgaXNPbmxpbmUsIHRpbWVzdGFtcDogRGF0ZS5ub3coKSB9XG4gICAgICAgIH0pKTtcbiAgICB9LFxuICAgIFxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgb2ZmbGluZSBpbmRpY2F0b3IgVUlcbiAgICAgKi9cbiAgICBjcmVhdGVPZmZsaW5lSW5kaWNhdG9yKG9wdGlvbnMgPSB7fSkge1xuICAgICAgICBjb25zdCB7XG4gICAgICAgICAgICBtZXNzYWdlID0gXCJZb3UncmUgb2ZmbGluZS4gU29tZSBmZWF0dXJlcyBtYXkgYmUgbGltaXRlZC5cIixcbiAgICAgICAgICAgIGNsYXNzTmFtZSA9ICdwd2Etb2ZmbGluZS1pbmRpY2F0b3InXG4gICAgICAgIH0gPSBvcHRpb25zO1xuICAgICAgICBcbiAgICAgICAgY29uc3QgaW5kaWNhdG9yID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgIGluZGljYXRvci5pZCA9ICdvZmZsaW5lLWluZGljYXRvcic7XG4gICAgICAgIGluZGljYXRvci5jbGFzc05hbWUgPSBgJHtjbGFzc05hbWV9IGZpeGVkIHRvcC0wIGxlZnQtMCByaWdodC0wIGJnLXllbGxvdy01MDAgdGV4dC13aGl0ZSB0ZXh0LWNlbnRlciBweS0yIHRleHQtc20gZm9udC1tZWRpdW0gdHJhbnNmb3JtIC10cmFuc2xhdGUteS1mdWxsIHRyYW5zaXRpb24tdHJhbnNmb3JtIGR1cmF0aW9uLTMwMCB6LTUwYDtcbiAgICAgICAgXG4gICAgICAgIGluZGljYXRvci5pbm5lckhUTUwgPSBgXG4gICAgICAgICAgICA8ZGl2IGNsYXNzPVwiZmxleCBpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXIgc3BhY2UteC0yXCI+XG4gICAgICAgICAgICAgICAgPHN2ZyBjbGFzcz1cInctNCBoLTRcIiBmaWxsPVwibm9uZVwiIHN0cm9rZT1cImN1cnJlbnRDb2xvclwiIHZpZXdCb3g9XCIwIDAgMjQgMjRcIj5cbiAgICAgICAgICAgICAgICAgICAgPHBhdGggc3Ryb2tlLWxpbmVjYXA9XCJyb3VuZFwiIHN0cm9rZS1saW5lam9pbj1cInJvdW5kXCIgc3Ryb2tlLXdpZHRoPVwiMlwiIGQ9XCJNMTIgOXYybTAgNGguMDFtLTYuOTM4IDRoMTMuODU2YzEuNTQgMCAyLjUwMi0xLjY2NyAxLjczMi0yLjVMMTMuNzMyIDRjLS43Ny0uODMzLTEuOTY0LS44MzMtMi43MzIgMEw0LjA4MiAxNi41Yy0uNzcuODMzLjE5MiAyLjUgMS43MzIgMi41elwiPjwvcGF0aD5cbiAgICAgICAgICAgICAgICA8L3N2Zz5cbiAgICAgICAgICAgICAgICA8c3Bhbj4ke21lc3NhZ2V9PC9zcGFuPlxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgIGA7XG4gICAgICAgIFxuICAgICAgICByZXR1cm4gaW5kaWNhdG9yO1xuICAgIH0sXG4gICAgXG4gICAgLyoqXG4gICAgICogU2hvd3MvaGlkZXMgb2ZmbGluZSBpbmRpY2F0b3JcbiAgICAgKi9cbiAgICB0b2dnbGVPZmZsaW5lSW5kaWNhdG9yKHNob3cpIHtcbiAgICAgICAgY29uc3QgaW5kaWNhdG9yID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ29mZmxpbmUtaW5kaWNhdG9yJyk7XG4gICAgICAgIGlmICghaW5kaWNhdG9yKSByZXR1cm47XG4gICAgICAgIFxuICAgICAgICBpZiAoc2hvdykge1xuICAgICAgICAgICAgaW5kaWNhdG9yLmNsYXNzTGlzdC5yZW1vdmUoJy10cmFuc2xhdGUteS1mdWxsJyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpbmRpY2F0b3IuY2xhc3NMaXN0LmFkZCgnLXRyYW5zbGF0ZS15LWZ1bGwnKTtcbiAgICAgICAgfVxuICAgIH0sXG4gICAgXG4gICAgLyoqXG4gICAgICogTG9hZHMgcXVldWVkIGFjdGlvbnMgZnJvbSBzdG9yYWdlXG4gICAgICovXG4gICAgbG9hZFF1ZXVlZEFjdGlvbnMoKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCBzdG9yZWQgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgncHdhLXF1ZXVlZC1hY3Rpb25zJyk7XG4gICAgICAgICAgICBjb25zdCBhY3Rpb25zID0gc3RvcmVkID8gSlNPTi5wYXJzZShzdG9yZWQpIDogW107XG4gICAgICAgICAgICByZXR1cm4gQXJyYXkuaXNBcnJheShhY3Rpb25zKSA/IGFjdGlvbnMgOiBbXTtcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgICAgfVxuICAgIH0sXG4gICAgXG4gICAgLyoqXG4gICAgICogU2F2ZXMgcXVldWVkIGFjdGlvbnMgdG8gc3RvcmFnZVxuICAgICAqL1xuICAgIHNhdmVRdWV1ZWRBY3Rpb25zKGFjdGlvbnMpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdwd2EtcXVldWVkLWFjdGlvbnMnLCBKU09OLnN0cmluZ2lmeShhY3Rpb25zKSk7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIGlmICh3aW5kb3cuRGV2TG9nZ2VyPy5lcnJvcikge1xuICAgICAgICAgICAgICAgIHdpbmRvdy5EZXZMb2dnZXIuZXJyb3IoJ1tQV0FdIEZhaWxlZCB0byBzYXZlIHF1ZXVlZCBhY3Rpb25zOicsIGVycm9yKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgIH0sXG4gICAgXG4gICAgLyoqXG4gICAgICogUXVldWVzIGFuIGFjdGlvbiBmb3IgbGF0ZXIgZXhlY3V0aW9uXG4gICAgICovXG4gICAgcXVldWVBY3Rpb24oYWN0aW9uLCBzdGF0ZSkge1xuICAgICAgICBjb25zdCBxdWV1ZWRBY3Rpb24gPSB7XG4gICAgICAgICAgICBpZDogdGhpcy5nZW5lcmF0ZUFjdGlvbklkKCksXG4gICAgICAgICAgICB0aW1lc3RhbXA6IERhdGUubm93KCksXG4gICAgICAgICAgICByZXRyeUNvdW50OiAwLFxuICAgICAgICAgICAgLi4uYWN0aW9uXG4gICAgICAgIH07XG4gICAgICAgIFxuICAgICAgICBpZiAoIXN0YXRlKSB7XG4gICAgICAgICAgICAvLyBTdGFuZGFsb25lIG1vZGUgLSBsb2FkIGN1cnJlbnQgcXVldWVcbiAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRRdWV1ZSA9IHRoaXMubG9hZFF1ZXVlZEFjdGlvbnMoKTtcbiAgICAgICAgICAgIGN1cnJlbnRRdWV1ZS5wdXNoKHF1ZXVlZEFjdGlvbik7XG4gICAgICAgICAgICB0aGlzLnNhdmVRdWV1ZWRBY3Rpb25zKGN1cnJlbnRRdWV1ZSk7XG4gICAgICAgICAgICByZXR1cm4gcXVldWVkQWN0aW9uO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBzdGF0ZS5xdWV1ZWRBY3Rpb25zLnB1c2gocXVldWVkQWN0aW9uKTtcbiAgICAgICAgdGhpcy5zYXZlUXVldWVkQWN0aW9ucyhzdGF0ZS5xdWV1ZWRBY3Rpb25zKTtcbiAgICAgICAgXG4gICAgICAgIHJldHVybiBxdWV1ZWRBY3Rpb247XG4gICAgfSxcbiAgICBcbiAgICAvKipcbiAgICAgKiBSZW1vdmVzIGFuIGFjdGlvbiBmcm9tIHRoZSBxdWV1ZVxuICAgICAqL1xuICAgIHJlbW92ZVF1ZXVlZEFjdGlvbihhY3Rpb25JZCwgc3RhdGUpIHtcbiAgICAgICAgaWYgKCFzdGF0ZSkge1xuICAgICAgICAgICAgY29uc3QgY3VycmVudFF1ZXVlID0gdGhpcy5sb2FkUXVldWVkQWN0aW9ucygpO1xuICAgICAgICAgICAgY29uc3QgdXBkYXRlZCA9IGN1cnJlbnRRdWV1ZS5maWx0ZXIoYWN0aW9uID0+IGFjdGlvbi5pZCAhPT0gYWN0aW9uSWQpO1xuICAgICAgICAgICAgdGhpcy5zYXZlUXVldWVkQWN0aW9ucyh1cGRhdGVkKTtcbiAgICAgICAgICAgIHJldHVybiB1cGRhdGVkO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBzdGF0ZS5xdWV1ZWRBY3Rpb25zID0gc3RhdGUucXVldWVkQWN0aW9ucy5maWx0ZXIoYWN0aW9uID0+IGFjdGlvbi5pZCAhPT0gYWN0aW9uSWQpO1xuICAgICAgICB0aGlzLnNhdmVRdWV1ZWRBY3Rpb25zKHN0YXRlLnF1ZXVlZEFjdGlvbnMpO1xuICAgICAgICBcbiAgICAgICAgcmV0dXJuIHN0YXRlLnF1ZXVlZEFjdGlvbnM7XG4gICAgfSxcbiAgICBcbiAgICAvKipcbiAgICAgKiBTeW5jcyBwZW5kaW5nIGFjdGlvbnMgd2hlbiBvbmxpbmVcbiAgICAgKi9cbiAgICBhc3luYyBzeW5jUGVuZGluZ0FjdGlvbnMoc3RhdGUsIGNhbGxiYWNrcyA9IHt9KSB7XG4gICAgICAgIGlmICghc3RhdGUuaXNPbmxpbmUgfHwgIXN0YXRlLnF1ZXVlZEFjdGlvbnMubGVuZ3RoKSByZXR1cm47XG4gICAgICAgIFxuICAgICAgICBjb25zdCBhY3Rpb25zVG9TeW5jID0gWy4uLnN0YXRlLnF1ZXVlZEFjdGlvbnNdO1xuICAgICAgICBjb25zdCBzeW5jZWRBY3Rpb25zID0gW107XG4gICAgICAgIGNvbnN0IGZhaWxlZEFjdGlvbnMgPSBbXTtcbiAgICAgICAgXG4gICAgICAgIGZvciAoY29uc3QgYWN0aW9uIG9mIGFjdGlvbnNUb1N5bmMpIHtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgY29uc3Qgc3VjY2VzcyA9IGF3YWl0IHRoaXMuZXhlY3V0ZUFjdGlvbihhY3Rpb24pO1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIGlmIChzdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgICAgIHN5bmNlZEFjdGlvbnMucHVzaChhY3Rpb24pO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnJlbW92ZVF1ZXVlZEFjdGlvbihhY3Rpb24uaWQsIHN0YXRlKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBhY3Rpb24ucmV0cnlDb3VudCA9IChhY3Rpb24ucmV0cnlDb3VudCB8fCAwKSArIDE7XG4gICAgICAgICAgICAgICAgICAgIGlmIChhY3Rpb24ucmV0cnlDb3VudCA+PSAzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmYWlsZWRBY3Rpb25zLnB1c2goYWN0aW9uKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucmVtb3ZlUXVldWVkQWN0aW9uKGFjdGlvbi5pZCwgc3RhdGUpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICBhY3Rpb24ucmV0cnlDb3VudCA9IChhY3Rpb24ucmV0cnlDb3VudCB8fCAwKSArIDE7XG4gICAgICAgICAgICAgICAgYWN0aW9uLmxhc3RFcnJvciA9IGVycm9yLm1lc3NhZ2U7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgaWYgKGFjdGlvbi5yZXRyeUNvdW50ID49IDMpIHtcbiAgICAgICAgICAgICAgICAgICAgZmFpbGVkQWN0aW9ucy5wdXNoKGFjdGlvbik7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucmVtb3ZlUXVldWVkQWN0aW9uKGFjdGlvbi5pZCwgc3RhdGUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgLy8gVHJpZ2dlciBjYWxsYmFja3NcbiAgICAgICAgaWYgKHN5bmNlZEFjdGlvbnMubGVuZ3RoID4gMCAmJiBjYWxsYmFja3Mub25TeW5jU3VjY2Vzcykge1xuICAgICAgICAgICAgY2FsbGJhY2tzLm9uU3luY1N1Y2Nlc3Moc3luY2VkQWN0aW9ucyk7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGlmIChmYWlsZWRBY3Rpb25zLmxlbmd0aCA+IDAgJiYgY2FsbGJhY2tzLm9uU3luY0ZhaWx1cmUpIHtcbiAgICAgICAgICAgIGNhbGxiYWNrcy5vblN5bmNGYWlsdXJlKGZhaWxlZEFjdGlvbnMpO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgc3luY2VkOiBzeW5jZWRBY3Rpb25zLmxlbmd0aCxcbiAgICAgICAgICAgIGZhaWxlZDogZmFpbGVkQWN0aW9ucy5sZW5ndGgsXG4gICAgICAgICAgICByZW1haW5pbmc6IHN0YXRlLnF1ZXVlZEFjdGlvbnMubGVuZ3RoXG4gICAgICAgIH07XG4gICAgfSxcbiAgICBcbiAgICAvKipcbiAgICAgKiBFeGVjdXRlcyBhIHF1ZXVlZCBhY3Rpb25cbiAgICAgKi9cbiAgICBhc3luYyBleGVjdXRlQWN0aW9uKGFjdGlvbikge1xuICAgICAgICBjb25zdCB7IHVybCwgb3B0aW9ucywgdHlwZSB9ID0gYWN0aW9uO1xuICAgICAgICBcbiAgICAgICAgaWYgKHR5cGUgPT09ICdmZXRjaCcpIHtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaCh1cmwsIG9wdGlvbnMpO1xuICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5vaztcbiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBpZiAodHlwZSA9PT0gJ2N1c3RvbScgJiYgYWN0aW9uLmV4ZWN1dGUpIHtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGF3YWl0IGFjdGlvbi5leGVjdXRlKCk7XG4gICAgICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH0sXG4gICAgXG4gICAgLyoqXG4gICAgICogR2VuZXJhdGVzIGEgdW5pcXVlIGFjdGlvbiBJRFxuICAgICAqL1xuICAgIGdlbmVyYXRlQWN0aW9uSWQoKSB7XG4gICAgICAgIHJldHVybiBgYWN0aW9uXyR7RGF0ZS5ub3coKX1fJHtNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zdWJzdHIoMiwgOSl9YDtcbiAgICB9LFxuICAgIFxuICAgIC8qKlxuICAgICAqIEludGVyY2VwdHMgZmV0Y2ggcmVxdWVzdHMgZm9yIG9mZmxpbmUgaGFuZGxpbmdcbiAgICAgKi9cbiAgICBpbnRlcmNlcHRGZXRjaChpc09ubGluZSwgcXVldWVIYW5kbGVyKSB7XG4gICAgICAgIGNvbnN0IG9yaWdpbmFsRmV0Y2ggPSB3aW5kb3cuZmV0Y2g7XG4gICAgICAgIFxuICAgICAgICB3aW5kb3cuZmV0Y2ggPSBhc3luYyAodXJsLCBvcHRpb25zID0ge30pID0+IHtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgLy8gQWx3YXlzIGF0dGVtcHQgdGhlIHJlcXVlc3QgZmlyc3RcbiAgICAgICAgICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IG9yaWdpbmFsRmV0Y2godXJsLCBvcHRpb25zKTtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2Uub2spIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAvLyBJZiByZXF1ZXN0IGZhaWxlZCBhbmQgd2UncmUgb2ZmbGluZSwgcXVldWUgaXRcbiAgICAgICAgICAgICAgICBpZiAoIWlzT25saW5lICYmIG9wdGlvbnMubWV0aG9kICYmIG9wdGlvbnMubWV0aG9kICE9PSAnR0VUJykge1xuICAgICAgICAgICAgICAgICAgICBxdWV1ZUhhbmRsZXIoeyB1cmwsIG9wdGlvbnMsIHR5cGU6ICdmZXRjaCcgfSk7XG4gICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFJlc3BvbnNlKEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogJ0FjdGlvbiBxdWV1ZWQgZm9yIHdoZW4gY29ubmVjdGlvbiBpcyByZXN0b3JlZCcsXG4gICAgICAgICAgICAgICAgICAgICAgICBvZmZsaW5lOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgcXVldWVkOiB0cnVlXG4gICAgICAgICAgICAgICAgICAgIH0pLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzdGF0dXM6IDIwMixcbiAgICAgICAgICAgICAgICAgICAgICAgIGhlYWRlcnM6IHsgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2U7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgICAgIC8vIElmIHdlJ3JlIG9mZmxpbmUgYW5kIHRoaXMgaXMgYSBtb2RpZnlpbmcgcmVxdWVzdCwgcXVldWUgaXRcbiAgICAgICAgICAgICAgICBpZiAoIWlzT25saW5lICYmIG9wdGlvbnMubWV0aG9kICYmIG9wdGlvbnMubWV0aG9kICE9PSAnR0VUJykge1xuICAgICAgICAgICAgICAgICAgICBxdWV1ZUhhbmRsZXIoeyB1cmwsIG9wdGlvbnMsIHR5cGU6ICdmZXRjaCcgfSk7XG4gICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFJlc3BvbnNlKEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogJ0FjdGlvbiBxdWV1ZWQgZm9yIHdoZW4gY29ubmVjdGlvbiBpcyByZXN0b3JlZCcsXG4gICAgICAgICAgICAgICAgICAgICAgICBvZmZsaW5lOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgcXVldWVkOiB0cnVlXG4gICAgICAgICAgICAgICAgICAgIH0pLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzdGF0dXM6IDIwMixcbiAgICAgICAgICAgICAgICAgICAgICAgIGhlYWRlcnM6IHsgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAvLyBGb3IgR0VUIHJlcXVlc3RzIG9yIHdoZW4gb25saW5lLCByZXR1cm4gb2ZmbGluZSByZXNwb25zZVxuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgUmVzcG9uc2UoSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICAgICAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogJ1lvdSBhcmUgb2ZmbGluZS4gUGxlYXNlIGNoZWNrIHlvdXIgY29ubmVjdGlvbi4nLFxuICAgICAgICAgICAgICAgICAgICBvZmZsaW5lOiB0cnVlXG4gICAgICAgICAgICAgICAgfSksIHtcbiAgICAgICAgICAgICAgICAgICAgc3RhdHVzOiA1MDMsXG4gICAgICAgICAgICAgICAgICAgIGhlYWRlcnM6IHsgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIFxuICAgICAgICAvLyBSZXR1cm4gcmVzdG9yZSBmdW5jdGlvblxuICAgICAgICByZXR1cm4gKCkgPT4ge1xuICAgICAgICAgICAgd2luZG93LmZldGNoID0gb3JpZ2luYWxGZXRjaDtcbiAgICAgICAgfTtcbiAgICB9LFxuICAgIFxuICAgIC8qKlxuICAgICAqIEdldHMgb2ZmbGluZSBzdGF0dXMgaW5mb3JtYXRpb25cbiAgICAgKi9cbiAgICBnZXRPZmZsaW5lU3RhdHVzKHN0YXRlKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBpc09ubGluZTogc3RhdGUgPyBzdGF0ZS5pc09ubGluZSA6IG5hdmlnYXRvci5vbkxpbmUsXG4gICAgICAgICAgICBxdWV1ZWRBY3Rpb25zQ291bnQ6IHN0YXRlID8gc3RhdGUucXVldWVkQWN0aW9ucy5sZW5ndGggOiB0aGlzLmxvYWRRdWV1ZWRBY3Rpb25zKCkubGVuZ3RoLFxuICAgICAgICAgICAgbGFzdE9ubGluZVRpbWU6IHRoaXMuZ2V0TGFzdE9ubGluZVRpbWUoKSxcbiAgICAgICAgICAgIG9mZmxpbmVEdXJhdGlvbjogdGhpcy5nZXRPZmZsaW5lRHVyYXRpb24oKSxcbiAgICAgICAgICAgIGNvbm5lY3Rpb25UeXBlOiB0aGlzLmdldENvbm5lY3Rpb25UeXBlKCksXG4gICAgICAgICAgICBuZXR3b3JrUXVhbGl0eTogdGhpcy5nZXROZXR3b3JrUXVhbGl0eSgpXG4gICAgICAgIH07XG4gICAgfSxcbiAgICBcbiAgICAvKipcbiAgICAgKiBHZXRzIGxhc3Qga25vd24gb25saW5lIHRpbWVcbiAgICAgKi9cbiAgICBnZXRMYXN0T25saW5lVGltZSgpIHtcbiAgICAgICAgY29uc3QgbGFzdE9ubGluZSA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdwd2EtbGFzdC1vbmxpbmUnKTtcbiAgICAgICAgcmV0dXJuIGxhc3RPbmxpbmUgPyBuZXcgRGF0ZShwYXJzZUludChsYXN0T25saW5lKSkgOiBudWxsO1xuICAgIH0sXG4gICAgXG4gICAgLyoqXG4gICAgICogU2V0cyBsYXN0IG9ubGluZSB0aW1lXG4gICAgICovXG4gICAgc2V0TGFzdE9ubGluZVRpbWUoKSB7XG4gICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdwd2EtbGFzdC1vbmxpbmUnLCBEYXRlLm5vdygpLnRvU3RyaW5nKCkpO1xuICAgIH0sXG4gICAgXG4gICAgLyoqXG4gICAgICogR2V0cyBvZmZsaW5lIGR1cmF0aW9uXG4gICAgICovXG4gICAgZ2V0T2ZmbGluZUR1cmF0aW9uKCkge1xuICAgICAgICBpZiAobmF2aWdhdG9yLm9uTGluZSkgcmV0dXJuIDA7XG4gICAgICAgIFxuICAgICAgICBjb25zdCBsYXN0T25saW5lID0gdGhpcy5nZXRMYXN0T25saW5lVGltZSgpO1xuICAgICAgICBpZiAoIWxhc3RPbmxpbmUpIHJldHVybiBudWxsO1xuICAgICAgICBcbiAgICAgICAgcmV0dXJuIERhdGUubm93KCkgLSBsYXN0T25saW5lLmdldFRpbWUoKTtcbiAgICB9LFxuICAgIFxuICAgIC8qKlxuICAgICAqIEdldHMgY29ubmVjdGlvbiB0eXBlIGlmIGF2YWlsYWJsZVxuICAgICAqL1xuICAgIGdldENvbm5lY3Rpb25UeXBlKCkge1xuICAgICAgICBpZiAoJ2Nvbm5lY3Rpb24nIGluIG5hdmlnYXRvcikge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBlZmZlY3RpdmVUeXBlOiBuYXZpZ2F0b3IuY29ubmVjdGlvbi5lZmZlY3RpdmVUeXBlLFxuICAgICAgICAgICAgICAgIHR5cGU6IG5hdmlnYXRvci5jb25uZWN0aW9uLnR5cGUsXG4gICAgICAgICAgICAgICAgZG93bmxpbms6IG5hdmlnYXRvci5jb25uZWN0aW9uLmRvd25saW5rLFxuICAgICAgICAgICAgICAgIHJ0dDogbmF2aWdhdG9yLmNvbm5lY3Rpb24ucnR0LFxuICAgICAgICAgICAgICAgIHNhdmVEYXRhOiBuYXZpZ2F0b3IuY29ubmVjdGlvbi5zYXZlRGF0YVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9LFxuICAgIFxuICAgIC8qKlxuICAgICAqIEVzdGltYXRlcyBuZXR3b3JrIHF1YWxpdHlcbiAgICAgKi9cbiAgICBnZXROZXR3b3JrUXVhbGl0eSgpIHtcbiAgICAgICAgaWYgKCEoJ2Nvbm5lY3Rpb24nIGluIG5hdmlnYXRvcikpIHJldHVybiAndW5rbm93bic7XG4gICAgICAgIFxuICAgICAgICBjb25zdCBjb25uZWN0aW9uID0gbmF2aWdhdG9yLmNvbm5lY3Rpb247XG4gICAgICAgIFxuICAgICAgICBpZiAoY29ubmVjdGlvbi5lZmZlY3RpdmVUeXBlID09PSAnNGcnICYmIGNvbm5lY3Rpb24uZG93bmxpbmsgPiAxMCkge1xuICAgICAgICAgICAgcmV0dXJuICdleGNlbGxlbnQnO1xuICAgICAgICB9IGVsc2UgaWYgKGNvbm5lY3Rpb24uZWZmZWN0aXZlVHlwZSA9PT0gJzRnJyB8fCBjb25uZWN0aW9uLmRvd25saW5rID4gNSkge1xuICAgICAgICAgICAgcmV0dXJuICdnb29kJztcbiAgICAgICAgfSBlbHNlIGlmIChjb25uZWN0aW9uLmVmZmVjdGl2ZVR5cGUgPT09ICczZycgfHwgY29ubmVjdGlvbi5kb3dubGluayA+IDEpIHtcbiAgICAgICAgICAgIHJldHVybiAnZmFpcic7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gJ3Bvb3InO1xuICAgICAgICB9XG4gICAgfSxcbiAgICBcbiAgICAvKipcbiAgICAgKiBDbGVhcnMgYWxsIHF1ZXVlZCBhY3Rpb25zXG4gICAgICovXG4gICAgY2xlYXJRdWV1ZWRBY3Rpb25zKHN0YXRlKSB7XG4gICAgICAgIGlmIChzdGF0ZSkge1xuICAgICAgICAgICAgc3RhdGUucXVldWVkQWN0aW9ucyA9IFtdO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSgncHdhLXF1ZXVlZC1hY3Rpb25zJyk7XG4gICAgfSxcbiAgICBcbiAgICAvKipcbiAgICAgKiBHZXRzIHF1ZXVlZCBhY3Rpb25zIHN1bW1hcnlcbiAgICAgKi9cbiAgICBnZXRRdWV1ZWRBY3Rpb25zU3VtbWFyeShzdGF0ZSkge1xuICAgICAgICBjb25zdCBhY3Rpb25zID0gc3RhdGUgPyBzdGF0ZS5xdWV1ZWRBY3Rpb25zIDogdGhpcy5sb2FkUXVldWVkQWN0aW9ucygpO1xuICAgICAgICBcbiAgICAgICAgY29uc3Qgc3VtbWFyeSA9IHtcbiAgICAgICAgICAgIHRvdGFsOiBhY3Rpb25zLmxlbmd0aCxcbiAgICAgICAgICAgIGJ5VHlwZToge30sXG4gICAgICAgICAgICBvbGRlc3RBY3Rpb246IG51bGwsXG4gICAgICAgICAgICBuZXdlc3RBY3Rpb246IG51bGwsXG4gICAgICAgICAgICBmYWlsZWRBY3Rpb25zOiBhY3Rpb25zLmZpbHRlcihhID0+IGEucmV0cnlDb3VudCA+PSAzKS5sZW5ndGgsXG4gICAgICAgICAgICByZXRyeWluZ0FjdGlvbnM6IGFjdGlvbnMuZmlsdGVyKGEgPT4gYS5yZXRyeUNvdW50ID4gMCAmJiBhLnJldHJ5Q291bnQgPCAzKS5sZW5ndGhcbiAgICAgICAgfTtcbiAgICAgICAgXG4gICAgICAgIGFjdGlvbnMuZm9yRWFjaChhY3Rpb24gPT4ge1xuICAgICAgICAgICAgY29uc3QgdHlwZSA9IGFjdGlvbi50eXBlIHx8ICd1bmtub3duJztcbiAgICAgICAgICAgIHN1bW1hcnkuYnlUeXBlW3R5cGVdID0gKHN1bW1hcnkuYnlUeXBlW3R5cGVdIHx8IDApICsgMTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgaWYgKCFzdW1tYXJ5Lm9sZGVzdEFjdGlvbiB8fCBhY3Rpb24udGltZXN0YW1wIDwgc3VtbWFyeS5vbGRlc3RBY3Rpb24udGltZXN0YW1wKSB7XG4gICAgICAgICAgICAgICAgc3VtbWFyeS5vbGRlc3RBY3Rpb24gPSBhY3Rpb247XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGlmICghc3VtbWFyeS5uZXdlc3RBY3Rpb24gfHwgYWN0aW9uLnRpbWVzdGFtcCA+IHN1bW1hcnkubmV3ZXN0QWN0aW9uLnRpbWVzdGFtcCkge1xuICAgICAgICAgICAgICAgIHN1bW1hcnkubmV3ZXN0QWN0aW9uID0gYWN0aW9uO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgXG4gICAgICAgIHJldHVybiBzdW1tYXJ5O1xuICAgIH1cbn07XG5cbi8vIEV4cG9ydCBmb3IgdXNlIGluIG90aGVyIG1vZHVsZXNcbmlmICh0eXBlb2YgbW9kdWxlICE9PSAndW5kZWZpbmVkJyAmJiBtb2R1bGUuZXhwb3J0cykge1xuICAgIG1vZHVsZS5leHBvcnRzID0geyBwd2FPZmZsaW5lIH07XG59IGVsc2UgaWYgKHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgd2luZG93LnB3YU9mZmxpbmUgPSBwd2FPZmZsaW5lO1xufVxuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLE1BQU1BLFVBQVUsR0FBRztFQUNmO0FBQ0o7QUFDQTtFQUNJQyxJQUFJQSxDQUFDQyxTQUFTLEdBQUcsQ0FBQyxDQUFDLEVBQUU7SUFDakIsTUFBTUMsS0FBSyxHQUFHO01BQ1ZDLFFBQVEsRUFBRUMsU0FBUyxDQUFDQyxNQUFNO01BQzFCQyxhQUFhLEVBQUUsSUFBSSxDQUFDQyxpQkFBaUIsQ0FBQyxDQUFDO01BQ3ZDTjtJQUNKLENBQUM7SUFFRCxJQUFJLENBQUNPLG1C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