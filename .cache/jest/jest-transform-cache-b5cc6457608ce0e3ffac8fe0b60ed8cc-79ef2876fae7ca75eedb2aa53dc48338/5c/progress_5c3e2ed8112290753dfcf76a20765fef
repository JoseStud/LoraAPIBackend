3fd6c7e11f7a8c32dcfeda68592d2881
/**
 * Generation Studio - Progress Tracking Module
 * 
 * Handles job progress updates, ETA calculations, and progress visualization.
 */

/**
 * Progress tracking for generation jobs
 */
const generationProgress = {
  /**
   * Updates job progress with validation
   */
  updateJobProgress(job, progressData) {
    if (!job || !progressData) {
      return null;
    }
    const validatedProgress = this.validateProgressData(progressData);
    const updatedJob = {
      ...job
    };

    // Update basic progress info
    updatedJob.progress = validatedProgress.progress;
    updatedJob.status = validatedProgress.status;
    updatedJob.current_step = validatedProgress.currentStep;
    updatedJob.total_steps = validatedProgress.totalSteps || job.total_steps;

    // Handle status-specific updates
    if (validatedProgress.status === 'processing') {
      updatedJob.start_time = updatedJob.start_time || Date.now();
      updatedJob.eta = this.calculateETA(updatedJob, validatedProgress.progress);
      updatedJob.speed = this.calculateGenerationSpeed(updatedJob);
    } else if (validatedProgress.status === 'completed') {
      updatedJob.progress = 100;
      updatedJob.end_time = Date.now();
      updatedJob.generation_time = this.calculateTotalTime(updatedJob);
      updatedJob.eta = null;
    } else if (validatedProgress.status === 'failed' || validatedProgress.status === 'cancelled') {
      updatedJob.end_time = Date.now();
      updatedJob.eta = null;
      updatedJob.error = validatedProgress.error;
    }

    // Update timestamp
    updatedJob.last_updated = Date.now();
    return updatedJob;
  },
  /**
   * Validates progress data
   */
  validateProgressData(data) {
    const validated = {
      progress: 0,
      status: 'unknown',
      currentStep: 0,
      totalSteps: null,
      error: null
    };

    // Validate progress percentage
    if (typeof data.progress === 'number') {
      validated.progress = Math.max(0, Math.min(100, data.progress));
    }

    // Validate status
    const validStatuses = ['queued', 'processing', 'completed', 'failed', 'cancelled', 'paused'];
    if (validStatuses.includes(data.status)) {
      validated.status = data.status;
    }

    // Validate current step
    if (typeof data.currentStep === 'number' && data.currentStep >= 0) {
      validated.currentStep = Math.floor(data.currentStep);
    } else if (typeof data.current_step === 'number' && data.current_step >= 0) {
      validated.currentStep = Math.floor(data.current_step);
    }

    // Validate total steps
    if (typeof data.totalSteps === 'number' && data.totalSteps > 0) {
      validated.totalSteps = Math.floor(data.totalSteps);
    } else if (typeof data.total_steps === 'number' && data.total_steps > 0) {
      validated.totalSteps = Math.floor(data.total_steps);
    }

    // Capture error message
    if (data.error) {
      validated.error = String(data.error);
    }
    return validated;
  },
  /**
   * Calculates estimated time remaining (ETA)
   */
  calculateETA(job, currentProgress) {
    if (!job.start_time || currentProgress <= 0) {
      return null;
    }
    const now = Date.now();
    const elapsed = (now - job.start_time) / 1000; // seconds

    if (elapsed < 5) {
      // Not enough data for reliable ETA
      return null;
    }
    const progressPercent = currentProgress / 100;
    const estimatedTotal = elapsed / progressPercent;
    const remaining = estimatedTotal - elapsed;
    return Math.max(0, remaining);
  },
  /**
   * Calculates generation speed (steps per second)
   */
  calculateGenerationSpeed(job) {
    if (!job.start_time || !job.current_step) {
      return 0;
    }
    const elapsed = (Date.now() - job.start_time) / 1000;
    if (elapsed <= 0) return 0;
    return job.current_step / elapsed;
  },
  /**
   * Calculates total generation time
   */
  calculateTotalTime(job) {
    if (!job.start_time) return 0;
    const endTime = job.end_time || Date.now();
    return (endTime - job.start_time) / 1000;
  },
  /**
   * Formats time duration for display
   */
  formatDuration(seconds) {
    if (!seconds || seconds <= 0) {
      return '—';
    }
    if (seconds < 60) {
      return `${Math.round(seconds)}s`;
    } else if (seconds < 3600) {
      const minutes = Math.floor(seconds / 60);
      const remainingSeconds = Math.round(seconds % 60);
      return `${minutes}m ${remainingSeconds}s`;
    } else {
      const hours = Math.floor(seconds / 3600);
      const minutes = Math.floor(seconds % 3600 / 60);
      return `${hours}h ${minutes}m`;
    }
  },
  /**
   * Formats ETA for display
   */
  formatETA(etaSeconds) {
    if (!etaSeconds || etaSeconds <= 0) {
      return 'Unknown';
    }
    if (etaSeconds < 60) {
      return `~${Math.round(etaSeconds)}s`;
    } else if (etaSeconds < 3600) {
      const minutes = Math.ceil(etaSeconds / 60);
      return `~${minutes}m`;
    } else {
      const hours = Math.floor(etaSeconds / 3600);
      const minutes = Math.ceil(etaSeconds % 3600 / 60);
      return `~${hours}h ${minutes}m`;
    }
  },
  /**
   * Gets progress bar configuration
   */
  getProgressBarConfig(job) {
    if (!job) {
      return {
        progress: 0,
        status: 'unknown',
        color: 'gray',
        animated: false,
        text: ''
      };
    }
    const config = {
      progress: job.progress || 0,
      status: job.status || 'unknown',
      animated: false,
      text: ''
    };

    // Set color based on status
    switch (job.status) {
      case 'queued':
        config.color = 'blue';
        config.text = 'Queued';
        break;
      case 'processing':
        config.color = 'green';
        config.animated = true;
        config.text = this.getProcessingText(job);
        break;
      case 'completed':
        config.color = 'green';
        config.progress = 100;
        config.text = 'Completed';
        break;
      case 'failed':
        config.color = 'red';
        config.text = 'Failed';
        break;
      case 'cancelled':
        config.color = 'orange';
        config.text = 'Cancelled';
        break;
      case 'paused':
        config.color = 'yellow';
        config.text = 'Paused';
        break;
      default:
        config.color = 'gray';
        config.text = 'Unknown';
    }
    return config;
  },
  /**
   * Gets processing text with step info
   */
  getProcessingText(job) {
    const parts = [];
    if (job.current_step && job.total_steps) {
      parts.push(`Step ${job.current_step}/${job.total_steps}`);
    }
    if (job.progress) {
      parts.push(`${Math.round(job.progress)}%`);
    }
    if (job.eta) {
      parts.push(`ETA: ${this.formatETA(job.eta)}`);
    }
    return parts.length > 0 ? parts.join(' • ') : 'Processing...';
  },
  /**
   * Gets status icon for job
   */
  getStatusIcon(status) {
    const icons = {
      queued: '⏳',
      processing: '⚡',
      completed: '✅',
      failed: '❌',
      cancelled: '⏹️',
      paused: '⏸️'
    };
    return icons[status] || '❓';
  },
  /**
   * Gets status color class
   */
  getStatusColorClass(status) {
    const colorClasses = {
      queued: 'text-blue-600',
      processing: 'text-green-600',
      completed: 'text-green-600',
      failed: 'text-red-600',
      cancelled: 'text-orange-600',
      paused: 'text-yellow-600'
    };
    return colorClasses[status] || 'text-gray-600';
  },
  /**
   * Checks if job is active (not in final state)
   */
  isJobActive(job) {
    if (!job) return false;
    const activeStatuses = ['queued', 'processing', 'paused'];
    return activeStatuses.includes(job.status);
  },
  /**
   * Checks if job is completed
   */
  isJobCompleted(job) {
    return job && job.status === 'completed';
  },
  /**
   * Checks if job has failed
   */
  isJobFailed(job) {
    return job && (job.status === 'failed' || job.status === 'cancelled');
  },
  /**
   * Gets job priority score (for sorting)
   */
  getJobPriority(job) {
    if (!job) return 0;
    const statusPriority = {
      processing: 1000,
      queued: 500,
      paused: 100,
      failed: 10,
      cancelled: 5,
      completed: 1
    };
    const basePriority = statusPriority[job.status] || 0;
    const timePriority = job.created_at ? (Date.now() - new Date(job.created_at).getTime()) / 1000 : 0;
    return basePriority + timePriority / 1000; // Newer jobs get slightly higher priority
  },
  /**
   * Sorts jobs by priority
   */
  sortJobsByPriority(jobs) {
    if (!Array.isArray(jobs)) return [];
    return [...jobs].sort((a, b) => {
      const priorityA = this.getJobPriority(a);
      const priorityB = this.getJobPriority(b);
      return priorityB - priorityA; // Higher priority first
    });
  },
  /**
   * Gets progress statistics for multiple jobs
   */
  getProgressStatistics(jobs) {
    if (!Array.isArray(jobs) || jobs.length === 0) {
      return {
        total: 0,
        queued: 0,
        processing: 0,
        completed: 0,
        failed: 0,
        cancelled: 0,
        paused: 0,
        averageProgress: 0,
        estimatedTotalTime: 0
      };
    }
    const stats = {
      total: jobs.length,
      queued: 0,
      processing: 0,
      completed: 0,
      failed: 0,
      cancelled: 0,
      paused: 0,
      averageProgress: 0,
      estimatedTotalTime: 0
    };
    let totalProgress = 0;
    let totalETA = 0;
    jobs.forEach(job => {
      if (job.status) {
        stats[job.status] = (stats[job.status] || 0) + 1;
      }
      totalProgress += job.progress || 0;
      if (job.eta && this.isJobActive(job)) {
        totalETA += job.eta;
      }
    });
    stats.averageProgress = totalProgress / jobs.length;
    stats.estimatedTotalTime = totalETA;
    return stats;
  },
  /**
   * Creates progress event data
   */
  createProgressEvent(job, previousJob = null) {
    const event = {
      jobId: job.id,
      status: job.status,
      progress: job.progress,
      timestamp: Date.now(),
      changes: {}
    };
    if (previousJob) {
      // Track what changed
      if (previousJob.status !== job.status) {
        event.changes.status = {
          from: previousJob.status,
          to: job.status
        };
      }
      if (previousJob.progress !== job.progress) {
        event.changes.progress = {
          from: previousJob.progress,
          to: job.progress
        };
      }
      if (previousJob.current_step !== job.current_step) {
        event.changes.step = {
          from: previousJob.current_step,
          to: job.current_step
        };
      }
    }
    return event;
  }
};

// Export for use in other modules
if (typeof module !== 'undefined' && module.exports) {
  module.exports = {
    generationProgress
  };
} else if (typeof window !== 'undefined') {
  window.generationProgress = generationProgress;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJnZW5lcmF0aW9uUHJvZ3Jlc3MiLCJ1cGRhdGVKb2JQcm9ncmVzcyIsImpvYiIsInByb2dyZXNzRGF0YSIsInZhbGlkYXRlZFByb2dyZXNzIiwidmFsaWRhdGVQcm9ncmVzc0RhdGEiLCJ1cGRhdGVkSm9iIiwicHJvZ3Jlc3MiLCJzdGF0dXMiLCJjdXJyZW50X3N0ZXAiLCJjdXJyZW50U3RlcCIsInRvdGFsX3N0ZXBzIiwidG90YWxTdGVwcyIsInN0YXJ0X3RpbWUiLCJEYXRlIiwibm93IiwiZXRhIiwiY2FsY3VsYXRlRVRBIiwic3BlZWQiLCJjYWxjdWxhdGVHZW5lcmF0aW9uU3BlZWQiLCJlbmRfdGltZSIsImdlbmVyYXRpb25fdGltZSIsImNhbGN1bGF0ZVRvdGFsVGltZSIsImVycm9yIiwibGFzdF91cGRhdGVkIiwiZGF0YSIsInZhbGlkYXRlZCIsIk1hdGgiLCJtYXgiLCJtaW4iLCJ2YWxpZFN0YXR1c2VzIiwiaW5jbHVkZXMiLCJmbG9vciIsIlN0cmluZyIsImN1cnJlbnRQcm9ncmVzcyIsImVsYXBzZWQiLCJwcm9ncmVzc1BlcmNlbnQiLCJlc3RpbWF0ZWRUb3RhbCIsInJlbWFpbmluZyIsImVuZFRpbWUiLCJmb3JtYXREdXJhdGlvbiIsInNlY29uZHMiLCJyb3VuZCIsIm1pbnV0ZXMiLCJyZW1haW5pbmdTZWNvbmRzIiwiaG91cnMiLCJmb3JtYXRFVEEiLCJldGFTZWNvbmRzIiwiY2VpbCIsImdldFByb2dyZXNzQmFyQ29uZmlnIiwiY29sb3IiLCJhbmltYXRlZCIsInRleHQiLCJjb25maWciLCJnZXRQcm9jZXNzaW5nVGV4dCIsInBhcnRzIiwicHVzaCIsImxlbmd0aCIsImpvaW4iLCJnZXRTdGF0dXNJY29uIiwiaWNvbnMiLCJxdWV1ZWQiLCJwcm9jZXNzaW5nIiwiY29tcGxldGVkIiwiZmFpbGVkIiwiY2FuY2VsbGVkIiwicGF1c2VkIiwiZ2V0U3RhdHVzQ29sb3JDbGFzcyIsImNvbG9yQ2xhc3NlcyIsImlzSm9iQWN0aXZlIiwiYWN0aXZlU3RhdHVzZXMiLCJpc0pvYkNvbXBsZXRlZCIsImlzSm9iRmFpbGVkIiwiZ2V0Sm9iUHJpb3JpdHkiLCJzdGF0dXNQcmlvcml0eSIsImJhc2VQcmlvcml0eSIsInRpbWVQcmlvcml0eSIsImNyZWF0ZWRfYXQiLCJnZXRUaW1lIiwic29ydEpvYnNCeVByaW9yaXR5Iiwiam9icyIsIkFycmF5IiwiaXNBcnJheSIsInNvcnQiLCJhIiwiYiIsInByaW9yaXR5QSIsInByaW9yaXR5QiIsImdldFByb2dyZXNzU3RhdGlzdGljcyIsInRvdGFsIiwiYXZlcmFnZVByb2dyZXNzIiwiZXN0aW1hdGVkVG90YWxUaW1lIiwic3RhdHMiLCJ0b3RhbFByb2dyZXNzIiwidG90YWxFVEEiLCJmb3JFYWNoIiwiY3JlYXRlUHJvZ3Jlc3NFdmVudCIsInByZXZpb3VzSm9iIiwiZXZlbnQiLCJqb2JJZCIsImlkIiwidGltZXN0YW1wIiwiY2hhbmdlcyIsImZyb20iLCJ0byIsInN0ZXAiLCJtb2R1bGUiLCJleHBvcnRzIiwid2luZG93Il0sInNvdXJjZXMiOlsicHJvZ3Jlc3MuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBHZW5lcmF0aW9uIFN0dWRpbyAtIFByb2dyZXNzIFRyYWNraW5nIE1vZHVsZVxuICogXG4gKiBIYW5kbGVzIGpvYiBwcm9ncmVzcyB1cGRhdGVzLCBFVEEgY2FsY3VsYXRpb25zLCBhbmQgcHJvZ3Jlc3MgdmlzdWFsaXphdGlvbi5cbiAqL1xuXG4vKipcbiAqIFByb2dyZXNzIHRyYWNraW5nIGZvciBnZW5lcmF0aW9uIGpvYnNcbiAqL1xuY29uc3QgZ2VuZXJhdGlvblByb2dyZXNzID0ge1xuICAgIC8qKlxuICAgICAqIFVwZGF0ZXMgam9iIHByb2dyZXNzIHdpdGggdmFsaWRhdGlvblxuICAgICAqL1xuICAgIHVwZGF0ZUpvYlByb2dyZXNzKGpvYiwgcHJvZ3Jlc3NEYXRhKSB7XG4gICAgICAgIGlmICgham9iIHx8ICFwcm9ncmVzc0RhdGEpIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBjb25zdCB2YWxpZGF0ZWRQcm9ncmVzcyA9IHRoaXMudmFsaWRhdGVQcm9ncmVzc0RhdGEocHJvZ3Jlc3NEYXRhKTtcbiAgICAgICAgY29uc3QgdXBkYXRlZEpvYiA9IHsgLi4uam9iIH07XG4gICAgICAgIFxuICAgICAgICAvLyBVcGRhdGUgYmFzaWMgcHJvZ3Jlc3MgaW5mb1xuICAgICAgICB1cGRhdGVkSm9iLnByb2dyZXNzID0gdmFsaWRhdGVkUHJvZ3Jlc3MucHJvZ3Jlc3M7XG4gICAgICAgIHVwZGF0ZWRKb2Iuc3RhdHVzID0gdmFsaWRhdGVkUHJvZ3Jlc3Muc3RhdHVzO1xuICAgICAgICB1cGRhdGVkSm9iLmN1cnJlbnRfc3RlcCA9IHZhbGlkYXRlZFByb2dyZXNzLmN1cnJlbnRTdGVwO1xuICAgICAgICB1cGRhdGVkSm9iLnRvdGFsX3N0ZXBzID0gdmFsaWRhdGVkUHJvZ3Jlc3MudG90YWxTdGVwcyB8fCBqb2IudG90YWxfc3RlcHM7XG4gICAgICAgIFxuICAgICAgICAvLyBIYW5kbGUgc3RhdHVzLXNwZWNpZmljIHVwZGF0ZXNcbiAgICAgICAgaWYgKHZhbGlkYXRlZFByb2dyZXNzLnN0YXR1cyA9PT0gJ3Byb2Nlc3NpbmcnKSB7XG4gICAgICAgICAgICB1cGRhdGVkSm9iLnN0YXJ0X3RpbWUgPSB1cGRhdGVkSm9iLnN0YXJ0X3RpbWUgfHwgRGF0ZS5ub3coKTtcbiAgICAgICAgICAgIHVwZGF0ZWRKb2IuZXRhID0gdGhpcy5jYWxjdWxhdGVFVEEodXBkYXRlZEpvYiwgdmFsaWRhdGVkUHJvZ3Jlc3MucHJvZ3Jlc3MpO1xuICAgICAgICAgICAgdXBkYXRlZEpvYi5zcGVlZCA9IHRoaXMuY2FsY3VsYXRlR2VuZXJhdGlvblNwZWVkKHVwZGF0ZWRKb2IpO1xuICAgICAgICB9IGVsc2UgaWYgKHZhbGlkYXRlZFByb2dyZXNzLnN0YXR1cyA9PT0gJ2NvbXBsZXRlZCcpIHtcbiAgICAgICAgICAgIHVwZGF0ZWRKb2IucHJvZ3Jlc3MgPSAxMDA7XG4gICAgICAgICAgICB1cGRhdGVkSm9iLmVuZF90aW1lID0gRGF0ZS5ub3coKTtcbiAgICAgICAgICAgIHVwZGF0ZWRKb2IuZ2VuZXJhdGlvbl90aW1lID0gdGhpcy5jYWxjdWxhdGVUb3RhbFRpbWUodXBkYXRlZEpvYik7XG4gICAgICAgICAgICB1cGRhdGVkSm9iLmV0YSA9IG51bGw7XG4gICAgICAgIH0gZWxzZSBpZiAodmFsaWRhdGVkUHJvZ3Jlc3Muc3RhdHVzID09PSAnZmFpbGVkJyB8fCB2YWxpZGF0ZWRQcm9ncmVzcy5zdGF0dXMgPT09ICdjYW5jZWxsZWQnKSB7XG4gICAgICAgICAgICB1cGRhdGVkSm9iLmVuZF90aW1lID0gRGF0ZS5ub3coKTtcbiAgICAgICAgICAgIHVwZGF0ZWRKb2IuZXRhID0gbnVsbDtcbiAgICAgICAgICAgIHVwZGF0ZWRKb2IuZXJyb3IgPSB2YWxpZGF0ZWRQcm9ncmVzcy5lcnJvcjtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgLy8gVXBkYXRlIHRpbWVzdGFtcFxuICAgICAgICB1cGRhdGVkSm9iLmxhc3RfdXBkYXRlZCA9IERhdGUubm93KCk7XG4gICAgICAgIFxuICAgICAgICByZXR1cm4gdXBkYXRlZEpvYjtcbiAgICB9LFxuICAgIFxuICAgIC8qKlxuICAgICAqIFZhbGlkYXRlcyBwcm9ncmVzcyBkYXRhXG4gICAgICovXG4gICAgdmFsaWRhdGVQcm9ncmVzc0RhdGEoZGF0YSkge1xuICAgICAgICBjb25zdCB2YWxpZGF0ZWQgPSB7XG4gICAgICAgICAgICBwcm9ncmVzczogMCxcbiAgICAgICAgICAgIHN0YXR1czogJ3Vua25vd24nLFxuICAgICAgICAgICAgY3VycmVudFN0ZXA6IDAsXG4gICAgICAgICAgICB0b3RhbFN0ZXBzOiBudWxsLFxuICAgICAgICAgICAgZXJyb3I6IG51bGxcbiAgICAgICAgfTtcbiAgICAgICAgXG4gICAgICAgIC8vIFZhbGlkYXRlIHByb2dyZXNzIHBlcmNlbnRhZ2VcbiAgICAgICAgaWYgKHR5cGVvZiBkYXRhLnByb2dyZXNzID09PSAnbnVtYmVyJykge1xuICAgICAgICAgICAgdmFsaWRhdGVkLnByb2dyZXNzID0gTWF0aC5tYXgoMCwgTWF0aC5taW4oMTAwLCBkYXRhLnByb2dyZXNzKSk7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIC8vIFZhbGlkYXRlIHN0YXR1c1xuICAgICAgICBjb25zdCB2YWxpZFN0YXR1c2VzID0gWydxdWV1ZWQnLCAncHJvY2Vzc2luZycsICdjb21wbGV0ZWQnLCAnZmFpbGVkJywgJ2NhbmNlbGxlZCcsICdwYXVzZWQnXTtcbiAgICAgICAgaWYgKHZhbGlkU3RhdHVzZXMuaW5jbHVkZXMoZGF0YS5zdGF0dXMpKSB7XG4gICAgICAgICAgICB2YWxpZGF0ZWQuc3RhdHVzID0gZGF0YS5zdGF0dXM7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIC8vIFZhbGlkYXRlIGN1cnJlbnQgc3RlcFxuICAgICAgICBpZiAodHlwZW9mIGRhdGEuY3VycmVudFN0ZXAgPT09ICdudW1iZXInICYmIGRhdGEuY3VycmVudFN0ZXAgPj0gMCkge1xuICAgICAgICAgICAgdmFsaWRhdGVkLmN1cnJlbnRTdGVwID0gTWF0aC5mbG9vcihkYXRhLmN1cnJlbnRTdGVwKTtcbiAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgZGF0YS5jdXJyZW50X3N0ZXAgPT09ICdudW1iZXInICYmIGRhdGEuY3VycmVudF9zdGVwID49IDApIHtcbiAgICAgICAgICAgIHZhbGlkYXRlZC5jdXJyZW50U3RlcCA9IE1hdGguZmxvb3IoZGF0YS5jdXJyZW50X3N0ZXApO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICAvLyBWYWxpZGF0ZSB0b3RhbCBzdGVwc1xuICAgICAgICBpZiAodHlwZW9mIGRhdGEudG90YWxTdGVwcyA9PT0gJ251bWJlcicgJiYgZGF0YS50b3RhbFN0ZXBzID4gMCkge1xuICAgICAgICAgICAgdmFsaWRhdGVkLnRvdGFsU3RlcHMgPSBNYXRoLmZsb29yKGRhdGEudG90YWxTdGVwcyk7XG4gICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIGRhdGEudG90YWxfc3RlcHMgPT09ICdudW1iZXInICYmIGRhdGEudG90YWxfc3RlcHMgPiAwKSB7XG4gICAgICAgICAgICB2YWxpZGF0ZWQudG90YWxTdGVwcyA9IE1hdGguZmxvb3IoZGF0YS50b3RhbF9zdGVwcyk7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIC8vIENhcHR1cmUgZXJyb3IgbWVzc2FnZVxuICAgICAgICBpZiAoZGF0YS5lcnJvcikge1xuICAgICAgICAgICAgdmFsaWRhdGVkLmVycm9yID0gU3RyaW5nKGRhdGEuZXJyb3IpO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICByZXR1cm4gdmFsaWRhdGVkO1xuICAgIH0sXG4gICAgXG4gICAgLyoqXG4gICAgICogQ2FsY3VsYXRlcyBlc3RpbWF0ZWQgdGltZSByZW1haW5pbmcgKEVUQSlcbiAgICAgKi9cbiAgICBjYWxjdWxhdGVFVEEoam9iLCBjdXJyZW50UHJvZ3Jlc3MpIHtcbiAgICAgICAgaWYgKCFqb2Iuc3RhcnRfdGltZSB8fCBjdXJyZW50UHJvZ3Jlc3MgPD0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGNvbnN0IG5vdyA9IERhdGUubm93KCk7XG4gICAgICAgIGNvbnN0IGVsYXBzZWQgPSAobm93IC0gam9iLnN0YXJ0X3RpbWUpIC8gMTAwMDsgLy8gc2Vjb25kc1xuICAgICAgICBcbiAgICAgICAgaWYgKGVsYXBzZWQgPCA1KSB7XG4gICAgICAgICAgICAvLyBOb3QgZW5vdWdoIGRhdGEgZm9yIHJlbGlhYmxlIEVUQVxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGNvbnN0IHByb2dyZXNzUGVyY2VudCA9IGN1cnJlbnRQcm9ncmVzcyAvIDEwMDtcbiAgICAgICAgY29uc3QgZXN0aW1hdGVkVG90YWwgPSBlbGFwc2VkIC8gcHJvZ3Jlc3NQZXJjZW50O1xuICAgICAgICBjb25zdCByZW1haW5pbmcgPSBlc3RpbWF0ZWRUb3RhbCAtIGVsYXBzZWQ7XG4gICAgICAgIFxuICAgICAgICByZXR1cm4gTWF0aC5tYXgoMCwgcmVtYWluaW5nKTtcbiAgICB9LFxuICAgIFxuICAgIC8qKlxuICAgICAqIENhbGN1bGF0ZXMgZ2VuZXJhdGlvbiBzcGVlZCAoc3RlcHMgcGVyIHNlY29uZClcbiAgICAgKi9cbiAgICBjYWxjdWxhdGVHZW5lcmF0aW9uU3BlZWQoam9iKSB7XG4gICAgICAgIGlmICgham9iLnN0YXJ0X3RpbWUgfHwgIWpvYi5jdXJyZW50X3N0ZXApIHtcbiAgICAgICAgICAgIHJldHVybiAwO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBjb25zdCBlbGFwc2VkID0gKERhdGUubm93KCkgLSBqb2Iuc3RhcnRfdGltZSkgLyAxMDAwO1xuICAgICAgICBpZiAoZWxhcHNlZCA8PSAwKSByZXR1cm4gMDtcbiAgICAgICAgXG4gICAgICAgIHJldHVybiBqb2IuY3VycmVudF9zdGVwIC8gZWxhcHNlZDtcbiAgICB9LFxuICAgIFxuICAgIC8qKlxuICAgICAqIENhbGN1bGF0ZXMgdG90YWwgZ2VuZXJhdGlvbiB0aW1lXG4gICAgICovXG4gICAgY2FsY3VsYXRlVG90YWxUaW1lKGpvYikge1xuICAgICAgICBpZiAoIWpvYi5zdGFydF90aW1lKSByZXR1cm4gMDtcbiAgICAgICAgXG4gICAgICAgIGNvbnN0IGVuZFRpbWUgPSBqb2IuZW5kX3RpbWUgfHwgRGF0ZS5ub3coKTtcbiAgICAgICAgcmV0dXJuIChlbmRUaW1lIC0gam9iLnN0YXJ0X3RpbWUpIC8gMTAwMDtcbiAgICB9LFxuICAgIFxuICAgIC8qKlxuICAgICAqIEZvcm1hdHMgdGltZSBkdXJhdGlvbiBmb3IgZGlzcGxheVxuICAgICAqL1xuICAgIGZvcm1hdER1cmF0aW9uKHNlY29uZHMpIHtcbiAgICAgICAgaWYgKCFzZWNvbmRzIHx8IHNlY29uZHMgPD0gMCkge1xuICAgICAgICAgICAgcmV0dXJuICfigJQnO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBpZiAoc2Vjb25kcyA8IDYwKSB7XG4gICAgICAgICAgICByZXR1cm4gYCR7TWF0aC5yb3VuZChzZWNvbmRzKX1zYDtcbiAgICAgICAgfSBlbHNlIGlmIChzZWNvbmRzIDwgMzYwMCkge1xuICAgICAgICAgICAgY29uc3QgbWludXRlcyA9IE1hdGguZmxvb3Ioc2Vjb25kcyAvIDYwKTtcbiAgICAgICAgICAgIGNvbnN0IHJlbWFpbmluZ1NlY29uZHMgPSBNYXRoLnJvdW5kKHNlY29uZHMgJSA2MCk7XG4gICAgICAgICAgICByZXR1cm4gYCR7bWludXRlc31tICR7cmVtYWluaW5nU2Vjb25kc31zYDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNvbnN0IGhvdXJzID0gTWF0aC5mbG9vcihzZWNvbmRzIC8gMzYwMCk7XG4gICAgICAgICAgICBjb25zdCBtaW51dGVzID0gTWF0aC5mbG9vcigoc2Vjb25kcyAlIDM2MDApIC8gNjApO1xuICAgICAgICAgICAgcmV0dXJuIGAke2hvdXJzfWggJHttaW51dGVzfW1gO1xuICAgICAgICB9XG4gICAgfSxcbiAgICBcbiAgICAvKipcbiAgICAgKiBGb3JtYXRzIEVUQSBmb3IgZGlzcGxheVxuICAgICAqL1xuICAgIGZvcm1hdEVUQShldGFTZWNvbmRzKSB7XG4gICAgICAgIGlmICghZXRhU2Vjb25kcyB8fCBldGFTZWNvbmRzIDw9IDApIHtcbiAgICAgICAgICAgIHJldHVybiAnVW5rbm93bic7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGlmIChldGFTZWNvbmRzIDwgNjApIHtcbiAgICAgICAgICAgIHJldHVybiBgfiR7TWF0aC5yb3VuZChldGFTZWNvbmRzKX1zYDtcbiAgICAgICAgfSBlbHNlIGlmIChldGFTZWNvbmRzIDwgMzYwMCkge1xuICAgICAgICAgICAgY29uc3QgbWludXRlcyA9IE1hdGguY2VpbChldGFTZWNvbmRzIC8gNjApO1xuICAgICAgICAgICAgcmV0dXJuIGB+JHttaW51dGVzfW1gO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY29uc3QgaG91cnMgPSBNYXRoLmZsb29yKGV0YVNlY29uZHMgLyAzNjAwKTtcbiAgICAgICAgICAgIGNvbnN0IG1pbnV0ZXMgPSBNYXRoLmNlaWwoKGV0YVNlY29uZHMgJSAzNjAwKSAvIDYwKTtcbiAgICAgICAgICAgIHJldHVybiBgfiR7aG91cnN9aCAke21pbnV0ZXN9bWA7XG4gICAgICAgIH1cbiAgICB9LFxuICAgIFxuICAgIC8qKlxuICAgICAqIEdldHMgcHJvZ3Jlc3MgYmFyIGNvbmZpZ3VyYXRpb25cbiAgICAgKi9cbiAgICBnZXRQcm9ncmVzc0JhckNvbmZpZyhqb2IpIHtcbiAgICAgICAgaWYgKCFqb2IpIHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgcHJvZ3Jlc3M6IDAsXG4gICAgICAgICAgICAgICAgc3RhdHVzOiAndW5rbm93bicsXG4gICAgICAgICAgICAgICAgY29sb3I6ICdncmF5JyxcbiAgICAgICAgICAgICAgICBhbmltYXRlZDogZmFsc2UsXG4gICAgICAgICAgICAgICAgdGV4dDogJydcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGNvbnN0IGNvbmZpZyA9IHtcbiAgICAgICAgICAgIHByb2dyZXNzOiBqb2IucHJvZ3Jlc3MgfHwgMCxcbiAgICAgICAgICAgIHN0YXR1czogam9iLnN0YXR1cyB8fCAndW5rbm93bicsXG4gICAgICAgICAgICBhbmltYXRlZDogZmFsc2UsXG4gICAgICAgICAgICB0ZXh0OiAnJ1xuICAgICAgICB9O1xuICAgICAgICBcbiAgICAgICAgLy8gU2V0IGNvbG9yIGJhc2VkIG9uIHN0YXR1c1xuICAgICAgICBzd2l0Y2ggKGpvYi5zdGF0dXMpIHtcbiAgICAgICAgICAgIGNhc2UgJ3F1ZXVlZCc6XG4gICAgICAgICAgICAgICAgY29uZmlnLmNvbG9yID0gJ2JsdWUnO1xuICAgICAgICAgICAgICAgIGNvbmZpZy50ZXh0ID0gJ1F1ZXVlZCc7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICdwcm9jZXNzaW5nJzpcbiAgICAgICAgICAgICAgICBjb25maWcuY29sb3IgPSAnZ3JlZW4nO1xuICAgICAgICAgICAgICAgIGNvbmZpZy5hbmltYXRlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgY29uZmlnLnRleHQgPSB0aGlzLmdldFByb2Nlc3NpbmdUZXh0KGpvYik7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICdjb21wbGV0ZWQnOlxuICAgICAgICAgICAgICAgIGNvbmZpZy5jb2xvciA9ICdncmVlbic7XG4gICAgICAgICAgICAgICAgY29uZmlnLnByb2dyZXNzID0gMTAwO1xuICAgICAgICAgICAgICAgIGNvbmZpZy50ZXh0ID0gJ0NvbXBsZXRlZCc7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICdmYWlsZWQnOlxuICAgICAgICAgICAgICAgIGNvbmZpZy5jb2xvciA9ICdyZWQnO1xuICAgICAgICAgICAgICAgIGNvbmZpZy50ZXh0ID0gJ0ZhaWxlZCc7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICdjYW5jZWxsZWQnOlxuICAgICAgICAgICAgICAgIGNvbmZpZy5jb2xvciA9ICdvcmFuZ2UnO1xuICAgICAgICAgICAgICAgIGNvbmZpZy50ZXh0ID0gJ0NhbmNlbGxlZCc7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICdwYXVzZWQnOlxuICAgICAgICAgICAgICAgIGNvbmZpZy5jb2xvciA9ICd5ZWxsb3cnO1xuICAgICAgICAgICAgICAgIGNvbmZpZy50ZXh0ID0gJ1BhdXNlZCc7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIGNvbmZpZy5jb2xvciA9ICdncmF5JztcbiAgICAgICAgICAgICAgICBjb25maWcudGV4dCA9ICdVbmtub3duJztcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgcmV0dXJuIGNvbmZpZztcbiAgICB9LFxuICAgIFxuICAgIC8qKlxuICAgICAqIEdldHMgcHJvY2Vzc2luZyB0ZXh0IHdpdGggc3RlcCBpbmZvXG4gICAgICovXG4gICAgZ2V0UHJvY2Vzc2luZ1RleHQoam9iKSB7XG4gICAgICAgIGNvbnN0IHBhcnRzID0gW107XG4gICAgICAgIFxuICAgICAgICBpZiAoam9iLmN1cnJlbnRfc3RlcCAmJiBqb2IudG90YWxfc3RlcHMpIHtcbiAgICAgICAgICAgIHBhcnRzLnB1c2goYFN0ZXAgJHtqb2IuY3VycmVudF9zdGVwfS8ke2pvYi50b3RhbF9zdGVwc31gKTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgaWYgKGpvYi5wcm9ncmVzcykge1xuICAgICAgICAgICAgcGFydHMucHVzaChgJHtNYXRoLnJvdW5kKGpvYi5wcm9ncmVzcyl9JWApO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBpZiAoam9iLmV0YSkge1xuICAgICAgICAgICAgcGFydHMucHVzaChgRVRBOiAke3RoaXMuZm9ybWF0RVRBKGpvYi5ldGEpfWApO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICByZXR1cm4gcGFydHMubGVuZ3RoID4gMCA/IHBhcnRzLmpvaW4oJyDigKIgJykgOiAnUHJvY2Vzc2luZy4uLic7XG4gICAgfSxcbiAgICBcbiAgICAvKipcbiAgICAgKiBHZXRzIHN0YXR1cyBpY29uIGZvciBqb2JcbiAgICAgKi9cbiAgICBnZXRTdGF0dXNJY29uKHN0YXR1cykge1xuICAgICAgICBjb25zdCBpY29ucyA9IHtcbiAgICAgICAgICAgIHF1ZXVlZDogJ+KPsycsXG4gICAgICAgICAgICBwcm9jZXNzaW5nOiAn4pqhJyxcbiAgICAgICAgICAgIGNvbXBsZXRlZDogJ+KchScsXG4gICAgICAgICAgICBmYWlsZWQ6ICfinYwnLFxuICAgICAgICAgICAgY2FuY2VsbGVkOiAn4o+577iPJyxcbiAgICAgICAgICAgIHBhdXNlZDogJ+KPuO+4jydcbiAgICAgICAgfTtcbiAgICAgICAgXG4gICAgICAgIHJldHVybiBpY29uc1tzdGF0dXNdIHx8ICfinZMnO1xuICAgIH0sXG4gICAgXG4gICAgLyoqXG4gICAgICogR2V0cyBzdGF0dXMgY29sb3IgY2xhc3NcbiAgICAgKi9cbiAgICBnZXRTdGF0dXNDb2xvckNsYXNzKHN0YXR1cykge1xuICAgICAgICBjb25zdCBjb2xvckNsYXNzZXMgPSB7XG4gICAgICAgICAgICBxdWV1ZWQ6ICd0ZXh0LWJsdWUtNjAwJyxcbiAgICAgICAgICAgIHByb2Nlc3Npbmc6ICd0ZXh0LWdyZWVuLTYwMCcsXG4gICAgICAgICAgICBjb21wbGV0ZWQ6ICd0ZXh0LWdyZWVuLTYwMCcsXG4gICAgICAgICAgICBmYWlsZWQ6ICd0ZXh0LXJlZC02MDAnLFxuICAgICAgICAgICAgY2FuY2VsbGVkOiAndGV4dC1vcmFuZ2UtNjAwJyxcbiAgICAgICAgICAgIHBhdXNlZDogJ3RleHQteWVsbG93LTYwMCdcbiAgICAgICAgfTtcbiAgICAgICAgXG4gICAgICAgIHJldHVybiBjb2xvckNsYXNzZXNbc3RhdHVzXSB8fCAndGV4dC1ncmF5LTYwMCc7XG4gICAgfSxcbiAgICBcbiAgICAvKipcbiAgICAgKiBDaGVja3MgaWYgam9iIGlzIGFjdGl2ZSAobm90IGluIGZpbmFsIHN0YXRlKVxuICAgICAqL1xuICAgIGlzSm9iQWN0aXZlKGpvYikge1xuICAgICAgICBpZiAoIWpvYikgcmV0dXJuIGZhbHNlO1xuICAgICAgICBcbiAgICAgICAgY29uc3QgYWN0aXZlU3RhdHVzZXMgPSBbJ3F1ZXVlZCcsICdwcm9jZXNzaW5nJywgJ3BhdXNlZCddO1xuICAgICAgICByZXR1cm4gYWN0aXZlU3RhdHVzZXMuaW5jbHVkZXMoam9iLnN0YXR1cyk7XG4gICAgfSxcbiAgICBcbiAgICAvKipcbiAgICAgKiBDaGVja3MgaWYgam9iIGlzIGNvbXBsZXRlZFxuICAgICAqL1xuICAgIGlzSm9iQ29tcGxldGVkKGpvYikge1xuICAgICAgICByZXR1cm4gam9iICYmIGpvYi5zdGF0dXMgPT09ICdjb21wbGV0ZWQnO1xuICAgIH0sXG4gICAgXG4gICAgLyoqXG4gICAgICogQ2hlY2tzIGlmIGpvYiBoYXMgZmFpbGVkXG4gICAgICovXG4gICAgaXNKb2JGYWlsZWQoam9iKSB7XG4gICAgICAgIHJldHVybiBqb2IgJiYgKGpvYi5zdGF0dXMgPT09ICdmYWlsZWQnIHx8IGpvYi5zdGF0dXMgPT09ICdjYW5jZWxsZWQnKTtcbiAgICB9LFxuICAgIFxuICAgIC8qKlxuICAgICAqIEdldHMgam9iIHByaW9yaXR5IHNjb3JlIChmb3Igc29ydGluZylcbiAgICAgKi9cbiAgICBnZXRKb2JQcmlvcml0eShqb2IpIHtcbiAgICAgICAgaWYgKCFqb2IpIHJldHVybiAwO1xuICAgICAgICBcbiAgICAgICAgY29uc3Qgc3RhdHVzUHJpb3JpdHkgPSB7XG4gICAgICAgICAgICBwcm9jZXNzaW5nOiAxMDAwLFxuICAgICAgICAgICAgcXVldWVkOiA1MDAsXG4gICAgICAgICAgICBwYXVzZWQ6IDEwMCxcbiAgICAgICAgICAgIGZhaWxlZDogMTAsXG4gICAgICAgICAgICBjYW5jZWxsZWQ6IDUsXG4gICAgICAgICAgICBjb21wbGV0ZWQ6IDFcbiAgICAgICAgfTtcbiAgICAgICAgXG4gICAgICAgIGNvbnN0IGJhc2VQcmlvcml0eSA9IHN0YXR1c1ByaW9yaXR5W2pvYi5zdGF0dXNdIHx8IDA7XG4gICAgICAgIGNvbnN0IHRpbWVQcmlvcml0eSA9IGpvYi5jcmVhdGVkX2F0ID8gKERhdGUubm93KCkgLSBuZXcgRGF0ZShqb2IuY3JlYXRlZF9hdCkuZ2V0VGltZSgpKSAvIDEwMDAgOiAwO1xuICAgICAgICBcbiAgICAgICAgcmV0dXJuIGJhc2VQcmlvcml0eSArICh0aW1lUHJpb3JpdHkgLyAxMDAwKTsgLy8gTmV3ZXIgam9icyBnZXQgc2xpZ2h0bHkgaGlnaGVyIHByaW9yaXR5XG4gICAgfSxcbiAgICBcbiAgICAvKipcbiAgICAgKiBTb3J0cyBqb2JzIGJ5IHByaW9yaXR5XG4gICAgICovXG4gICAgc29ydEpvYnNCeVByaW9yaXR5KGpvYnMpIHtcbiAgICAgICAgaWYgKCFBcnJheS5pc0FycmF5KGpvYnMpKSByZXR1cm4gW107XG4gICAgICAgIFxuICAgICAgICByZXR1cm4gWy4uLmpvYnNdLnNvcnQoKGEsIGIpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHByaW9yaXR5QSA9IHRoaXMuZ2V0Sm9iUHJpb3JpdHkoYSk7XG4gICAgICAgICAgICBjb25zdCBwcmlvcml0eUIgPSB0aGlzLmdldEpvYlByaW9yaXR5KGIpO1xuICAgICAgICAgICAgcmV0dXJuIHByaW9yaXR5QiAtIHByaW9yaXR5QTsgLy8gSGlnaGVyIHByaW9yaXR5IGZpcnN0XG4gICAgICAgIH0pO1xuICAgIH0sXG4gICAgXG4gICAgLyoqXG4gICAgICogR2V0cyBwcm9ncmVzcyBzdGF0aXN0aWNzIGZvciBtdWx0aXBsZSBqb2JzXG4gICAgICovXG4gICAgZ2V0UHJvZ3Jlc3NTdGF0aXN0aWNzKGpvYnMpIHtcbiAgICAgICAgaWYgKCFBcnJheS5pc0FycmF5KGpvYnMpIHx8IGpvYnMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHRvdGFsOiAwLFxuICAgICAgICAgICAgICAgIHF1ZXVlZDogMCxcbiAgICAgICAgICAgICAgICBwcm9jZXNzaW5nOiAwLFxuICAgICAgICAgICAgICAgIGNvbXBsZXRlZDogMCxcbiAgICAgICAgICAgICAgICBmYWlsZWQ6IDAsXG4gICAgICAgICAgICAgICAgY2FuY2VsbGVkOiAwLFxuICAgICAgICAgICAgICAgIHBhdXNlZDogMCxcbiAgICAgICAgICAgICAgICBhdmVyYWdlUHJvZ3Jlc3M6IDAsXG4gICAgICAgICAgICAgICAgZXN0aW1hdGVkVG90YWxUaW1lOiAwXG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBjb25zdCBzdGF0cyA9IHtcbiAgICAgICAgICAgIHRvdGFsOiBqb2JzLmxlbmd0aCxcbiAgICAgICAgICAgIHF1ZXVlZDogMCxcbiAgICAgICAgICAgIHByb2Nlc3Npbmc6IDAsXG4gICAgICAgICAgICBjb21wbGV0ZWQ6IDAsXG4gICAgICAgICAgICBmYWlsZWQ6IDAsXG4gICAgICAgICAgICBjYW5jZWxsZWQ6IDAsXG4gICAgICAgICAgICBwYXVzZWQ6IDAsXG4gICAgICAgICAgICBhdmVyYWdlUHJvZ3Jlc3M6IDAsXG4gICAgICAgICAgICBlc3RpbWF0ZWRUb3RhbFRpbWU6IDBcbiAgICAgICAgfTtcbiAgICAgICAgXG4gICAgICAgIGxldCB0b3RhbFByb2dyZXNzID0gMDtcbiAgICAgICAgbGV0IHRvdGFsRVRBID0gMDtcbiAgICAgICAgXG4gICAgICAgIGpvYnMuZm9yRWFjaChqb2IgPT4ge1xuICAgICAgICAgICAgaWYgKGpvYi5zdGF0dXMpIHtcbiAgICAgICAgICAgICAgICBzdGF0c1tqb2Iuc3RhdHVzXSA9IChzdGF0c1tqb2Iuc3RhdHVzXSB8fCAwKSArIDE7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIHRvdGFsUHJvZ3Jlc3MgKz0gam9iLnByb2dyZXNzIHx8IDA7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGlmIChqb2IuZXRhICYmIHRoaXMuaXNKb2JBY3RpdmUoam9iKSkge1xuICAgICAgICAgICAgICAgIHRvdGFsRVRBICs9IGpvYi5ldGE7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBcbiAgICAgICAgc3RhdHMuYXZlcmFnZVByb2dyZXNzID0gdG90YWxQcm9ncmVzcyAvIGpvYnMubGVuZ3RoO1xuICAgICAgICBzdGF0cy5lc3RpbWF0ZWRUb3RhbFRpbWUgPSB0b3RhbEVUQTtcbiAgICAgICAgXG4gICAgICAgIHJldHVybiBzdGF0cztcbiAgICB9LFxuICAgIFxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgcHJvZ3Jlc3MgZXZlbnQgZGF0YVxuICAgICAqL1xuICAgIGNyZWF0ZVByb2dyZXNzRXZlbnQoam9iLCBwcmV2aW91c0pvYiA9IG51bGwpIHtcbiAgICAgICAgY29uc3QgZXZlbnQgPSB7XG4gICAgICAgICAgICBqb2JJZDogam9iLmlkLFxuICAgICAgICAgICAgc3RhdHVzOiBqb2Iuc3RhdHVzLFxuICAgICAgICAgICAgcHJvZ3Jlc3M6IGpvYi5wcm9ncmVzcyxcbiAgICAgICAgICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKSxcbiAgICAgICAgICAgIGNoYW5nZXM6IHt9XG4gICAgICAgIH07XG4gICAgICAgIFxuICAgICAgICBpZiAocHJldmlvdXNKb2IpIHtcbiAgICAgICAgICAgIC8vIFRyYWNrIHdoYXQgY2hhbmdlZFxuICAgICAgICAgICAgaWYgKHByZXZpb3VzSm9iLnN0YXR1cyAhPT0gam9iLnN0YXR1cykge1xuICAgICAgICAgICAgICAgIGV2ZW50LmNoYW5nZXMuc3RhdHVzID0geyBmcm9tOiBwcmV2aW91c0pvYi5zdGF0dXMsIHRvOiBqb2Iuc3RhdHVzIH07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGlmIChwcmV2aW91c0pvYi5wcm9ncmVzcyAhPT0gam9iLnByb2dyZXNzKSB7XG4gICAgICAgICAgICAgICAgZXZlbnQuY2hhbmdlcy5wcm9ncmVzcyA9IHsgZnJvbTogcHJldmlvdXNKb2IucHJvZ3Jlc3MsIHRvOiBqb2IucHJvZ3Jlc3MgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIFxuICAgICAgICAgICAgaWYgKHByZXZpb3VzSm9iLmN1cnJlbnRfc3RlcCAhPT0gam9iLmN1cnJlbnRfc3RlcCkge1xuICAgICAgICAgICAgICAgIGV2ZW50LmNoYW5nZXMuc3RlcCA9IHsgZnJvbTogcHJldmlvdXNKb2IuY3VycmVudF9zdGVwLCB0bzogam9iLmN1cnJlbnRfc3RlcCB9O1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICByZXR1cm4gZXZlbnQ7XG4gICAgfVxufTtcblxuLy8gRXhwb3J0IGZvciB1c2UgaW4gb3RoZXIgbW9kdWxlc1xuaWYgKHR5cGVvZiBtb2R1bGUgIT09ICd1bmRlZmluZWQnICYmIG1vZHVsZS5leHBvcnRzKSB7XG4gICAgbW9kdWxlLmV4cG9ydHMgPSB7IGdlbmVyYXRpb25Qcm9ncmVzcyB9O1xufSBlbHNlIGlmICh0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJykge1xuICAgIHdpbmRvdy5nZW5lcmF0aW9uUHJvZ3Jlc3MgPSBnZW5lcmF0aW9uUHJvZ3Jlc3M7XG59XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsTUFBTUEsa0JBQWtCLEdBQUc7RUFDdkI7QUFDSjtBQUNBO0VBQ0lDLGlCQUFpQkEsQ0FBQ0MsR0FBRyxFQUFFQyxZQUFZLEVBQUU7SUFDakMsSUFBSSxDQUFDRCxHQUFHLElBQUksQ0FBQ0MsWUFBWSxFQUFFO01BQ3ZCLE9BQU8sSUFBSTtJQUNmO0lBRUEsTUFBTUMsaUJBQWlCLEdBQUcsSUFBSSxDQUFDQyxvQkFBb0IsQ0FBQ0YsWUFBWSxDQUFDO0lBQ2pFLE1BQU1HLFVBQVUsR0FBRztNQUFFLEdBQUdKO0lBQUksQ0FBQzs7SUFFN0I7SUFDQUksVUFBVSxDQUFDQyxRQUFRLEdBQUdILGlCQUFpQixDQUFDRyxRQUFRO0lBQ2hERCxVQUFVLENBQUNFLE1BQU0sR0FBR0osaUJBQWlCLENBQUNJLE1BQU07SUFDNUNGLFVBQVUsQ0FBQ0csWUFBWSxHQUFHTCxpQkFBaUIsQ0FBQ00sV0FBVztJQUN2REosVUFBVSxDQUFDSyxXQUFXLEdBQUdQLGlCQUFpQixDQUFDUSxVQUFVLElBQUlWLEdBQUcsQ0FBQ1MsV0FBVzs7SUFFeEU7SUFDQSxJQUFJUCxpQkFBaUIsQ0FBQ0ksTUFBTSxLQUFLLFlBQVksRUFBRTtNQUMzQ0YsVUFBVSxDQUFDTyxVQUFVLEdBQUdQLFVBQVUsQ0FBQ08sVUFBVSxJQUFJQyxJQUFJLENBQUNDLEdBQUcsQ0FBQyxDQUFDO01BQzNEVCxVQUFVLENBQUNVLEdBQUcsR0FBRyxJQUFJLENBQUNDLFlBQVksQ0FBQ1gsVUFBVSxFQUFFRixpQkFBaUIsQ0FBQ0csUUFBUSxDQUFDO01BQzFFRCxVQUFVLENBQUNZLEtBQUssR0FBRyxJQUFJLENBQUNDLHdCQUF3QixDQUFDYixVQUFVLENBQUM7SUFDaEUsQ0FBQyxNQUFNLElBQUlGLGlCQUFpQixDQUFDSSxNQUFNLEtBQUssV0FBVyxFQUFFO01BQ2pERixVQUFVLENBQUNDLFFBQVEsR0FBRyxHQUFHO01BQ3pCRCxVQUFVLENBQUNjLFFBQVEsR0FBR04sSUFBSSxDQUFDQyxHQUFHLENBQUMsQ0FBQztNQUNoQ1QsVUFBVSxDQUFDZSxlQUFlLEdBQUcsSUFBSSxDQUFDQyxrQkFBa0IsQ0FBQ2hCLFVBQVUsQ0FBQztNQUNoRUEsVUFBVSxDQUFDVSxHQUFHLEdBQUcsSUFBSTtJQUN6QixDQUFDLE1BQU0sSUFBSVosaUJBQWlCLENBQUNJLE1BQU0sS0FBSyxRQUFRLElBQUlKLGlCQUFpQixDQUFDSSxNQUFNLEtBQUssV0FBVyxFQUFFO01BQzFGRixVQUFVLENBQUNjLFFBQVEsR0FBR04sSUFBSSxDQUFDQyxHQUFHLENBQUMsQ0FBQztNQUNoQ1QsVUFBVSxDQUFDVSxHQUFHLEdBQUcsSUFBSTtNQUNyQlYsVUFBVSxDQUFDaUIsS0FBSyxHQUFHbkIsaUJBQWlCLENBQUNtQixLQUFLO0lBQzlDOztJQUVBO0lBQ0FqQixVQUFVLENBQUNrQixZQUFZLEdBQUdWLElBQUksQ0FBQ0MsR0FBRyxDQUFDLENBQUM7SUFFcEMsT0FBT1QsVUFBVTtFQUNyQixDQUFDO0VBRUQ7QUFDSjtBQUNBO0VBQ0lELG9CQUFvQkEsQ0FBQ29CLElBQUksRUFBRTtJQUN2QixNQUFNQyxTQUFTLEdBQUc7TUFDZG5CLFFBQVEsRUFBRSxDQUFDO01BQ1hDLE1BQU0sRUFBRSxTQUFTO01BQ2pCRSxXQUFXLEVBQUUsQ0FBQztNQUNkRSxVQUFVLEVBQUUsSUFBSTtNQUNoQlcsS0FBSyxFQUFFO0lBQ1gsQ0FBQzs7SUFFRDtJQUNBLElBQUksT0FBT0UsSUFBSSxDQUFDbEIsUUFBUSxLQUFLLFFBQVEsRUFBRTtNQUNuQ21CLFNBQVMsQ0FBQ25CLFFBQVEsR0FBR29CLElBQUksQ0FBQ0MsR0FBRyxDQUFDLENBQUMsRUFBRUQsSUFBSSxDQUFDRSxHQUFHLENBQUMsR0FBRyxFQUFFSixJQUFJLENBQUNsQixRQUFRLENBQUMsQ0FBQztJQUNsRTs7SUFFQTtJQUNBLE1BQU11QixhQUFhLEdBQUcsQ0FBQyxRQUFRLEVBQUUsWUFBWSxFQUFFLFdBQVcsRUFBRSxRQUFRLEVBQUUsV0FBVyxFQUFFLFFBQVEsQ0FBQztJQUM1RixJQUFJQSxhQUFhLENBQUNDLFFBQVEsQ0FBQ04sSUFBSSxDQUFDakIsTUFBTSxDQUFDLEVBQUU7TUFDckNrQixTQUFTLENBQUNsQixNQUFNLEdBQUdpQixJQUFJLENBQUNqQixNQUFNO0lBQ2xDOztJQUVBO0lBQ0EsSUFBSSxPQUFPaUIsSUFBSSxDQUFDZixXQUFXLEtBQUssUUFBUSxJQUFJZSxJQUFJLENBQUNmLFdBQVcsSUFBSSxDQUFDLEVBQUU7TUFDL0RnQixTQUFTLENBQUNoQixXQUFXLEdBQUdpQixJQUFJLENBQUNLLEtBQUssQ0FBQ1AsSUFBSSxDQUFDZixXQUFXLENBQUM7SUFDeEQsQ0FBQyxNQUFNLElBQUksT0FBT2UsSUFBSSxDQUFDaEIsWUFBWSxLQUFLLFFBQVEsSUFBSWdCLElBQUksQ0FBQ2hCLFlBQVksSUFBSSxDQUFDLEVBQUU7TUFDeEVpQixTQUFTLENBQUNoQixXQUFXLEdBQUdpQixJQUFJLENBQUNLLEtBQUssQ0FBQ1AsSUFBSSxDQUFDaEIsWUFBWSxDQUFDO0lBQ3pEOztJQUVBO0lBQ0EsSUFBSSxPQUFPZ0IsSUFBSSxDQUFDYixVQUFVLEtBQUssUUFBUSxJQUFJYSxJQUFJLENBQUNiLFVBQVUsR0FBRyxDQUFDLEVBQUU7TUFDNURjLFNBQVMsQ0FBQ2QsVUFBVSxHQUFHZSxJQUFJLENBQUNLLEtBQUssQ0FBQ1AsSUFBSSxDQUFDYixVQUFVLENBQUM7SUFDdEQsQ0FBQyxNQUFNLElBQUksT0FBT2EsSUFBSSxDQUFDZCxXQUFXLEtBQUssUUFBUSxJQUFJYyxJQUFJLENBQUNkLFdBQVcsR0FBRyxDQUFDLEVBQUU7TUFDckVlLFNBQVMsQ0FBQ2QsVUFBVSxHQUFHZSxJQUFJLENBQUNLLEtBQUssQ0FBQ1AsSUFBSSxDQUFDZCxXQUFXLENBQUM7SUFDdkQ7O0lBRUE7SUFDQSxJQUFJYyxJQUFJLENBQUNGLEtBQUssRUFBRTtNQUNaRyxTQUFTLENBQUNILEtBQUssR0FBR1UsTUFBTSxDQUFDUixJQUFJLENBQUNGLEtBQUssQ0FBQztJQUN4QztJQUVBLE9BQU9HLFNBQVM7RUFDcEIsQ0FBQztFQUVEO0FBQ0o7QUFDQTtFQUNJVCxZQUFZQSxDQUFDZixHQUFHLEVBQUVnQyxlQUFlLEVBQUU7SUFDL0IsSUFBSSxDQUFDaEMsR0FBRyxDQUFDVyxVQUFVLElBQUlxQixlQUFlLElBQUksQ0FBQyxFQUFFO01BQ3pDLE9BQU8sSUFBSTtJQUNmO0lBRUEsTUFBTW5CLEdBQUcsR0FBR0QsSUFBSSxDQUFDQyxHQUFHLENBQUMsQ0FBQztJQUN0QixNQUFNb0IsT0FBTyxHQUFHLENBQUNwQixHQUFHLEdBQUdiLEdBQUcsQ0FBQ1csVUFBVSxJQUFJLElBQUksQ0FBQyxDQUFDOztJQUUvQyxJQUFJc0IsT0FBTyxHQUFHLENBQUMsRUFBRTtNQUNiO01BQ0EsT0FBTyxJQUFJO0lBQ2Y7SUFFQSxNQUFNQyxlQUFlLEdBQUdGLGVBQWUsR0FBRyxHQUFHO0lBQzdDLE1BQU1HLGNBQWMsR0FBR0YsT0FBTyxHQUFHQyxlQUFlO0lBQ2hELE1BQU1FLFNBQVMsR0FBR0QsY0FBYyxHQUFHRixPQUFPO0lBRTFDLE9BQU9SLElBQUksQ0FBQ0MsR0FBRyxDQUFDLENBQUMsRUFBRVUsU0FBUyxDQUFDO0VBQ2pDLENBQUM7RUFFRDtBQUNKO0FBQ0E7RUFDSW5CLHdCQUF3QkEsQ0FBQ2pCLEdBQUcsRUFBRTtJQUMxQixJQUFJLENBQUNBLEdBQUcsQ0FBQ1csVUFBVSxJQUFJLENBQUNYLEdBQUcsQ0FBQ08sWUFBWSxFQUFFO01BQ3RDLE9BQU8sQ0FBQztJQUNaO0lBRUEsTUFBTTBCLE9BQU8sR0FBRyxDQUFDckIsSUFBSSxDQUFDQyxHQUFHLENBQUMsQ0FBQyxHQUFHYixHQUFHLENBQUNXLFVBQVUsSUFBSSxJQUFJO0lBQ3BELElBQUlzQixPQUFPLElBQUksQ0FBQyxFQUFFLE9BQU8sQ0FBQztJQUUxQixPQUFPakMsR0FBRyxDQUFDTyxZQUFZLEdBQUcwQixPQUFPO0VBQ3JDLENBQUM7RUFFRDtBQUNKO0FBQ0E7RUFDSWIsa0JBQWtCQSxDQUFDcEIsR0FBRyxFQUFFO0lBQ3BCLElBQUksQ0FBQ0EsR0FBRyxDQUFDVyxVQUFVLEVBQUUsT0FBTyxDQUFDO0lBRTdCLE1BQU0wQixPQUFPLEdBQUdyQyxHQUFHLENBQUNrQixRQUFRLElBQUlOLElBQUksQ0FBQ0MsR0FBRyxDQUFDLENBQUM7SUFDMUMsT0FBTyxDQUFDd0IsT0FBTyxHQUFHckMsR0FBRyxDQUFDVyxVQUFVLElBQUksSUFBSTtFQUM1QyxDQUFDO0VBRUQ7QUFDSjtBQUNBO0VBQ0kyQixjQUFjQSxDQUFDQyxPQUFPLEVBQUU7SUFDcEIsSUFBSSxDQUFDQSxPQUFPLElBQUlBLE9BQU8sSUFBSSxDQUFDLEVBQUU7TUFDMUIsT0FBTyxHQUFHO0lBQ2Q7SUFFQSxJQUFJQSxPQUFPLEdBQUcsRUFBRSxFQUFFO01BQ2QsT0FBTyxHQUFHZCxJQUFJLENBQUNlLEtBQUssQ0FBQ0QsT0FBTyxDQUFDLEdBQUc7SUFDcEMsQ0FBQyxNQUFNLElBQUlBLE9BQU8sR0FBRyxJQUFJLEVBQUU7TUFDdkIsTUFBTUUsT0FBTyxHQUFHaEIsSUFBSSxDQUFDSyxLQUFLLENBQUNTLE9BQU8sR0FBRyxFQUFFLENBQUM7TUFDeEMsTUFBTUcsZ0JBQWdCLEdBQUdqQixJQUFJLENBQUNlLEtBQUssQ0FBQ0QsT0FBTyxHQUFHLEVBQUUsQ0FBQztNQUNqRCxPQUFPLEdBQUdFLE9BQU8sS0FBS0MsZ0JBQWdCLEdBQUc7SUFDN0MsQ0FBQyxNQUFNO01BQ0gsTUFBTUMsS0FBSyxHQUFHbEIsSUFBSSxDQUFDSyxLQUFLLENBQUNTLE9BQU8sR0FBRyxJQUFJLENBQUM7TUFDeEMsTUFBTUUsT0FBTyxHQUFHaEIsSUFBSSxDQUFDSyxLQUFLLENBQUVTLE9BQU8sR0FBRyxJQUFJLEdBQUksRUFBRSxDQUFDO01BQ2pELE9BQU8sR0FBR0ksS0FBSyxLQUFLRixPQUFPLEdBQUc7SUFDbEM7RUFDSixDQUFDO0VBRUQ7QUFDSjtBQUNBO0VBQ0lHLFNBQVNBLENBQUNDLFVBQVUsRUFBRTtJQUNsQixJQUFJLENBQUNBLFVBQVUsSUFBSUEsVUFBVSxJQUFJLENBQUMsRUFBRTtNQUNoQyxPQUFPLFNBQVM7SUFDcEI7SUFFQSxJQUFJQSxVQUFVLEdBQUcsRUFBRSxFQUFFO01BQ2pCLE9BQU8sSUFBSXBCLElBQUksQ0FBQ2UsS0FBSyxDQUFDSyxVQUFVLENBQUMsR0FBRztJQUN4QyxDQUFDLE1BQU0sSUFBSUEsVUFBVSxHQUFHLElBQUksRUFBRTtNQUMxQixNQUFNSixPQUFPLEdBQUdoQixJQUFJLENBQUNxQixJQUFJLENBQUNELFVBQVUsR0FBRyxFQUFFLENBQUM7TUFDMUMsT0FBTyxJQUFJSixPQUFPLEdBQUc7SUFDekIsQ0FBQyxNQUFNO01BQ0gsTUFBTUUsS0FBSyxHQUFHbEIsSUFBSSxDQUFDSyxLQUFLLENBQUNlLFVBQVUsR0FBRyxJQUFJLENBQUM7TUFDM0MsTUFBTUosT0FBTyxHQUFHaEIsSUFBSSxDQUFDcUIsSUFBSSxDQUFFRCxVQUFVLEdBQUcsSUFBSSxHQUFJLEVBQUUsQ0FBQztNQUNuRCxPQUFPLElBQUlGLEtBQUssS0FBS0YsT0FBTyxHQUFHO0lBQ25DO0VBQ0osQ0FBQztFQUVEO0FBQ0o7QUFDQTtFQUNJTSxvQkFBb0JBLENBQUMvQyxHQUFHLEVBQUU7SUFDdEIsSUFBSSxDQUFDQSxHQUFHLEVBQUU7TUFDTixPQUFPO1FBQ0hLLFFBQVEsRUFBRSxDQUFDO1FBQ1hDLE1BQU0sRUFBRSxTQUFTO1FBQ2pCMEMsS0FBSyxFQUFFLE1BQU07UUFDYkMsUUFBUSxFQUFFLEtBQUs7UUFDZkMsSUFBSSxFQUFFO01BQ1YsQ0FBQztJQUNMO0lBRUEsTUFBTUMsTUFBTSxHQUFHO01BQ1g5QyxRQUFRLEVBQUVMLEdBQUcsQ0FBQ0ssUUFBUSxJQUFJLENBQUM7TUFDM0JDLE1BQU0sRUFBRU4sR0FBRyxDQUFDTSxNQUFNLElBQUksU0FBUztNQUMvQjJDLFFBQVEsRUFBRSxLQUFLO01BQ2ZDLElBQUksRUFBRTtJQUNWLENBQUM7O0lBRUQ7SUFDQSxRQUFRbEQsR0FBRyxDQUFDTSxNQUFNO01BQ2QsS0FBSyxRQUFRO1FBQ1Q2QyxNQUFNLENBQUNILEtBQUssR0FBRyxNQUFNO1FBQ3JCRyxNQUFNLENBQUNELElBQUksR0FBRyxRQUFRO1FBQ3RCO01BQ0osS0FBSyxZQUFZO1FBQ2JDLE1BQU0sQ0FBQ0gsS0FBSyxHQUFHLE9BQU87UUFDdEJHLE1BQU0sQ0FBQ0YsUUFBUSxHQUFHLElBQUk7UUFDdEJFLE1BQU0sQ0FBQ0QsSUFBSSxHQUFHLElBQUksQ0FBQ0UsaUJBQWlCLENBQUNwRCxHQUFHLENBQUM7UUFDekM7TUFDSixLQUFLLFdBQVc7UUFDWm1ELE1BQU0sQ0FBQ0gsS0FBSyxHQUFHLE9BQU87UUFDdEJHLE1BQU0sQ0FBQzlDLFFBQVEsR0FBRyxHQUFHO1FBQ3JCOEMsTUFBTSxDQUFDRCxJQUFJLEdBQUcsV0FBVztRQUN6QjtNQUNKLEtBQUssUUFBUTtRQUNUQyxNQUFNLENBQUNILEtBQUssR0FBRyxLQUFLO1FBQ3BCRyxNQUFNLENBQUNELElBQUksR0FBRyxRQUFRO1FBQ3RCO01BQ0osS0FBSyxXQUFXO1FBQ1pDLE1BQU0sQ0FBQ0gsS0FBSyxHQUFHLFFBQVE7UUFDdkJHLE1BQU0sQ0FBQ0QsSUFBSSxHQUFHLFdBQVc7UUFDekI7TUFDSixLQUFLLFFBQVE7UUFDVEMsTUFBTSxDQUFDSCxLQUFLLEdBQUcsUUFBUTtRQUN2QkcsTUFBTSxDQUFDRCxJQUFJLEdBQUcsUUFBUTtRQUN0QjtNQUNKO1FBQ0lDLE1BQU0sQ0FBQ0gsS0FBSyxHQUFHLE1BQU07UUFDckJHLE1BQU0sQ0FBQ0QsSUFBSSxHQUFHLFNBQVM7SUFDL0I7SUFFQSxPQUFPQyxNQUFNO0VBQ2pCLENBQUM7RUFFRDtBQUNKO0FBQ0E7RUFDSUMsaUJBQWlCQSxDQUFDcEQsR0FBRyxFQUFFO0lBQ25CLE1BQU1xRCxLQUFLLEdBQUcsRUFBRTtJQUVoQixJQUFJckQsR0FBRyxDQUFDTyxZQUFZLElBQUlQLEdBQUcsQ0FBQ1MsV0FBVyxFQUFFO01BQ3JDNEMsS0FBSyxDQUFDQyxJQUFJLENBQUMsUUFBUXRELEdBQUcsQ0FBQ08sWUFBWSxJQUFJUCxHQUFHLENBQUNTLFdBQVcsRUFBRSxDQUFDO0lBQzdEO0lBRUEsSUFBSVQsR0FBRyxDQUFDSyxRQUFRLEVBQUU7TUFDZGdELEtBQUssQ0FBQ0MsSUFBSSxDQUFDLEdBQUc3QixJQUFJLENBQUNlLEtBQUssQ0FBQ3hDLEdBQUcsQ0FBQ0ssUUFBUSxDQUFDLEdBQUcsQ0FBQztJQUM5QztJQUVBLElBQUlMLEdBQUcsQ0FBQ2MsR0FBRyxFQUFFO01BQ1R1QyxLQUFLLENBQUNDLElBQUksQ0FBQyxRQUFRLElBQUksQ0FBQ1YsU0FBUyxDQUFDNUMsR0FBRyxDQUFDYyxHQUFHLENBQUMsRUFBRSxDQUFDO0lBQ2pEO0lBRUEsT0FBT3VDLEtBQUssQ0FBQ0UsTUFBTSxHQUFHLENBQUMsR0FBR0YsS0FBSyxDQUFDRyxJQUFJLENBQUMsS0FBSyxDQUFDLEdBQUcsZUFBZTtFQUNqRSxDQUFDO0VBRUQ7QUFDSjtBQUNBO0VBQ0lDLGFBQWFBLENBQUNuRCxNQUFNLEVBQUU7SUFDbEIsTUFBTW9ELEtBQUssR0FBRztNQUNWQyxNQUFNLEVBQUUsR0FBRztNQUNYQyxVQUFVLEVBQUUsR0FBRztNQUNmQyxTQUFTLEVBQUUsR0FBRztNQUNkQyxNQUFNLEVBQUUsR0FBRztNQUNYQyxTQUFTLEVBQUUsSUFBSTtNQUNmQyxNQUFNLEVBQUU7SUFDWixDQUFDO0lBRUQsT0FBT04sS0FBSyxDQUFDcEQsTUFBTSxDQUFDLElBQUksR0FBRztFQUMvQixDQUFDO0VBRUQ7QUFDSjtBQUNBO0VBQ0kyRCxtQkFBbUJBLENBQUMzRCxNQUFNLEVBQUU7SUFDeEIsTUFBTTRELFlBQVksR0FBRztNQUNqQlAsTUFBTSxFQUFFLGVBQWU7TUFDdkJDLFVBQVUsRUFBRSxnQkFBZ0I7TUFDNUJDLFNBQVMsRUFBRSxnQkFBZ0I7TUFDM0JDLE1BQU0sRUFBRSxjQUFjO01BQ3RCQyxTQUFTLEVBQUUsaUJBQWlCO01BQzVCQyxNQUFNLEVBQUU7SUFDWixDQUFDO0lBRUQsT0FBT0UsWUFBWSxDQUFDNUQsTUFBTSxDQUFDLElBQUksZUFBZTtFQUNsRCxDQUFDO0VBRUQ7QUFDSjtBQUNBO0VBQ0k2RCxXQUFXQSxDQUFDbkUsR0FBRyxFQUFFO0lBQ2IsSUFBSSxDQUFDQSxHQUFHLEVBQUUsT0FBTyxLQUFLO0lBRXRCLE1BQU1vRSxjQUFjLEdBQUcsQ0FBQyxRQUFRLEVBQUUsWUFBWSxFQUFFLFFBQVEsQ0FBQztJQUN6RCxPQUFPQSxjQUFjLENBQUN2QyxRQUFRLENBQUM3QixHQUFHLENBQUNNLE1BQU0sQ0FBQztFQUM5QyxDQUFDO0VBRUQ7QUFDSjtBQUNBO0VBQ0krRCxjQUFjQSxDQUFDckUsR0FBRyxFQUFFO0lBQ2hCLE9BQU9BLEdBQUcsSUFBSUEsR0FBRyxDQUFDTSxNQUFNLEtBQUssV0FBVztFQUM1QyxDQUFDO0VBRUQ7QUFDSjtBQUNBO0VBQ0lnRSxXQUFXQSxDQUFDdEUsR0FBRyxFQUFFO0lBQ2IsT0FBT0EsR0FBRyxLQUFLQSxHQUFHLENBQUNNLE1BQU0sS0FBSyxRQUFRLElBQUlOLEdBQUcsQ0FBQ00sTUFBTSxLQUFLLFdBQVcsQ0FBQztFQUN6RSxDQUFDO0VBRUQ7QUFDSjtBQUNBO0VBQ0lpRSxjQUFjQSxDQUFDdkUsR0FBRyxFQUFFO0lBQ2hCLElBQUksQ0FBQ0EsR0FBRyxFQUFFLE9BQU8sQ0FBQztJQUVsQixNQUFNd0UsY0FBYyxHQUFHO01BQ25CWixVQUFVLEVBQUUsSUFBSTtNQUNoQkQsTUFBTSxFQUFFLEdBQUc7TUFDWEssTUFBTSxFQUFFLEdBQUc7TUFDWEYsTUFBTSxFQUFFLEVBQUU7TUFDVkMsU0FBUyxFQUFFLENBQUM7TUFDWkYsU0FBUyxFQUFFO0lBQ2YsQ0FBQztJQUVELE1BQU1ZLFlBQVksR0FBR0QsY0FBYyxDQUFDeEUsR0FBRyxDQUFDTSxNQUFNLENBQUMsSUFBSSxDQUFDO0lBQ3BELE1BQU1vRSxZQUFZLEdBQUcxRSxHQUFHLENBQUMyRSxVQUFVLEdBQUcsQ0FBQy9ELElBQUksQ0FBQ0MsR0FBRyxDQUFDLENBQUMsR0FBRyxJQUFJRCxJQUFJLENBQUNaLEdBQUcsQ0FBQzJFLFVBQVUsQ0FBQyxDQUFDQyxPQUFPLENBQUMsQ0FBQyxJQUFJLElBQUksR0FBRyxDQUFDO0lBRWxHLE9BQU9ILFlBQVksR0FBSUMsWUFBWSxHQUFHLElBQUssQ0FBQyxDQUFDO0VBQ2pELENBQUM7RUFFRDtBQUNKO0FBQ0E7RUFDSUcsa0JBQWtCQSxDQUFDQyxJQUFJLEVBQUU7SUFDckIsSUFBSSxDQUFDQyxLQUFLLENBQUNDLE9BQU8sQ0FBQ0YsSUFBSSxDQUFDLEVBQUUsT0FBTyxFQUFFO0lBRW5DLE9BQU8sQ0FBQyxHQUFHQSxJQUFJLENBQUMsQ0FBQ0csSUFBSSxDQUFDLENBQUNDLENBQUMsRUFBRUMsQ0FBQyxLQUFLO01BQzVCLE1BQU1DLFNBQVMsR0FBRyxJQUFJLENBQUNiLGNBQWMsQ0FBQ1csQ0FBQyxDQUFDO01BQ3hDLE1BQU1HLFNBQVMsR0FBRyxJQUFJLENBQUNkLGNBQWMsQ0FBQ1ksQ0FBQyxDQUFDO01BQ3hDLE9BQU9FLFNBQVMsR0FBR0QsU0FBUyxDQUFDLENBQUM7SUFDbEMsQ0FBQyxDQUFDO0VBQ04sQ0FBQztFQUVEO0FBQ0o7QUFDQTtFQUNJRSxxQkFBcUJBLENBQUNSLElBQUksRUFBRTtJQUN4QixJQUFJLENBQUNDLEtBQUssQ0FBQ0MsT0FBTyxDQUFDRixJQUFJLENBQUMsSUFBSUEsSUFBSSxDQUFDdkIsTUFBTSxLQUFLLENBQUMsRUFBRTtNQUMzQyxPQUFPO1FBQ0hnQyxLQUFLLEVBQUUsQ0FBQztRQUNSNUIsTUFBTSxFQUFFLENBQUM7UUFDVEMsVUFBVSxFQUFFLENBQUM7UUFDYkMsU0FBUyxFQUFFLENBQUM7UUFDWkMsTUFBTSxFQUFFLENBQUM7UUFDVEMsU0FBUyxFQUFFLENBQUM7UUFDWkMsTUFBTSxFQUFFLENBQUM7UUFDVHdCLGVBQWUsRUFBRSxDQUFDO1FBQ2xCQyxrQkFBa0IsRUFBRTtNQUN4QixDQUFDO0lBQ0w7SUFFQSxNQUFNQyxLQUFLLEdBQUc7TUFDVkgsS0FBSyxFQUFFVCxJQUFJLENBQUN2QixNQUFNO01BQ2xCSSxNQUFNLEVBQUUsQ0FBQztNQUNUQyxVQUFVLEVBQUUsQ0FBQztNQUNiQyxTQUFTLEVBQUUsQ0FBQztNQUNaQyxNQUFNLEVBQUUsQ0FBQztNQUNUQyxTQUFTLEVBQUUsQ0FBQztNQUNaQyxNQUFNLEVBQUUsQ0FBQztNQUNUd0IsZUFBZSxFQUFFLENBQUM7TUFDbEJDLGtCQUFrQixFQUFFO0lBQ3hCLENBQUM7SUFFRCxJQUFJRSxhQUFhLEdBQUcsQ0FBQztJQUNyQixJQUFJQyxRQUFRLEdBQUcsQ0FBQztJQUVoQmQsSUFBSSxDQUFDZSxPQUFPLENBQUM3RixHQUFHLElBQUk7TUFDaEIsSUFBSUEsR0FBRyxDQUFDTSxNQUFNLEVBQUU7UUFDWm9GLEtBQUssQ0FBQzFGLEdBQUcsQ0FBQ00sTUFBTSxDQUFDLEdBQUcsQ0FBQ29GLEtBQUssQ0FBQzFGLEdBQUcsQ0FBQ00sTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUM7TUFDcEQ7TUFFQXFGLGFBQWEsSUFBSTNGLEdBQUcsQ0FBQ0ssUUFBUSxJQUFJLENBQUM7TUFFbEMsSUFBSUwsR0FBRyxDQUFDYyxHQUFHLElBQUksSUFBSSxDQUFDcUQsV0FBVyxDQUFDbkUsR0FBRyxDQUFDLEVBQUU7UUFDbEM0RixRQUFRLElBQUk1RixHQUFHLENBQUNjLEdBQUc7TUFDdkI7SUFDSixDQUFDLENBQUM7SUFFRjRFLEtBQUssQ0FBQ0YsZUFBZSxHQUFHRyxhQUFhLEdBQUdiLElBQUksQ0FBQ3ZCLE1BQU07SUFDbkRtQyxLQUFLLENBQUNELGtCQUFrQixHQUFHRyxRQUFRO0lBRW5DLE9BQU9GLEtBQUs7RUFDaEIsQ0FBQztFQUVEO0FBQ0o7QUFDQTtFQUNJSSxtQkFBbUJBLENBQUM5RixHQUFHLEVBQUUrRixXQUFXLEdBQUcsSUFBSSxFQUFFO0lBQ3pDLE1BQU1DLEtBQUssR0FBRztNQUNWQyxLQUFLLEVBQUVqRyxHQUFHLENBQUNrRyxFQUFFO01BQ2I1RixNQUFNLEVBQUVOLEdBQUcsQ0FBQ00sTUFBTTtNQUNsQkQsUUFBUSxFQUFFTCxHQUFHLENBQUNLLFFBQVE7TUFDdEI4RixTQUFTLEVBQUV2RixJQUFJLENBQUNDLEdBQUcsQ0FBQyxDQUFDO01BQ3JCdUYsT0FBTyxFQUFFLENBQUM7SUFDZCxDQUFDO0lBRUQsSUFBSUwsV0FBVyxFQUFFO01BQ2I7TUFDQSxJQUFJQSxXQUFXLENBQUN6RixNQUFNLEtBQUtOLEdBQUcsQ0FBQ00sTUFBTSxFQUFFO1FBQ25DMEYsS0FBSyxDQUFDSSxPQUFPLENBQUM5RixNQUFNLEdBQUc7VUFBRStGLElBQUksRUFBRU4sV0FBVyxDQUFDekYsTUFBTTtVQUFFZ0csRUFBRSxFQUFFdEcsR0FBRyxDQUFDTTtRQUFPLENBQUM7TUFDdkU7TUFFQSxJQUFJeUYsV0FBVyxDQUFDMUYsUUFBUSxLQUFLTCxHQUFHLENBQUNLLFFBQVEsRUFBRTtRQUN2QzJGLEtBQUssQ0FBQ0ksT0FBTyxDQUFDL0YsUUFBUSxHQUFHO1VBQUVnRyxJQUFJLEVBQUVOLFdBQVcsQ0FBQzFGLFFBQVE7VUFBRWlHLEVBQUUsRUFBRXRHLEdBQUcsQ0FBQ0s7UUFBUyxDQUFDO01BQzdFO01BRUEsSUFBSTBGLFdBQVcsQ0FBQ3hGLFlBQVksS0FBS1AsR0FBRyxDQUFDTyxZQUFZLEVBQUU7UUFDL0N5RixLQUFLLENBQUNJLE9BQU8sQ0FBQ0csSUFBSSxHQUFHO1VBQUVGLElBQUksRUFBRU4sV0FBVyxDQUFDeEYsWUFBWTtVQUFFK0YsRUFBRSxFQUFFdEcsR0FBRyxDQUFDTztRQUFhLENBQUM7TUFDakY7SUFDSjtJQUVBLE9BQU95RixLQUFLO0VBQ2hCO0FBQ0osQ0FBQzs7QUFFRDtBQUNBLElBQUksT0FBT1EsTUFBTSxLQUFLLFdBQVcsSUFBSUEsTUFBTSxDQUFDQyxPQUFPLEVBQUU7RUFDakRELE1BQU0sQ0FBQ0MsT0FBTyxHQUFHO0lBQUUzRztFQUFtQixDQUFDO0FBQzNDLENBQUMsTUFBTSxJQUFJLE9BQU80RyxNQUFNLEtBQUssV0FBVyxFQUFFO0VBQ3RDQSxNQUFNLENBQUM1RyxrQkFBa0IsR0FBR0Esa0JBQWtCO0FBQ2xEIiwiaWdub3JlTGlzdCI6W119