6bbb412e4479c4ba5dc0583639b8bdb4
/**
 * PWA Manager - Main Module
 * 
 * Coordinates all PWA functionality and provides the main interface.
 */

// Import required modules
if (typeof window !== 'undefined') {
  // Browser environment - modules loaded via script tags
} else {
  // Node.js environment - for testing
  // eslint-disable-next-line no-unused-vars
  const {
    pwaServiceWorker
  } = require('./service-worker');
  // eslint-disable-next-line no-unused-vars
  const {
    pwaInstallation
  } = require('./installation');
  // eslint-disable-next-line no-unused-vars
  const {
    pwaOffline
  } = require('./offline');
  // eslint-disable-next-line no-unused-vars
  const {
    pwaCache
  } = require('./cache');
  // eslint-disable-next-line no-unused-vars
  const {
    pwaUI
  } = require('./ui');
}

/**
 * Main PWA Manager class
 */
class PWAManager {
  constructor(options = {}) {
    this.options = {
      enableLogging: true,
      autoUpdate: true,
      enableOfflineMode: true,
      enableInstallPrompt: true,
      enableCaching: true,
      enableNotifications: true,
      ...options
    };
    this.state = {
      isInitialized: false,
      isOnline: navigator.onLine,
      isInstalled: false,
      hasUpdate: false,
      swRegistration: null,
      deferredPrompt: null,
      offlineState: null
    };
    this.callbacks = {
      onReady: null,
      onInstalled: null,
      onUpdateAvailable: null,
      onOffline: null,
      onOnline: null,
      onError: null,
      ...options.callbacks
    };

    // Initialize notification queue
    if (this.options.enableNotifications) {
      this.notificationQueue = window.pwaUI?.createNotificationQueue?.(3);
    }
    this.init();
  }

  /**
   * Initializes the PWA Manager
   */
  async init() {
    if (this.state.isInitialized) return;
    try {
      this.log('Initializing PWA Manager...');

      // Check installation status
      if (this.options.enableInstallPrompt) {
        await this.initInstallation();
      }

      // Register service worker
      await this.initServiceWorker();

      // Initialize offline capabilities
      if (this.options.enableOfflineMode) {
        await this.initOfflineMode();
      }

      // Initialize UI components
      if (this.options.enableNotifications) {
        this.initUI();
      }
      this.state.isInitialized = true;
      this.log('PWA Manager initialized successfully');
      if (this.callbacks.onReady) {
        this.callbacks.onReady(this.getStatus());
      }
    } catch (error) {
      this.handleError('Initialization failed', error);
    }
  }

  /**
   * Initializes installation management
   */
  async initInstallation() {
    if (!window.pwaInstallation) {
      this.log('Installation module not available', 'warn');
      return;
    }

    // Check current installation status
    const status = window.pwaInstallation.checkInstallationStatus();
    this.state.isInstalled = status.isInstalled;

    // Set up installation event listeners
    const installManager = window.pwaInstallation.setupEventListeners({
      onInstallPromptAvailable: event => {
        this.state.deferredPrompt = event;
        this.showInstallPrompt();
      },
      onAppInstalled: () => {
        this.state.isInstalled = true;
        this.hideInstallPrompt();
        this.showNotification('App Installed!', 'LoRA Manager is now available from your home screen.', 'success');
        if (this.callbacks.onInstalled) {
          this.callbacks.onInstalled();
        }
      }
    });

    // Store cleanup function
    this.installCleanup = installManager.cleanup;
    this.getDeferredPrompt = installManager.getDeferredPrompt;
  }

  /**
   * Initializes service worker
   */
  async initServiceWorker() {
    if (!window.pwaServiceWorker) {
      this.log('Service Worker module not available', 'warn');
      return;
    }
    try {
      // Register service worker
      this.state.swRegistration = await window.pwaServiceWorker.register();

      // Set up service worker event listeners
      this.swCleanup = window.pwaServiceWorker.setupEventListeners(this.state.swRegistration, {
        onUpdateAvailable: () => {
          this.state.hasUpdate = true;
          this.showUpdateAvailable();
          if (this.callbacks.onUpdateAvailable) {
            this.callbacks.onUpdateAvailable();
          }
        },
        onControllerChange: () => {
          window.location.reload();
        }
      });

      // Check for updates if enabled
      if (this.options.autoUpdate) {
        await this.checkForUpdates();
      }
    } catch (error) {
      this.handleError('Service Worker initialization failed', error);
    }
  }

  /**
   * Initializes offline mode
   */
  async initOfflineMode() {
    if (!window.pwaOffline) {
      this.log('Offline module not available', 'warn');
      return;
    }

    // Initialize offline state
    this.state.offlineState = window.pwaOffline.init({
      onOnline: () => {
        this.state.isOnline = true;
        this.showNotification('Back Online!', 'Connection restored. Syncing data...', 'success');
        if (this.callbacks.onOnline) {
          this.callbacks.onOnline();
        }
      },
      onOffline: () => {
        this.state.isOnline = false;
        this.showNotification('You\'re Offline', 'Working in offline mode with cached data.', 'warning');
        if (this.callbacks.onOffline) {
          this.callbacks.onOffline();
        }
      }
    });

    // Create offline indicator
    const indicator = window.pwaOffline.createOfflineIndicator();
    document.body.appendChild(indicator);

    // Update initial status
    window.pwaOffline.toggleOfflineIndicator(!this.state.isOnline);
  }

  /**
   * Initializes UI components
   */
  initUI() {
    if (!window.pwaUI) {
      this.log('UI module not available', 'warn');
      return;
    }

    // Apply responsive styles
    window.pwaUI.applyResponsiveStyles();

    // Handle window resize
    window.addEventListener('resize', () => {
      window.pwaUI.applyResponsiveStyles();
    });
  }

  /**
   * Shows install prompt
   */
  showInstallPrompt() {
    if (!window.pwaInstallation || this.state.isInstalled) return;
    const dismissal = window.pwaInstallation.manageInstallDismissal();
    if (dismissal.isDismissed()) return;
    const prompt = window.pwaInstallation.createInstallPrompt();
    document.body.appendChild(prompt);

    // Set up event listeners
    prompt.querySelector('#pwa-install-btn').addEventListener('click', () => {
      this.installApp();
    });
    prompt.querySelector('#pwa-dismiss-btn').addEventListener('click', () => {
      dismissal.dismiss();
      this.hideInstallPrompt();
    });
    prompt.querySelector('#pwa-close-btn').addEventListener('click', () => {
      this.hideInstallPrompt();
    });
  }

  /**
   * Hides install prompt
   */
  hideInstallPrompt() {
    const prompt = document.getElementById('pwa-install-prompt');
    if (prompt) {
      prompt.remove();
    }
  }

  /**
   * Installs the PWA
   */
  async installApp() {
    if (!this.state.deferredPrompt) {
      this.showNotification('Installation Not Available', 'Install option is not currently available.', 'warning');
      return;
    }
    try {
      const result = await window.pwaInstallation.triggerInstall(this.state.deferredPrompt);
      if (result.userChoice) {
        this.log('User accepted install prompt');
      } else {
        this.log('User dismissed install prompt');
      }
      this.state.deferredPrompt = null;
      this.hideInstallPrompt();
    } catch (error) {
      this.handleError('Installation failed', error);
    }
  }

  /**
   * Shows update available notification
   */
  showUpdateAvailable() {
    if (!window.pwaUI) return;
    window.pwaUI.showUpdateBanner(() => this.updateApp(), () => this.log('User dismissed update notification'));
  }

  /**
   * Updates the app
   */
  updateApp() {
    if (!this.state.swRegistration) return;
    window.pwaServiceWorker.activateWaiting(this.state.swRegistration);
  }

  /**
   * Checks for app updates
   */
  async checkForUpdates() {
    if (!this.state.swRegistration) return;
    try {
      await window.pwaServiceWorker.checkForUpdates(this.state.swRegistration);
    } catch (error) {
      this.handleError('Update check failed', error);
    }
  }

  /**
   * Shows notification
   */
  showNotification(title, message, type = 'info') {
    if (!this.options.enableNotifications || !window.pwaUI) return;
    if (this.notificationQueue) {
      this.notificationQueue.add(title, message, type);
    } else {
      window.pwaUI.showNotification(title, message, type);
    }
  }

  /**
   * Gets cache information
   */
  async getCacheInfo() {
    if (!this.state.swRegistration || !window.pwaCache) return null;
    try {
      return await window.pwaCache.getCacheStatus(this.state.swRegistration);
    } catch (error) {
      this.handleError('Failed to get cache info', error);
      return null;
    }
  }

  /**
   * Clears cache
   */
  async clearCache() {
    if (!this.state.swRegistration || !window.pwaCache) return false;
    try {
      const success = await window.pwaCache.clearAllCaches(this.state.swRegistration);
      if (success) {
        this.showNotification('Cache Cleared', 'All cached data has been removed.', 'success');
      }
      return success;
    } catch (error) {
      this.handleError('Failed to clear cache', error);
      return false;
    }
  }

  /**
   * Gets PWA status
   */
  getStatus() {
    return {
      isInitialized: this.state.isInitialized,
      isOnline: this.state.isOnline,
      isInstalled: this.state.isInstalled,
      hasUpdate: this.state.hasUpdate,
      hasServiceWorker: Boolean(this.state.swRegistration),
      queuedActions: this.state.offlineState?.queuedActions?.length || 0,
      capabilities: window.pwaServiceWorker?.getCapabilities?.() || {},
      installCriteria: window.pwaInstallation?.getInstallCriteria?.() || {}
    };
  }

  /**
   * Gets analytics data
   */
  getAnalytics() {
    return {
      installation: window.pwaInstallation?.getInstallationAnalytics?.() || {},
      offline: window.pwaOffline?.getOfflineStatus?.(this.state.offlineState) || {},
      serviceWorker: window.pwaServiceWorker?.getPerformanceMetrics?.(this.state.swRegistration) || {},
      timestamp: Date.now()
    };
  }

  /**
   * Handles errors
   */
  handleError(context, error) {
    const message = `PWA Manager - ${context}: ${error.message}`;
    this.log(message, 'error');
    if (this.callbacks.onError) {
      this.callbacks.onError(error, context);
    }

    // Show user-friendly error notification
    if (this.options.enableNotifications) {
      this.showNotification('Error', 'Something went wrong. Please try again.', 'error');
    }
  }

  /**
   * Logs messages
   */
  log(message, level = 'info') {
    if (!this.options.enableLogging) return;
    const logMessage = `[PWA Manager] ${message}`;
    if (window.DevLogger) {
      window.DevLogger[level]?.(logMessage);
    } else {
      // eslint-disable-next-line no-console
      console[level]?.(logMessage);
    }
  }

  /**
   * Cleanup method
   */
  destroy() {
    if (this.installCleanup) {
      this.installCleanup();
    }
    if (this.swCleanup) {
      this.swCleanup();
    }
    if (this.notificationQueue) {
      this.notificationQueue.clear();
    }
    this.state.isInitialized = false;
  }
}

// Initialize PWA Manager when DOM is loaded
if (typeof document !== 'undefined') {
  document.addEventListener('DOMContentLoaded', () => {
    window.pwaManager = new PWAManager();
  });
}

// Export for use in other modules
if (typeof module !== 'undefined' && module.exports) {
  // Export as both default and named export for CommonJS consumers and tests
  module.exports = PWAManager;
  module.exports.PWAManager = PWAManager;
}
if (typeof window !== 'undefined') {
  window.PWAManager = PWAManager;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJ3aW5kb3ciLCJwd2FTZXJ2aWNlV29ya2VyIiwicmVxdWlyZSIsInB3YUluc3RhbGxhdGlvbiIsInB3YU9mZmxpbmUiLCJwd2FDYWNoZSIsInB3YVVJIiwiUFdBTWFuYWdlciIsImNvbnN0cnVjdG9yIiwib3B0aW9ucyIsImVuYWJsZUxvZ2dpbmciLCJhdXRvVXBkYXRlIiwiZW5hYmxlT2ZmbGluZU1vZGUiLCJlbmFibGVJbnN0YWxsUHJvbXB0IiwiZW5hYmxlQ2FjaGluZyIsImVuYWJsZU5vdGlmaWNhdGlvbnMiLCJzdGF0ZSIsImlzSW5pdGlhbGl6ZWQiLCJpc09ubGluZSIsIm5hdmlnYXRvciIsIm9uTGluZSIsImlzSW5zdGFsbGVkIiwiaGFzVXBkYXRlIiwic3dSZWdpc3RyYXRpb24iLCJkZWZlcnJlZFByb21wdCIsIm9mZmxpbmVTdGF0ZSIsImNhbGxiYWNrcyIsIm9uUmVhZHkiLCJvbkluc3RhbGxlZCIsIm9uVXBkYXRlQXZhaWxhYmxlIiwib25PZmZsaW5lIiwib25PbmxpbmUiLCJvbkVycm9yIiwibm90aWZpY2F0aW9uUXVldWUiLCJjcmVhdGVOb3RpZmljYXRpb25RdWV1ZSIsImluaXQiLCJsb2ciLCJpbml0SW5zdGFsbGF0aW9uIiwiaW5pdFNlcnZpY2VXb3JrZXIiLCJpbml0T2ZmbGluZU1vZGUiLCJpbml0VUkiLCJnZXRTdGF0dXMiLCJlcnJvciIsImhhbmRsZUVycm9yIiwic3RhdHVzIiwiY2hlY2tJbnN0YWxsYXRpb25TdGF0dXMiLCJpbnN0YWxsTWFuYWdlciIsInNldHVwRXZlbnRMaXN0ZW5lcnMiLCJvbkluc3RhbGxQcm9tcHRBdmFpbGFibGUiLCJldmVudCIsInNob3dJbnN0YWxsUHJvbXB0Iiwib25BcHBJbnN0YWxsZWQiLCJoaWRlSW5zdGFsbFByb21wdCIsInNob3dOb3RpZmljYXRpb24iLCJpbnN0YWxsQ2xlYW51cCIsImNsZWFudXAiLCJnZXREZWZlcnJlZFByb21wdCIsInJlZ2lzdGVyIiwic3dDbGVhbnVwIiwic2hvd1VwZGF0ZUF2YWlsYWJsZSIsIm9uQ29udHJvbGxlckNoYW5nZSIsImxvY2F0aW9uIiwicmVsb2FkIiwiY2hlY2tGb3JVcGRhdGVzIiwiaW5kaWNhdG9yIiwiY3JlYXRlT2ZmbGluZUluZGljYXRvciIsImRvY3VtZW50IiwiYm9keSIsImFwcGVuZENoaWxkIiwidG9nZ2xlT2ZmbGluZUluZGljYXRvciIsImFwcGx5UmVzcG9uc2l2ZVN0eWxlcyIsImFkZEV2ZW50TGlzdGVuZXIiLCJkaXNtaXNzYWwiLCJtYW5hZ2VJbnN0YWxsRGlzbWlzc2FsIiwiaXNEaXNtaXNzZWQiLCJwcm9tcHQiLCJjcmVhdGVJbnN0YWxsUHJvbXB0IiwicXVlcnlTZWxlY3RvciIsImluc3RhbGxBcHAiLCJkaXNtaXNzIiwiZ2V0RWxlbWVudEJ5SWQiLCJyZW1vdmUiLCJyZXN1bHQiLCJ0cmlnZ2VySW5zdGFsbCIsInVzZXJDaG9pY2UiLCJzaG93VXBkYXRlQmFubmVyIiwidXBkYXRlQXBwIiwiYWN0aXZhdGVXYWl0aW5nIiwidGl0bGUiLCJtZXNzYWdlIiwidHlwZSIsImFkZCIsImdldENhY2hlSW5mbyIsImdldENhY2hlU3RhdHVzIiwiY2xlYXJDYWNoZSIsInN1Y2Nlc3MiLCJjbGVhckFsbENhY2hlcyIsImhhc1NlcnZpY2VXb3JrZXIiLCJCb29sZWFuIiwicXVldWVkQWN0aW9ucyIsImxlbmd0aCIsImNhcGFiaWxpdGllcyIsImdldENhcGFiaWxpdGllcyIsImluc3RhbGxDcml0ZXJpYSIsImdldEluc3RhbGxDcml0ZXJpYSIsImdldEFuYWx5dGljcyIsImluc3RhbGxhdGlvbiIsImdldEluc3RhbGxhdGlvbkFuYWx5dGljcyIsIm9mZmxpbmUiLCJnZXRPZmZsaW5lU3RhdHVzIiwic2VydmljZVdvcmtlciIsImdldFBlcmZvcm1hbmNlTWV0cmljcyIsInRpbWVzdGFtcCIsIkRhdGUiLCJub3ciLCJjb250ZXh0IiwibGV2ZWwiLCJsb2dNZXNzYWdlIiwiRGV2TG9nZ2VyIiwiY29uc29sZSIsImRlc3Ryb3kiLCJjbGVhciIsInB3YU1hbmFnZXIiLCJtb2R1bGUiLCJleHBvcnRzIl0sInNvdXJjZXMiOlsiaW5kZXguanMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBQV0EgTWFuYWdlciAtIE1haW4gTW9kdWxlXG4gKiBcbiAqIENvb3JkaW5hdGVzIGFsbCBQV0EgZnVuY3Rpb25hbGl0eSBhbmQgcHJvdmlkZXMgdGhlIG1haW4gaW50ZXJmYWNlLlxuICovXG5cbi8vIEltcG9ydCByZXF1aXJlZCBtb2R1bGVzXG5pZiAodHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAvLyBCcm93c2VyIGVudmlyb25tZW50IC0gbW9kdWxlcyBsb2FkZWQgdmlhIHNjcmlwdCB0YWdzXG59IGVsc2Uge1xuICAgIC8vIE5vZGUuanMgZW52aXJvbm1lbnQgLSBmb3IgdGVzdGluZ1xuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby11bnVzZWQtdmFyc1xuICAgIGNvbnN0IHsgcHdhU2VydmljZVdvcmtlciB9ID0gcmVxdWlyZSgnLi9zZXJ2aWNlLXdvcmtlcicpO1xuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby11bnVzZWQtdmFyc1xuICAgIGNvbnN0IHsgcHdhSW5zdGFsbGF0aW9uIH0gPSByZXF1aXJlKCcuL2luc3RhbGxhdGlvbicpO1xuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby11bnVzZWQtdmFyc1xuICAgIGNvbnN0IHsgcHdhT2ZmbGluZSB9ID0gcmVxdWlyZSgnLi9vZmZsaW5lJyk7XG4gICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXVudXNlZC12YXJzXG4gICAgY29uc3QgeyBwd2FDYWNoZSB9ID0gcmVxdWlyZSgnLi9jYWNoZScpO1xuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby11bnVzZWQtdmFyc1xuICAgIGNvbnN0IHsgcHdhVUkgfSA9IHJlcXVpcmUoJy4vdWknKTtcbn1cblxuLyoqXG4gKiBNYWluIFBXQSBNYW5hZ2VyIGNsYXNzXG4gKi9cbmNsYXNzIFBXQU1hbmFnZXIge1xuICAgIGNvbnN0cnVjdG9yKG9wdGlvbnMgPSB7fSkge1xuICAgICAgICB0aGlzLm9wdGlvbnMgPSB7XG4gICAgICAgICAgICBlbmFibGVMb2dnaW5nOiB0cnVlLFxuICAgICAgICAgICAgYXV0b1VwZGF0ZTogdHJ1ZSxcbiAgICAgICAgICAgIGVuYWJsZU9mZmxpbmVNb2RlOiB0cnVlLFxuICAgICAgICAgICAgZW5hYmxlSW5zdGFsbFByb21wdDogdHJ1ZSxcbiAgICAgICAgICAgIGVuYWJsZUNhY2hpbmc6IHRydWUsXG4gICAgICAgICAgICBlbmFibGVOb3RpZmljYXRpb25zOiB0cnVlLFxuICAgICAgICAgICAgLi4ub3B0aW9uc1xuICAgICAgICB9O1xuICAgICAgICBcbiAgICAgICAgdGhpcy5zdGF0ZSA9IHtcbiAgICAgICAgICAgIGlzSW5pdGlhbGl6ZWQ6IGZhbHNlLFxuICAgICAgICAgICAgaXNPbmxpbmU6IG5hdmlnYXRvci5vbkxpbmUsXG4gICAgICAgICAgICBpc0luc3RhbGxlZDogZmFsc2UsXG4gICAgICAgICAgICBoYXNVcGRhdGU6IGZhbHNlLFxuICAgICAgICAgICAgc3dSZWdpc3RyYXRpb246IG51bGwsXG4gICAgICAgICAgICBkZWZlcnJlZFByb21wdDogbnVsbCxcbiAgICAgICAgICAgIG9mZmxpbmVTdGF0ZTogbnVsbFxuICAgICAgICB9O1xuICAgICAgICBcbiAgICAgICAgdGhpcy5jYWxsYmFja3MgPSB7XG4gICAgICAgICAgICBvblJlYWR5OiBudWxsLFxuICAgICAgICAgICAgb25JbnN0YWxsZWQ6IG51bGwsXG4gICAgICAgICAgICBvblVwZGF0ZUF2YWlsYWJsZTogbnVsbCxcbiAgICAgICAgICAgIG9uT2ZmbGluZTogbnVsbCxcbiAgICAgICAgICAgIG9uT25saW5lOiBudWxsLFxuICAgICAgICAgICAgb25FcnJvcjogbnVsbCxcbiAgICAgICAgICAgIC4uLm9wdGlvbnMuY2FsbGJhY2tzXG4gICAgICAgIH07XG4gICAgICAgIFxuICAgICAgICAvLyBJbml0aWFsaXplIG5vdGlmaWNhdGlvbiBxdWV1ZVxuICAgICAgICBpZiAodGhpcy5vcHRpb25zLmVuYWJsZU5vdGlmaWNhdGlvbnMpIHtcbiAgICAgICAgICAgIHRoaXMubm90aWZpY2F0aW9uUXVldWUgPSB3aW5kb3cucHdhVUk/LmNyZWF0ZU5vdGlmaWNhdGlvblF1ZXVlPy4oMyk7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIHRoaXMuaW5pdCgpO1xuICAgIH1cbiAgICBcbiAgICAvKipcbiAgICAgKiBJbml0aWFsaXplcyB0aGUgUFdBIE1hbmFnZXJcbiAgICAgKi9cbiAgICBhc3luYyBpbml0KCkge1xuICAgICAgICBpZiAodGhpcy5zdGF0ZS5pc0luaXRpYWxpemVkKSByZXR1cm47XG4gICAgICAgIFxuICAgICAgICB0cnkge1xuICAgICAgICAgICAgdGhpcy5sb2coJ0luaXRpYWxpemluZyBQV0EgTWFuYWdlci4uLicpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyBDaGVjayBpbnN0YWxsYXRpb24gc3RhdHVzXG4gICAgICAgICAgICBpZiAodGhpcy5vcHRpb25zLmVuYWJsZUluc3RhbGxQcm9tcHQpIHtcbiAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLmluaXRJbnN0YWxsYXRpb24oKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLy8gUmVnaXN0ZXIgc2VydmljZSB3b3JrZXJcbiAgICAgICAgICAgIGF3YWl0IHRoaXMuaW5pdFNlcnZpY2VXb3JrZXIoKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLy8gSW5pdGlhbGl6ZSBvZmZsaW5lIGNhcGFiaWxpdGllc1xuICAgICAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5lbmFibGVPZmZsaW5lTW9kZSkge1xuICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuaW5pdE9mZmxpbmVNb2RlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIEluaXRpYWxpemUgVUkgY29tcG9uZW50c1xuICAgICAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5lbmFibGVOb3RpZmljYXRpb25zKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5pbml0VUkoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIFxuICAgICAgICAgICAgdGhpcy5zdGF0ZS5pc0luaXRpYWxpemVkID0gdHJ1ZTtcbiAgICAgICAgICAgIHRoaXMubG9nKCdQV0EgTWFuYWdlciBpbml0aWFsaXplZCBzdWNjZXNzZnVsbHknKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgaWYgKHRoaXMuY2FsbGJhY2tzLm9uUmVhZHkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmNhbGxiYWNrcy5vblJlYWR5KHRoaXMuZ2V0U3RhdHVzKCkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgXG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICB0aGlzLmhhbmRsZUVycm9yKCdJbml0aWFsaXphdGlvbiBmYWlsZWQnLCBlcnJvcik7XG4gICAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgLyoqXG4gICAgICogSW5pdGlhbGl6ZXMgaW5zdGFsbGF0aW9uIG1hbmFnZW1lbnRcbiAgICAgKi9cbiAgICBhc3luYyBpbml0SW5zdGFsbGF0aW9uKCkge1xuICAgICAgICBpZiAoIXdpbmRvdy5wd2FJbnN0YWxsYXRpb24pIHtcbiAgICAgICAgICAgIHRoaXMubG9nKCdJbnN0YWxsYXRpb24gbW9kdWxlIG5vdCBhdmFpbGFibGUnLCAnd2FybicpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICAvLyBDaGVjayBjdXJyZW50IGluc3RhbGxhdGlvbiBzdGF0dXNcbiAgICAgICAgY29uc3Qgc3RhdHVzID0gd2luZG93LnB3YUluc3RhbGxhdGlvbi5jaGVja0luc3RhbGxhdGlvblN0YXR1cygpO1xuICAgICAgICB0aGlzLnN0YXRlLmlzSW5zdGFsbGVkID0gc3RhdHVzLmlzSW5zdGFsbGVkO1xuICAgICAgICBcbiAgICAgICAgLy8gU2V0IHVwIGluc3RhbGxhdGlvbiBldmVudCBsaXN0ZW5lcnNcbiAgICAgICAgY29uc3QgaW5zdGFsbE1hbmFnZXIgPSB3aW5kb3cucHdhSW5zdGFsbGF0aW9uLnNldHVwRXZlbnRMaXN0ZW5lcnMoe1xuICAgICAgICAgICAgb25JbnN0YWxsUHJvbXB0QXZhaWxhYmxlOiAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLnN0YXRlLmRlZmVycmVkUHJvbXB0ID0gZXZlbnQ7XG4gICAgICAgICAgICAgICAgdGhpcy5zaG93SW5zdGFsbFByb21wdCgpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG9uQXBwSW5zdGFsbGVkOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5zdGF0ZS5pc0luc3RhbGxlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgdGhpcy5oaWRlSW5zdGFsbFByb21wdCgpO1xuICAgICAgICAgICAgICAgIHRoaXMuc2hvd05vdGlmaWNhdGlvbignQXBwIEluc3RhbGxlZCEnLCAnTG9SQSBNYW5hZ2VyIGlzIG5vdyBhdmFpbGFibGUgZnJvbSB5b3VyIGhvbWUgc2NyZWVuLicsICdzdWNjZXNzJyk7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuY2FsbGJhY2tzLm9uSW5zdGFsbGVkKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2FsbGJhY2tzLm9uSW5zdGFsbGVkKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgXG4gICAgICAgIC8vIFN0b3JlIGNsZWFudXAgZnVuY3Rpb25cbiAgICAgICAgdGhpcy5pbnN0YWxsQ2xlYW51cCA9IGluc3RhbGxNYW5hZ2VyLmNsZWFudXA7XG4gICAgICAgIHRoaXMuZ2V0RGVmZXJyZWRQcm9tcHQgPSBpbnN0YWxsTWFuYWdlci5nZXREZWZlcnJlZFByb21wdDtcbiAgICB9XG4gICAgXG4gICAgLyoqXG4gICAgICogSW5pdGlhbGl6ZXMgc2VydmljZSB3b3JrZXJcbiAgICAgKi9cbiAgICBhc3luYyBpbml0U2VydmljZVdvcmtlcigpIHtcbiAgICAgICAgaWYgKCF3aW5kb3cucHdhU2VydmljZVdvcmtlcikge1xuICAgICAgICAgICAgdGhpcy5sb2coJ1NlcnZpY2UgV29ya2VyIG1vZHVsZSBub3QgYXZhaWxhYmxlJywgJ3dhcm4nKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIC8vIFJlZ2lzdGVyIHNlcnZpY2Ugd29ya2VyXG4gICAgICAgICAgICB0aGlzLnN0YXRlLnN3UmVnaXN0cmF0aW9uID0gYXdhaXQgd2luZG93LnB3YVNlcnZpY2VXb3JrZXIucmVnaXN0ZXIoKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLy8gU2V0IHVwIHNlcnZpY2Ugd29ya2VyIGV2ZW50IGxpc3RlbmVyc1xuICAgICAgICAgICAgdGhpcy5zd0NsZWFudXAgPSB3aW5kb3cucHdhU2VydmljZVdvcmtlci5zZXR1cEV2ZW50TGlzdGVuZXJzKFxuICAgICAgICAgICAgICAgIHRoaXMuc3RhdGUuc3dSZWdpc3RyYXRpb24sXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBvblVwZGF0ZUF2YWlsYWJsZTogKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zdGF0ZS5oYXNVcGRhdGUgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93VXBkYXRlQXZhaWxhYmxlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmNhbGxiYWNrcy5vblVwZGF0ZUF2YWlsYWJsZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY2FsbGJhY2tzLm9uVXBkYXRlQXZhaWxhYmxlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIG9uQ29udHJvbGxlckNoYW5nZTogKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLnJlbG9hZCgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLy8gQ2hlY2sgZm9yIHVwZGF0ZXMgaWYgZW5hYmxlZFxuICAgICAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5hdXRvVXBkYXRlKSB7XG4gICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5jaGVja0ZvclVwZGF0ZXMoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIFxuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgdGhpcy5oYW5kbGVFcnJvcignU2VydmljZSBXb3JrZXIgaW5pdGlhbGl6YXRpb24gZmFpbGVkJywgZXJyb3IpO1xuICAgICAgICB9XG4gICAgfVxuICAgIFxuICAgIC8qKlxuICAgICAqIEluaXRpYWxpemVzIG9mZmxpbmUgbW9kZVxuICAgICAqL1xuICAgIGFzeW5jIGluaXRPZmZsaW5lTW9kZSgpIHtcbiAgICAgICAgaWYgKCF3aW5kb3cucHdhT2ZmbGluZSkge1xuICAgICAgICAgICAgdGhpcy5sb2coJ09mZmxpbmUgbW9kdWxlIG5vdCBhdmFpbGFibGUnLCAnd2FybicpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICAvLyBJbml0aWFsaXplIG9mZmxpbmUgc3RhdGVcbiAgICAgICAgdGhpcy5zdGF0ZS5vZmZsaW5lU3RhdGUgPSB3aW5kb3cucHdhT2ZmbGluZS5pbml0KHtcbiAgICAgICAgICAgIG9uT25saW5lOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5zdGF0ZS5pc09ubGluZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgdGhpcy5zaG93Tm90aWZpY2F0aW9uKCdCYWNrIE9ubGluZSEnLCAnQ29ubmVjdGlvbiByZXN0b3JlZC4gU3luY2luZyBkYXRhLi4uJywgJ3N1Y2Nlc3MnKTtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5jYWxsYmFja3Mub25PbmxpbmUpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jYWxsYmFja3Mub25PbmxpbmUoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgb25PZmZsaW5lOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5zdGF0ZS5pc09ubGluZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIHRoaXMuc2hvd05vdGlmaWNhdGlvbignWW91XFwncmUgT2ZmbGluZScsICdXb3JraW5nIGluIG9mZmxpbmUgbW9kZSB3aXRoIGNhY2hlZCBkYXRhLicsICd3YXJuaW5nJyk7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuY2FsbGJhY2tzLm9uT2ZmbGluZSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmNhbGxiYWNrcy5vbk9mZmxpbmUoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBcbiAgICAgICAgLy8gQ3JlYXRlIG9mZmxpbmUgaW5kaWNhdG9yXG4gICAgICAgIGNvbnN0IGluZGljYXRvciA9IHdpbmRvdy5wd2FPZmZsaW5lLmNyZWF0ZU9mZmxpbmVJbmRpY2F0b3IoKTtcbiAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChpbmRpY2F0b3IpO1xuICAgICAgICBcbiAgICAgICAgLy8gVXBkYXRlIGluaXRpYWwgc3RhdHVzXG4gICAgICAgIHdpbmRvdy5wd2FPZmZsaW5lLnRvZ2dsZU9mZmxpbmVJbmRpY2F0b3IoIXRoaXMuc3RhdGUuaXNPbmxpbmUpO1xuICAgIH1cbiAgICBcbiAgICAvKipcbiAgICAgKiBJbml0aWFsaXplcyBVSSBjb21wb25lbnRzXG4gICAgICovXG4gICAgaW5pdFVJKCkge1xuICAgICAgICBpZiAoIXdpbmRvdy5wd2FVSSkge1xuICAgICAgICAgICAgdGhpcy5sb2coJ1VJIG1vZHVsZSBub3QgYXZhaWxhYmxlJywgJ3dhcm4nKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgLy8gQXBwbHkgcmVzcG9uc2l2ZSBzdHlsZXNcbiAgICAgICAgd2luZG93LnB3YVVJLmFwcGx5UmVzcG9uc2l2ZVN0eWxlcygpO1xuICAgICAgICBcbiAgICAgICAgLy8gSGFuZGxlIHdpbmRvdyByZXNpemVcbiAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3Jlc2l6ZScsICgpID0+IHtcbiAgICAgICAgICAgIHdpbmRvdy5wd2FVSS5hcHBseVJlc3BvbnNpdmVTdHlsZXMoKTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIFxuICAgIC8qKlxuICAgICAqIFNob3dzIGluc3RhbGwgcHJvbXB0XG4gICAgICovXG4gICAgc2hvd0luc3RhbGxQcm9tcHQoKSB7XG4gICAgICAgIGlmICghd2luZG93LnB3YUluc3RhbGxhdGlvbiB8fCB0aGlzLnN0YXRlLmlzSW5zdGFsbGVkKSByZXR1cm47XG4gICAgICAgIFxuICAgICAgICBjb25zdCBkaXNtaXNzYWwgPSB3aW5kb3cucHdhSW5zdGFsbGF0aW9uLm1hbmFnZUluc3RhbGxEaXNtaXNzYWwoKTtcbiAgICAgICAgaWYgKGRpc21pc3NhbC5pc0Rpc21pc3NlZCgpKSByZXR1cm47XG4gICAgICAgIFxuICAgICAgICBjb25zdCBwcm9tcHQgPSB3aW5kb3cucHdhSW5zdGFsbGF0aW9uLmNyZWF0ZUluc3RhbGxQcm9tcHQoKTtcbiAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChwcm9tcHQpO1xuICAgICAgICBcbiAgICAgICAgLy8gU2V0IHVwIGV2ZW50IGxpc3RlbmVyc1xuICAgICAgICBwcm9tcHQucXVlcnlTZWxlY3RvcignI3B3YS1pbnN0YWxsLWJ0bicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5pbnN0YWxsQXBwKCk7XG4gICAgICAgIH0pO1xuICAgICAgICBcbiAgICAgICAgcHJvbXB0LnF1ZXJ5U2VsZWN0b3IoJyNwd2EtZGlzbWlzcy1idG4nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcbiAgICAgICAgICAgIGRpc21pc3NhbC5kaXNtaXNzKCk7XG4gICAgICAgICAgICB0aGlzLmhpZGVJbnN0YWxsUHJvbXB0KCk7XG4gICAgICAgIH0pO1xuICAgICAgICBcbiAgICAgICAgcHJvbXB0LnF1ZXJ5U2VsZWN0b3IoJyNwd2EtY2xvc2UtYnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmhpZGVJbnN0YWxsUHJvbXB0KCk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBcbiAgICAvKipcbiAgICAgKiBIaWRlcyBpbnN0YWxsIHByb21wdFxuICAgICAqL1xuICAgIGhpZGVJbnN0YWxsUHJvbXB0KCkge1xuICAgICAgICBjb25zdCBwcm9tcHQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHdhLWluc3RhbGwtcHJvbXB0Jyk7XG4gICAgICAgIGlmIChwcm9tcHQpIHtcbiAgICAgICAgICAgIHByb21wdC5yZW1vdmUoKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBcbiAgICAvKipcbiAgICAgKiBJbnN0YWxscyB0aGUgUFdBXG4gICAgICovXG4gICAgYXN5bmMgaW5zdGFsbEFwcCgpIHtcbiAgICAgICAgaWYgKCF0aGlzLnN0YXRlLmRlZmVycmVkUHJvbXB0KSB7XG4gICAgICAgICAgICB0aGlzLnNob3dOb3RpZmljYXRpb24oJ0luc3RhbGxhdGlvbiBOb3QgQXZhaWxhYmxlJywgJ0luc3RhbGwgb3B0aW9uIGlzIG5vdCBjdXJyZW50bHkgYXZhaWxhYmxlLicsICd3YXJuaW5nJyk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB3aW5kb3cucHdhSW5zdGFsbGF0aW9uLnRyaWdnZXJJbnN0YWxsKHRoaXMuc3RhdGUuZGVmZXJyZWRQcm9tcHQpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBpZiAocmVzdWx0LnVzZXJDaG9pY2UpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmxvZygnVXNlciBhY2NlcHRlZCBpbnN0YWxsIHByb21wdCcpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLmxvZygnVXNlciBkaXNtaXNzZWQgaW5zdGFsbCBwcm9tcHQnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIFxuICAgICAgICAgICAgdGhpcy5zdGF0ZS5kZWZlcnJlZFByb21wdCA9IG51bGw7XG4gICAgICAgICAgICB0aGlzLmhpZGVJbnN0YWxsUHJvbXB0KCk7XG4gICAgICAgICAgICBcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIHRoaXMuaGFuZGxlRXJyb3IoJ0luc3RhbGxhdGlvbiBmYWlsZWQnLCBlcnJvcik7XG4gICAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgLyoqXG4gICAgICogU2hvd3MgdXBkYXRlIGF2YWlsYWJsZSBub3RpZmljYXRpb25cbiAgICAgKi9cbiAgICBzaG93VXBkYXRlQXZhaWxhYmxlKCkge1xuICAgICAgICBpZiAoIXdpbmRvdy5wd2FVSSkgcmV0dXJuO1xuICAgICAgICBcbiAgICAgICAgd2luZG93LnB3YVVJLnNob3dVcGRhdGVCYW5uZXIoXG4gICAgICAgICAgICAoKSA9PiB0aGlzLnVwZGF0ZUFwcCgpLFxuICAgICAgICAgICAgKCkgPT4gdGhpcy5sb2coJ1VzZXIgZGlzbWlzc2VkIHVwZGF0ZSBub3RpZmljYXRpb24nKVxuICAgICAgICApO1xuICAgIH1cbiAgICBcbiAgICAvKipcbiAgICAgKiBVcGRhdGVzIHRoZSBhcHBcbiAgICAgKi9cbiAgICB1cGRhdGVBcHAoKSB7XG4gICAgICAgIGlmICghdGhpcy5zdGF0ZS5zd1JlZ2lzdHJhdGlvbikgcmV0dXJuO1xuICAgICAgICBcbiAgICAgICAgd2luZG93LnB3YVNlcnZpY2VXb3JrZXIuYWN0aXZhdGVXYWl0aW5nKHRoaXMuc3RhdGUuc3dSZWdpc3RyYXRpb24pO1xuICAgIH1cbiAgICBcbiAgICAvKipcbiAgICAgKiBDaGVja3MgZm9yIGFwcCB1cGRhdGVzXG4gICAgICovXG4gICAgYXN5bmMgY2hlY2tGb3JVcGRhdGVzKCkge1xuICAgICAgICBpZiAoIXRoaXMuc3RhdGUuc3dSZWdpc3RyYXRpb24pIHJldHVybjtcbiAgICAgICAgXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBhd2FpdCB3aW5kb3cucHdhU2VydmljZVdvcmtlci5jaGVja0ZvclVwZGF0ZXModGhpcy5zdGF0ZS5zd1JlZ2lzdHJhdGlvbik7XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICB0aGlzLmhhbmRsZUVycm9yKCdVcGRhdGUgY2hlY2sgZmFpbGVkJywgZXJyb3IpO1xuICAgICAgICB9XG4gICAgfVxuICAgIFxuICAgIC8qKlxuICAgICAqIFNob3dzIG5vdGlmaWNhdGlvblxuICAgICAqL1xuICAgIHNob3dOb3RpZmljYXRpb24odGl0bGUsIG1lc3NhZ2UsIHR5cGUgPSAnaW5mbycpIHtcbiAgICAgICAgaWYgKCF0aGlzLm9wdGlvbnMuZW5hYmxlTm90aWZpY2F0aW9ucyB8fCAhd2luZG93LnB3YVVJKSByZXR1cm47XG4gICAgICAgIFxuICAgICAgICBpZiAodGhpcy5ub3RpZmljYXRpb25RdWV1ZSkge1xuICAgICAgICAgICAgdGhpcy5ub3RpZmljYXRpb25RdWV1ZS5hZGQodGl0bGUsIG1lc3NhZ2UsIHR5cGUpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgd2luZG93LnB3YVVJLnNob3dOb3RpZmljYXRpb24odGl0bGUsIG1lc3NhZ2UsIHR5cGUpO1xuICAgICAgICB9XG4gICAgfVxuICAgIFxuICAgIC8qKlxuICAgICAqIEdldHMgY2FjaGUgaW5mb3JtYXRpb25cbiAgICAgKi9cbiAgICBhc3luYyBnZXRDYWNoZUluZm8oKSB7XG4gICAgICAgIGlmICghdGhpcy5zdGF0ZS5zd1JlZ2lzdHJhdGlvbiB8fCAhd2luZG93LnB3YUNhY2hlKSByZXR1cm4gbnVsbDtcbiAgICAgICAgXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICByZXR1cm4gYXdhaXQgd2luZG93LnB3YUNhY2hlLmdldENhY2hlU3RhdHVzKHRoaXMuc3RhdGUuc3dSZWdpc3RyYXRpb24pO1xuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgdGhpcy5oYW5kbGVFcnJvcignRmFpbGVkIHRvIGdldCBjYWNoZSBpbmZvJywgZXJyb3IpO1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgLyoqXG4gICAgICogQ2xlYXJzIGNhY2hlXG4gICAgICovXG4gICAgYXN5bmMgY2xlYXJDYWNoZSgpIHtcbiAgICAgICAgaWYgKCF0aGlzLnN0YXRlLnN3UmVnaXN0cmF0aW9uIHx8ICF3aW5kb3cucHdhQ2FjaGUpIHJldHVybiBmYWxzZTtcbiAgICAgICAgXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCBzdWNjZXNzID0gYXdhaXQgd2luZG93LnB3YUNhY2hlLmNsZWFyQWxsQ2FjaGVzKHRoaXMuc3RhdGUuc3dSZWdpc3RyYXRpb24pO1xuICAgICAgICAgICAgaWYgKHN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNob3dOb3RpZmljYXRpb24oJ0NhY2hlIENsZWFyZWQnLCAnQWxsIGNhY2hlZCBkYXRhIGhhcyBiZWVuIHJlbW92ZWQuJywgJ3N1Y2Nlc3MnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBzdWNjZXNzO1xuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgdGhpcy5oYW5kbGVFcnJvcignRmFpbGVkIHRvIGNsZWFyIGNhY2hlJywgZXJyb3IpO1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgfVxuICAgIFxuICAgIC8qKlxuICAgICAqIEdldHMgUFdBIHN0YXR1c1xuICAgICAqL1xuICAgIGdldFN0YXR1cygpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGlzSW5pdGlhbGl6ZWQ6IHRoaXMuc3RhdGUuaXNJbml0aWFsaXplZCxcbiAgICAgICAgICAgIGlzT25saW5lOiB0aGlzLnN0YXRlLmlzT25saW5lLFxuICAgICAgICAgICAgaXNJbnN0YWxsZWQ6IHRoaXMuc3RhdGUuaXNJbnN0YWxsZWQsXG4gICAgICAgICAgICBoYXNVcGRhdGU6IHRoaXMuc3RhdGUuaGFzVXBkYXRlLFxuICAgICAgICAgICAgaGFzU2VydmljZVdvcmtlcjogQm9vbGVhbih0aGlzLnN0YXRlLnN3UmVnaXN0cmF0aW9uKSxcbiAgICAgICAgICAgIHF1ZXVlZEFjdGlvbnM6IHRoaXMuc3RhdGUub2ZmbGluZVN0YXRlPy5xdWV1ZWRBY3Rpb25zPy5sZW5ndGggfHwgMCxcbiAgICAgICAgICAgIGNhcGFiaWxpdGllczogd2luZG93LnB3YVNlcnZpY2VXb3JrZXI/LmdldENhcGFiaWxpdGllcz8uKCkgfHwge30sXG4gICAgICAgICAgICBpbnN0YWxsQ3JpdGVyaWE6IHdpbmRvdy5wd2FJbnN0YWxsYXRpb24/LmdldEluc3RhbGxDcml0ZXJpYT8uKCkgfHwge31cbiAgICAgICAgfTtcbiAgICB9XG4gICAgXG4gICAgLyoqXG4gICAgICogR2V0cyBhbmFseXRpY3MgZGF0YVxuICAgICAqL1xuICAgIGdldEFuYWx5dGljcygpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGluc3RhbGxhdGlvbjogd2luZG93LnB3YUluc3RhbGxhdGlvbj8uZ2V0SW5zdGFsbGF0aW9uQW5hbHl0aWNzPy4oKSB8fCB7fSxcbiAgICAgICAgICAgIG9mZmxpbmU6IHdpbmRvdy5wd2FPZmZsaW5lPy5nZXRPZmZsaW5lU3RhdHVzPy4odGhpcy5zdGF0ZS5vZmZsaW5lU3RhdGUpIHx8IHt9LFxuICAgICAgICAgICAgc2VydmljZVdvcmtlcjogd2luZG93LnB3YVNlcnZpY2VXb3JrZXI/LmdldFBlcmZvcm1hbmNlTWV0cmljcz8uKHRoaXMuc3RhdGUuc3dSZWdpc3RyYXRpb24pIHx8IHt9LFxuICAgICAgICAgICAgdGltZXN0YW1wOiBEYXRlLm5vdygpXG4gICAgICAgIH07XG4gICAgfVxuICAgIFxuICAgIC8qKlxuICAgICAqIEhhbmRsZXMgZXJyb3JzXG4gICAgICovXG4gICAgaGFuZGxlRXJyb3IoY29udGV4dCwgZXJyb3IpIHtcbiAgICAgICAgY29uc3QgbWVzc2FnZSA9IGBQV0EgTWFuYWdlciAtICR7Y29udGV4dH06ICR7ZXJyb3IubWVzc2FnZX1gO1xuICAgICAgICBcbiAgICAgICAgdGhpcy5sb2cobWVzc2FnZSwgJ2Vycm9yJyk7XG4gICAgICAgIFxuICAgICAgICBpZiAodGhpcy5jYWxsYmFja3Mub25FcnJvcikge1xuICAgICAgICAgICAgdGhpcy5jYWxsYmFja3Mub25FcnJvcihlcnJvciwgY29udGV4dCk7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIC8vIFNob3cgdXNlci1mcmllbmRseSBlcnJvciBub3RpZmljYXRpb25cbiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5lbmFibGVOb3RpZmljYXRpb25zKSB7XG4gICAgICAgICAgICB0aGlzLnNob3dOb3RpZmljYXRpb24oJ0Vycm9yJywgJ1NvbWV0aGluZyB3ZW50IHdyb25nLiBQbGVhc2UgdHJ5IGFnYWluLicsICdlcnJvcicpO1xuICAgICAgICB9XG4gICAgfVxuICAgIFxuICAgIC8qKlxuICAgICAqIExvZ3MgbWVzc2FnZXNcbiAgICAgKi9cbiAgICBsb2cobWVzc2FnZSwgbGV2ZWwgPSAnaW5mbycpIHtcbiAgICAgICAgaWYgKCF0aGlzLm9wdGlvbnMuZW5hYmxlTG9nZ2luZykgcmV0dXJuO1xuICAgICAgICBcbiAgICAgICAgY29uc3QgbG9nTWVzc2FnZSA9IGBbUFdBIE1hbmFnZXJdICR7bWVzc2FnZX1gO1xuICAgICAgICBcbiAgICAgICAgaWYgKHdpbmRvdy5EZXZMb2dnZXIpIHtcbiAgICAgICAgICAgIHdpbmRvdy5EZXZMb2dnZXJbbGV2ZWxdPy4obG9nTWVzc2FnZSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tY29uc29sZVxuICAgICAgICAgICAgY29uc29sZVtsZXZlbF0/Lihsb2dNZXNzYWdlKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBcbiAgICAvKipcbiAgICAgKiBDbGVhbnVwIG1ldGhvZFxuICAgICAqL1xuICAgIGRlc3Ryb3koKSB7XG4gICAgICAgIGlmICh0aGlzLmluc3RhbGxDbGVhbnVwKSB7XG4gICAgICAgICAgICB0aGlzLmluc3RhbGxDbGVhbnVwKCk7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGlmICh0aGlzLnN3Q2xlYW51cCkge1xuICAgICAgICAgICAgdGhpcy5zd0NsZWFudXAoKTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgaWYgKHRoaXMubm90aWZpY2F0aW9uUXVldWUpIHtcbiAgICAgICAgICAgIHRoaXMubm90aWZpY2F0aW9uUXVldWUuY2xlYXIoKTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgdGhpcy5zdGF0ZS5pc0luaXRpYWxpemVkID0gZmFsc2U7XG4gICAgfVxufVxuXG4vLyBJbml0aWFsaXplIFBXQSBNYW5hZ2VyIHdoZW4gRE9NIGlzIGxvYWRlZFxuaWYgKHR5cGVvZiBkb2N1bWVudCAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdET01Db250ZW50TG9hZGVkJywgKCkgPT4ge1xuICAgICAgICB3aW5kb3cucHdhTWFuYWdlciA9IG5ldyBQV0FNYW5hZ2VyKCk7XG4gICAgfSk7XG59XG5cbi8vIEV4cG9ydCBmb3IgdXNlIGluIG90aGVyIG1vZHVsZXNcbmlmICh0eXBlb2YgbW9kdWxlICE9PSAndW5kZWZpbmVkJyAmJiBtb2R1bGUuZXhwb3J0cykge1xuICAgIC8vIEV4cG9ydCBhcyBib3RoIGRlZmF1bHQgYW5kIG5hbWVkIGV4cG9ydCBmb3IgQ29tbW9uSlMgY29uc3VtZXJzIGFuZCB0ZXN0c1xuICAgIG1vZHVsZS5leHBvcnRzID0gUFdBTWFuYWdlcjtcbiAgICBtb2R1bGUuZXhwb3J0cy5QV0FNYW5hZ2VyID0gUFdBTWFuYWdlcjtcbn0gXG5cbmlmICh0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJykge1xuICAgIHdpbmRvdy5QV0FNYW5hZ2VyID0gUFdBTWFuYWdlcjtcbn1cbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLElBQUksT0FBT0EsTUFBTSxLQUFLLFdBQVcsRUFBRTtFQUMvQjtBQUFBLENBQ0gsTUFBTTtFQUNIO0VBQ0E7RUFDQSxNQUFNO0lBQUVDO0VBQWlCLENBQUMsR0FBR0MsT0FBTyxDQUFDLGtCQUFrQixDQUFDO0VBQ3hEO0VBQ0EsTUFBTTtJQUFFQztFQUFnQixDQUFDLEdBQUdELE9BQU8sQ0FBQyxnQkFBZ0IsQ0FBQztFQUNyRDtFQUNBLE1BQU07SUFBRUU7RUFBVyxDQUFDLEdBQUdGLE9BQU8sQ0FBQyxXQUFXLENBQUM7RUFDM0M7RUFDQSxNQUFNO0lBQUVHO0VBQVMsQ0FBQyxHQUFHSCxPQUFPLENBQUMsU0FBUyxDQUFDO0VBQ3ZDO0VBQ0EsTUFBTTtJQUFFSTtFQUFNLENBQUMsR0FBR0osT0FBTyxDQUFDLE1BQU0sQ0FBQztBQUNyQzs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxNQUFNSyxVQUFVLENBQUM7RUFDYkMsV0FB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SUFBSSxDQUFDc0MsZ0JBQWdCLENBQUMsT0FBTyxFQUFFLHlDQUF5QyxFQUFFLE9BQU8sQ0FBQztJQUN0RjtFQUNKOztFQUVBO0FBQ0o7QUFDQTtFQUNJakIsR0FBR0EsQ0FBQ3FELE9BQU8sRUFBRTJCLEtBQUssR0FBRyxNQUFNLEVBQUU7SUFDekIsSUFBSSxDQUFDLElBQUksQ0FBQzNHLE9BQU8sQ0FBQ0MsYUFBYSxFQUFFO0lBRWpDLE1BQU0yRyxVQUFVLEdBQUcsaUJBQWlCNUIsT0FBTyxFQUFFO0lBRTdDLElBQUl6RixNQUFNLENBQUNzSCxTQUFTLEVBQUU7TUFDbEJ0SCxNQUFNLENBQUNzSCxTQUFTLENBQUNGLEtBQUssQ0FBQyxHQUFHQyxVQUFVLENBQUM7SUFDekMsQ0FBQyxNQUFNO01BQ0g7TUFDQUUsT0FBTyxDQUFDSCxLQUFLLENBQUMsR0FBR0MsVUFBVSxDQUFDO0lBQ2hDO0VBQ0o7O0VBRUE7QUFDSjtBQUNBO0VBQ0lHLE9BQU9BLENBQUEsRUFBRztJQUNOLElBQUksSUFBSSxDQUFDbEUsY0FBYyxFQUFFO01BQ3JCLElBQUksQ0FBQ0EsY0FBYyxDQUFDLENBQUM7SUFDekI7SUFFQSxJQUFJLElBQUksQ0FBQ0ksU0FBUyxFQUFFO01BQ2hCLElBQUksQ0FBQ0EsU0FBUyxDQUFDLENBQUM7SUFDcEI7SUFFQSxJQUFJLElBQUksQ0FBQ3pCLGlCQUFpQixFQUFFO01BQ3hCLElBQUksQ0FBQ0EsaUJBQWlCLENBQUN3RixLQUFLLENBQUMsQ0FBQztJQUNsQztJQUVBLElBQUksQ0FBQ3pHLEtBQUssQ0FBQ0MsYUFBYSxHQUFHLEtBQUs7RUFDcEM7QUFDSjs7QUFFQTtBQUNBLElBQUksT0FBT2lELFFBQVEsS0FBSyxXQUFXLEVBQUU7RUFDakNBLFFBQVEsQ0FBQ0ssZ0JBQWdCLENBQUMsa0JBQWtCLEVBQUUsTUFBTTtJQUNoRHZFLE1BQU0sQ0FBQzBILFVBQVUsR0FBRyxJQUFJbkgsVUFBVSxDQUFDLENBQUM7RUFDeEMsQ0FBQyxDQUFDO0FBQ047O0FBRUE7QUFDQSxJQUFJLE9BQU9vSCxNQUFNLEtBQUssV0FBVyxJQUFJQSxNQUFNLENBQUNDLE9BQU8sRUFBRTtFQUNqRDtFQUNBRCxNQUFNLENBQUNDLE9BQU8sR0FBR3JILFVBQVU7RUFDM0JvSCxNQUFNLENBQUNDLE9BQU8sQ0FBQ3JILFVBQVUsR0FBR0EsVUFBVTtBQUMxQztBQUVBLElBQUksT0FBT1AsTUFBTSxLQUFLLFdBQVcsRUFBRTtFQUMvQkEsTUFBTSxDQUFDTyxVQUFVLEdBQUdBLFVBQVU7QUFDbEMiLCJpZ25vcmVMaXN0IjpbXX0=