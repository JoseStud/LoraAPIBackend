ecd892e0d5fba2f0f17ba87c6856295b
/**
 * PWA Manager - Service Worker Module
 * 
 * Handles service worker registration, lifecycle management, and updates.
 */

/**
 * Service Worker management operations
 */
const pwaServiceWorker = {
  /**
   * Registers the service worker
   */
  async register(swPath = '/sw.js', scope = '/') {
    if (!('serviceWorker' in navigator)) {
      throw new Error('Service Worker not supported');
    }
    try {
      const registration = await navigator.serviceWorker.register(swPath, {
        scope
      });
      if (window.DevLogger?.debug) {
        window.DevLogger.debug('[PWA] Service Worker registered:', registration);
      }
      return registration;
    } catch (error) {
      if (window.DevLogger?.debug) {
        window.DevLogger.debug('[PWA] Service Worker registration failed:', error);
      }
      throw new Error(`Service Worker registration failed: ${error.message}`);
    }
  },
  /**
   * Sets up service worker event listeners
   */
  setupEventListeners(registration, callbacks = {}) {
    if (!registration) return () => {};

    // Handle updates
    const handleUpdateFound = () => {
      const newWorker = registration.installing;
      if (!newWorker) return;
      const handleStateChange = () => {
        if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
          if (callbacks.onUpdateAvailable) {
            callbacks.onUpdateAvailable(newWorker);
          }
        }
      };
      newWorker.addEventListener('statechange', handleStateChange);
    };

    // Handle controller changes
    const handleControllerChange = () => {
      if (callbacks.onControllerChange) {
        callbacks.onControllerChange();
      } else {
        window.location.reload();
      }
    };
    registration.addEventListener('updatefound', handleUpdateFound);
    navigator.serviceWorker.addEventListener('controllerchange', handleControllerChange);

    // Return cleanup function
    return () => {
      registration.removeEventListener('updatefound', handleUpdateFound);
      navigator.serviceWorker.removeEventListener('controllerchange', handleControllerChange);
    };
  },
  /**
   * Checks for service worker updates
   */
  async checkForUpdates(registration) {
    if (!registration) return false;
    try {
      await registration.update();
      return true;
    } catch (error) {
      if (window.DevLogger?.debug) {
        window.DevLogger.debug('[PWA] Update check failed:', error);
      }
      return false;
    }
  },
  /**
   * Activates a waiting service worker
   */
  activateWaiting(registration) {
    if (registration?.waiting) {
      registration.waiting.postMessage({
        type: 'SKIP_WAITING'
      });
      return true;
    }
    return false;
  },
  /**
   * Gets the current service worker state
   */
  getState(registration) {
    if (!registration) {
      return {
        state: 'not_registered',
        hasUpdate: false
      };
    }
    return {
      state: registration.active ? 'active' : 'inactive',
      hasUpdate: Boolean(registration.waiting),
      installing: Boolean(registration.installing),
      scope: registration.scope,
      updateViaCache: registration.updateViaCache
    };
  },
  /**
   * Unregisters the service worker
   */
  async unregister(registration) {
    if (!registration) return false;
    try {
      const result = await registration.unregister();
      if (window.DevLogger?.debug) {
        window.DevLogger.debug('[PWA] Service Worker unregistered:', result);
      }
      return result;
    } catch (error) {
      if (window.DevLogger?.debug) {
        window.DevLogger.debug('[PWA] Service Worker unregistration failed:', error);
      }
      return false;
    }
  },
  /**
   * Posts a message to the service worker
   */
  postMessage(registration, message) {
    if (registration?.active) {
      registration.active.postMessage(message);
      return true;
    }
    return false;
  },
  /**
   * Posts a message to service worker with response
   */
  postMessageWithResponse(registration, message, timeout = 5000) {
    return new Promise((resolve, reject) => {
      if (!registration?.active) {
        reject(new Error('No active service worker'));
        return;
      }
      const messageChannel = new MessageChannel();
      const timeoutId = setTimeout(() => {
        reject(new Error('Service Worker response timeout'));
      }, timeout);
      messageChannel.port1.onmessage = event => {
        clearTimeout(timeoutId);
        resolve(event.data);
      };
      try {
        registration.active.postMessage(message, [messageChannel.port2]);
      } catch (error) {
        clearTimeout(timeoutId);
        reject(error);
      }
    });
  },
  /**
   * Gets all service worker registrations
   */
  async getAllRegistrations() {
    if (!('serviceWorker' in navigator)) return [];
    try {
      return await navigator.serviceWorker.getRegistrations();
    } catch (error) {
      return [];
    }
  },
  /**
   * Checks if service worker is supported
   */
  isSupported() {
    return 'serviceWorker' in navigator;
  },
  /**
   * Gets service worker capabilities
   */
  getCapabilities() {
    // Defensive checks for test environments where ServiceWorkerRegistration may be undefined
    const swRegistrationProto = typeof window !== 'undefined' && window.ServiceWorkerRegistration && window.ServiceWorkerRegistration.prototype ? window.ServiceWorkerRegistration.prototype : null;
    return {
      serviceWorker: 'serviceWorker' in navigator,
      pushManager: 'PushManager' in window,
      notification: 'Notification' in window,
      backgroundSync: 'serviceWorker' in navigator && swRegistrationProto ? 'sync' in swRegistrationProto : false,
      backgroundFetch: 'serviceWorker' in navigator && 'BackgroundFetch' in window,
      periodicBackgroundSync: 'serviceWorker' in navigator && swRegistrationProto ? 'periodicSync' in swRegistrationProto : false
    };
  },
  /**
   * Handles service worker errors
   */
  handleError(error, context = 'unknown') {
    const errorMessage = `Service Worker error in ${context}: ${error.message}`;
    if (window.DevLogger?.error) {
      window.DevLogger.error('[PWA]', errorMessage, error);
    }

    // Could dispatch custom event for error handling
    window.dispatchEvent(new CustomEvent('sw-error', {
      detail: {
        error,
        context,
        message: errorMessage
      }
    }));
    return errorMessage;
  },
  /**
   * Validates service worker script
   */
  async validateScript(swPath) {
    try {
      const response = await fetch(swPath, {
        cache: 'no-cache'
      });
      return response.ok;
    } catch (error) {
      return false;
    }
  },
  /**
   * Gets service worker performance metrics
   */
  getPerformanceMetrics(registration) {
    if (!registration) return null;
    const metrics = {
      registrationTime: registration.installing?.scriptURL ? Date.now() : null,
      scope: registration.scope,
      updateViaCache: registration.updateViaCache
    };

    // Add navigation API timing if available
    if (window.performance?.getEntriesByType) {
      const navigationEntries = window.performance.getEntriesByType('navigation');
      if (navigationEntries.length > 0) {
        const entry = navigationEntries[0];
        metrics.pageLoadTime = entry.loadEventEnd - entry.loadEventStart;
        metrics.domContentLoadedTime = entry.domContentLoadedEventEnd - entry.domContentLoadedEventStart;
      }
    }
    return metrics;
  }
};

// Export for use in other modules
if (typeof module !== 'undefined' && module.exports) {
  module.exports = {
    pwaServiceWorker
  };
} else if (typeof window !== 'undefined') {
  window.pwaServiceWorker = pwaServiceWorker;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJwd2FTZXJ2aWNlV29ya2VyIiwicmVnaXN0ZXIiLCJzd1BhdGgiLCJzY29wZSIsIm5hdmlnYXRvciIsIkVycm9yIiwicmVnaXN0cmF0aW9uIiwic2VydmljZVdvcmtlciIsIndpbmRvdyIsIkRldkxvZ2dlciIsImRlYnVnIiwiZXJyb3IiLCJtZXNzYWdlIiwic2V0dXBFdmVudExpc3RlbmVycyIsImNhbGxiYWNrcyIsImhhbmRsZVVwZGF0ZUZvdW5kIiwibmV3V29ya2VyIiwiaW5zdGFsbGluZyIsImhhbmRsZVN0YXRlQ2hhbmdlIiwic3RhdGUiLCJjb250cm9sbGVyIiwib25VcGRhdGVBdmFpbGFibGUiLCJhZGRFdmVudExpc3RlbmVyIiwiaGFuZGxlQ29udHJvbGxlckNoYW5nZSIsIm9uQ29udHJvbGxlckNoYW5nZSIsImxvY2F0aW9uIiwicmVsb2FkIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsImNoZWNrRm9yVXBkYXRlcyIsInVwZGF0ZSIsImFjdGl2YXRlV2FpdGluZyIsIndhaXRpbmciLCJwb3N0TWVzc2FnZSIsInR5cGUiLCJnZXRTdGF0ZSIsImhhc1VwZGF0ZSIsImFjdGl2ZSIsIkJvb2xlYW4iLCJ1cGRhdGVWaWFDYWNoZSIsInVucmVnaXN0ZXIiLCJyZXN1bHQiLCJwb3N0TWVzc2FnZVdpdGhSZXNwb25zZSIsInRpbWVvdXQiLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsIm1lc3NhZ2VDaGFubmVsIiwiTWVzc2FnZUNoYW5uZWwiLCJ0aW1lb3V0SWQiLCJzZXRUaW1lb3V0IiwicG9ydDEiLCJvbm1lc3NhZ2UiLCJldmVudCIsImNsZWFyVGltZW91dCIsImRhdGEiLCJwb3J0MiIsImdldEFsbFJlZ2lzdHJhdGlvbnMiLCJnZXRSZWdpc3RyYXRpb25zIiwiaXNTdXBwb3J0ZWQiLCJnZXRDYXBhYmlsaXRpZXMiLCJzd1JlZ2lzdHJhdGlvblByb3RvIiwiU2VydmljZVdvcmtlclJlZ2lzdHJhdGlvbiIsInByb3RvdHlwZSIsInB1c2hNYW5hZ2VyIiwibm90aWZpY2F0aW9uIiwiYmFja2dyb3VuZFN5bmMiLCJiYWNrZ3JvdW5kRmV0Y2giLCJwZXJpb2RpY0JhY2tncm91bmRTeW5jIiwiaGFuZGxlRXJyb3IiLCJjb250ZXh0IiwiZXJyb3JNZXNzYWdlIiwiZGlzcGF0Y2hFdmVudCIsIkN1c3RvbUV2ZW50IiwiZGV0YWlsIiwidmFsaWRhdGVTY3JpcHQiLCJyZXNwb25zZSIsImZldGNoIiwiY2FjaGUiLCJvayIsImdldFBlcmZvcm1hbmNlTWV0cmljcyIsIm1ldHJpY3MiLCJyZWdpc3RyYXRpb25UaW1lIiwic2NyaXB0VVJMIiwiRGF0ZSIsIm5vdyIsInBlcmZvcm1hbmNlIiwiZ2V0RW50cmllc0J5VHlwZSIsIm5hdmlnYXRpb25FbnRyaWVzIiwibGVuZ3RoIiwiZW50cnkiLCJwYWdlTG9hZFRpbWUiLCJsb2FkRXZlbnRFbmQiLCJsb2FkRXZlbnRTdGFydCIsImRvbUNvbnRlbnRMb2FkZWRUaW1lIiwiZG9tQ29udGVudExvYWRlZEV2ZW50RW5kIiwiZG9tQ29udGVudExvYWRlZEV2ZW50U3RhcnQiLCJtb2R1bGUiLCJleHBvcnRzIl0sInNvdXJjZXMiOlsic2VydmljZS13b3JrZXIuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBQV0EgTWFuYWdlciAtIFNlcnZpY2UgV29ya2VyIE1vZHVsZVxuICogXG4gKiBIYW5kbGVzIHNlcnZpY2Ugd29ya2VyIHJlZ2lzdHJhdGlvbiwgbGlmZWN5Y2xlIG1hbmFnZW1lbnQsIGFuZCB1cGRhdGVzLlxuICovXG5cbi8qKlxuICogU2VydmljZSBXb3JrZXIgbWFuYWdlbWVudCBvcGVyYXRpb25zXG4gKi9cbmNvbnN0IHB3YVNlcnZpY2VXb3JrZXIgPSB7XG4gICAgLyoqXG4gICAgICogUmVnaXN0ZXJzIHRoZSBzZXJ2aWNlIHdvcmtlclxuICAgICAqL1xuICAgIGFzeW5jIHJlZ2lzdGVyKHN3UGF0aCA9ICcvc3cuanMnLCBzY29wZSA9ICcvJykge1xuICAgICAgICBpZiAoISgnc2VydmljZVdvcmtlcicgaW4gbmF2aWdhdG9yKSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdTZXJ2aWNlIFdvcmtlciBub3Qgc3VwcG9ydGVkJyk7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCByZWdpc3RyYXRpb24gPSBhd2FpdCBuYXZpZ2F0b3Iuc2VydmljZVdvcmtlci5yZWdpc3Rlcihzd1BhdGgsIHsgc2NvcGUgfSk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGlmICh3aW5kb3cuRGV2TG9nZ2VyPy5kZWJ1Zykge1xuICAgICAgICAgICAgICAgIHdpbmRvdy5EZXZMb2dnZXIuZGVidWcoJ1tQV0FdIFNlcnZpY2UgV29ya2VyIHJlZ2lzdGVyZWQ6JywgcmVnaXN0cmF0aW9uKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIFxuICAgICAgICAgICAgcmV0dXJuIHJlZ2lzdHJhdGlvbjtcbiAgICAgICAgICAgIFxuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgaWYgKHdpbmRvdy5EZXZMb2dnZXI/LmRlYnVnKSB7XG4gICAgICAgICAgICAgICAgd2luZG93LkRldkxvZ2dlci5kZWJ1ZygnW1BXQV0gU2VydmljZSBXb3JrZXIgcmVnaXN0cmF0aW9uIGZhaWxlZDonLCBlcnJvcik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFNlcnZpY2UgV29ya2VyIHJlZ2lzdHJhdGlvbiBmYWlsZWQ6ICR7ZXJyb3IubWVzc2FnZX1gKTtcbiAgICAgICAgfVxuICAgIH0sXG4gICAgXG4gICAgLyoqXG4gICAgICogU2V0cyB1cCBzZXJ2aWNlIHdvcmtlciBldmVudCBsaXN0ZW5lcnNcbiAgICAgKi9cbiAgICBzZXR1cEV2ZW50TGlzdGVuZXJzKHJlZ2lzdHJhdGlvbiwgY2FsbGJhY2tzID0ge30pIHtcbiAgICAgICAgaWYgKCFyZWdpc3RyYXRpb24pIHJldHVybiAoKSA9PiB7fTtcbiAgICAgICAgXG4gICAgICAgIC8vIEhhbmRsZSB1cGRhdGVzXG4gICAgICAgIGNvbnN0IGhhbmRsZVVwZGF0ZUZvdW5kID0gKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgbmV3V29ya2VyID0gcmVnaXN0cmF0aW9uLmluc3RhbGxpbmc7XG4gICAgICAgICAgICBpZiAoIW5ld1dvcmtlcikgcmV0dXJuO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBjb25zdCBoYW5kbGVTdGF0ZUNoYW5nZSA9ICgpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAobmV3V29ya2VyLnN0YXRlID09PSAnaW5zdGFsbGVkJyAmJiBuYXZpZ2F0b3Iuc2VydmljZVdvcmtlci5jb250cm9sbGVyKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChjYWxsYmFja3Mub25VcGRhdGVBdmFpbGFibGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrcy5vblVwZGF0ZUF2YWlsYWJsZShuZXdXb3JrZXIpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgbmV3V29ya2VyLmFkZEV2ZW50TGlzdGVuZXIoJ3N0YXRlY2hhbmdlJywgaGFuZGxlU3RhdGVDaGFuZ2UpO1xuICAgICAgICB9O1xuICAgICAgICBcbiAgICAgICAgLy8gSGFuZGxlIGNvbnRyb2xsZXIgY2hhbmdlc1xuICAgICAgICBjb25zdCBoYW5kbGVDb250cm9sbGVyQ2hhbmdlID0gKCkgPT4ge1xuICAgICAgICAgICAgaWYgKGNhbGxiYWNrcy5vbkNvbnRyb2xsZXJDaGFuZ2UpIHtcbiAgICAgICAgICAgICAgICBjYWxsYmFja3Mub25Db250cm9sbGVyQ2hhbmdlKCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5yZWxvYWQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgXG4gICAgICAgIHJlZ2lzdHJhdGlvbi5hZGRFdmVudExpc3RlbmVyKCd1cGRhdGVmb3VuZCcsIGhhbmRsZVVwZGF0ZUZvdW5kKTtcbiAgICAgICAgbmF2aWdhdG9yLnNlcnZpY2VXb3JrZXIuYWRkRXZlbnRMaXN0ZW5lcignY29udHJvbGxlcmNoYW5nZScsIGhhbmRsZUNvbnRyb2xsZXJDaGFuZ2UpO1xuICAgICAgICBcbiAgICAgICAgLy8gUmV0dXJuIGNsZWFudXAgZnVuY3Rpb25cbiAgICAgICAgcmV0dXJuICgpID0+IHtcbiAgICAgICAgICAgIHJlZ2lzdHJhdGlvbi5yZW1vdmVFdmVudExpc3RlbmVyKCd1cGRhdGVmb3VuZCcsIGhhbmRsZVVwZGF0ZUZvdW5kKTtcbiAgICAgICAgICAgIG5hdmlnYXRvci5zZXJ2aWNlV29ya2VyLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2NvbnRyb2xsZXJjaGFuZ2UnLCBoYW5kbGVDb250cm9sbGVyQ2hhbmdlKTtcbiAgICAgICAgfTtcbiAgICB9LFxuICAgIFxuICAgIC8qKlxuICAgICAqIENoZWNrcyBmb3Igc2VydmljZSB3b3JrZXIgdXBkYXRlc1xuICAgICAqL1xuICAgIGFzeW5jIGNoZWNrRm9yVXBkYXRlcyhyZWdpc3RyYXRpb24pIHtcbiAgICAgICAgaWYgKCFyZWdpc3RyYXRpb24pIHJldHVybiBmYWxzZTtcbiAgICAgICAgXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBhd2FpdCByZWdpc3RyYXRpb24udXBkYXRlKCk7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIGlmICh3aW5kb3cuRGV2TG9nZ2VyPy5kZWJ1Zykge1xuICAgICAgICAgICAgICAgIHdpbmRvdy5EZXZMb2dnZXIuZGVidWcoJ1tQV0FdIFVwZGF0ZSBjaGVjayBmYWlsZWQ6JywgZXJyb3IpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgfSxcbiAgICBcbiAgICAvKipcbiAgICAgKiBBY3RpdmF0ZXMgYSB3YWl0aW5nIHNlcnZpY2Ugd29ya2VyXG4gICAgICovXG4gICAgYWN0aXZhdGVXYWl0aW5nKHJlZ2lzdHJhdGlvbikge1xuICAgICAgICBpZiAocmVnaXN0cmF0aW9uPy53YWl0aW5nKSB7XG4gICAgICAgICAgICByZWdpc3RyYXRpb24ud2FpdGluZy5wb3N0TWVzc2FnZSh7IHR5cGU6ICdTS0lQX1dBSVRJTkcnIH0pO1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH0sXG4gICAgXG4gICAgLyoqXG4gICAgICogR2V0cyB0aGUgY3VycmVudCBzZXJ2aWNlIHdvcmtlciBzdGF0ZVxuICAgICAqL1xuICAgIGdldFN0YXRlKHJlZ2lzdHJhdGlvbikge1xuICAgICAgICBpZiAoIXJlZ2lzdHJhdGlvbikge1xuICAgICAgICAgICAgcmV0dXJuIHsgc3RhdGU6ICdub3RfcmVnaXN0ZXJlZCcsIGhhc1VwZGF0ZTogZmFsc2UgfTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHN0YXRlOiByZWdpc3RyYXRpb24uYWN0aXZlID8gJ2FjdGl2ZScgOiAnaW5hY3RpdmUnLFxuICAgICAgICAgICAgaGFzVXBkYXRlOiBCb29sZWFuKHJlZ2lzdHJhdGlvbi53YWl0aW5nKSxcbiAgICAgICAgICAgIGluc3RhbGxpbmc6IEJvb2xlYW4ocmVnaXN0cmF0aW9uLmluc3RhbGxpbmcpLFxuICAgICAgICAgICAgc2NvcGU6IHJlZ2lzdHJhdGlvbi5zY29wZSxcbiAgICAgICAgICAgIHVwZGF0ZVZpYUNhY2hlOiByZWdpc3RyYXRpb24udXBkYXRlVmlhQ2FjaGVcbiAgICAgICAgfTtcbiAgICB9LFxuICAgIFxuICAgIC8qKlxuICAgICAqIFVucmVnaXN0ZXJzIHRoZSBzZXJ2aWNlIHdvcmtlclxuICAgICAqL1xuICAgIGFzeW5jIHVucmVnaXN0ZXIocmVnaXN0cmF0aW9uKSB7XG4gICAgICAgIGlmICghcmVnaXN0cmF0aW9uKSByZXR1cm4gZmFsc2U7XG4gICAgICAgIFxuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcmVnaXN0cmF0aW9uLnVucmVnaXN0ZXIoKTtcbiAgICAgICAgICAgIGlmICh3aW5kb3cuRGV2TG9nZ2VyPy5kZWJ1Zykge1xuICAgICAgICAgICAgICAgIHdpbmRvdy5EZXZMb2dnZXIuZGVidWcoJ1tQV0FdIFNlcnZpY2UgV29ya2VyIHVucmVnaXN0ZXJlZDonLCByZXN1bHQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIGlmICh3aW5kb3cuRGV2TG9nZ2VyPy5kZWJ1Zykge1xuICAgICAgICAgICAgICAgIHdpbmRvdy5EZXZMb2dnZXIuZGVidWcoJ1tQV0FdIFNlcnZpY2UgV29ya2VyIHVucmVnaXN0cmF0aW9uIGZhaWxlZDonLCBlcnJvcik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICB9LFxuICAgIFxuICAgIC8qKlxuICAgICAqIFBvc3RzIGEgbWVzc2FnZSB0byB0aGUgc2VydmljZSB3b3JrZXJcbiAgICAgKi9cbiAgICBwb3N0TWVzc2FnZShyZWdpc3RyYXRpb24sIG1lc3NhZ2UpIHtcbiAgICAgICAgaWYgKHJlZ2lzdHJhdGlvbj8uYWN0aXZlKSB7XG4gICAgICAgICAgICByZWdpc3RyYXRpb24uYWN0aXZlLnBvc3RNZXNzYWdlKG1lc3NhZ2UpO1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH0sXG4gICAgXG4gICAgLyoqXG4gICAgICogUG9zdHMgYSBtZXNzYWdlIHRvIHNlcnZpY2Ugd29ya2VyIHdpdGggcmVzcG9uc2VcbiAgICAgKi9cbiAgICBwb3N0TWVzc2FnZVdpdGhSZXNwb25zZShyZWdpc3RyYXRpb24sIG1lc3NhZ2UsIHRpbWVvdXQgPSA1MDAwKSB7XG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgICAgICBpZiAoIXJlZ2lzdHJhdGlvbj8uYWN0aXZlKSB7XG4gICAgICAgICAgICAgICAgcmVqZWN0KG5ldyBFcnJvcignTm8gYWN0aXZlIHNlcnZpY2Ugd29ya2VyJykpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIFxuICAgICAgICAgICAgY29uc3QgbWVzc2FnZUNoYW5uZWwgPSBuZXcgTWVzc2FnZUNoYW5uZWwoKTtcbiAgICAgICAgICAgIGNvbnN0IHRpbWVvdXRJZCA9IHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgICAgIHJlamVjdChuZXcgRXJyb3IoJ1NlcnZpY2UgV29ya2VyIHJlc3BvbnNlIHRpbWVvdXQnKSk7XG4gICAgICAgICAgICB9LCB0aW1lb3V0KTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgbWVzc2FnZUNoYW5uZWwucG9ydDEub25tZXNzYWdlID0gKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRpbWVvdXRJZCk7XG4gICAgICAgICAgICAgICAgcmVzb2x2ZShldmVudC5kYXRhKTtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgcmVnaXN0cmF0aW9uLmFjdGl2ZS5wb3N0TWVzc2FnZShtZXNzYWdlLCBbbWVzc2FnZUNoYW5uZWwucG9ydDJdKTtcbiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRpbWVvdXRJZCk7XG4gICAgICAgICAgICAgICAgcmVqZWN0KGVycm9yKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfSxcbiAgICBcbiAgICAvKipcbiAgICAgKiBHZXRzIGFsbCBzZXJ2aWNlIHdvcmtlciByZWdpc3RyYXRpb25zXG4gICAgICovXG4gICAgYXN5bmMgZ2V0QWxsUmVnaXN0cmF0aW9ucygpIHtcbiAgICAgICAgaWYgKCEoJ3NlcnZpY2VXb3JrZXInIGluIG5hdmlnYXRvcikpIHJldHVybiBbXTtcbiAgICAgICAgXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICByZXR1cm4gYXdhaXQgbmF2aWdhdG9yLnNlcnZpY2VXb3JrZXIuZ2V0UmVnaXN0cmF0aW9ucygpO1xuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgICB9XG4gICAgfSxcbiAgICBcbiAgICAvKipcbiAgICAgKiBDaGVja3MgaWYgc2VydmljZSB3b3JrZXIgaXMgc3VwcG9ydGVkXG4gICAgICovXG4gICAgaXNTdXBwb3J0ZWQoKSB7XG4gICAgICAgIHJldHVybiAnc2VydmljZVdvcmtlcicgaW4gbmF2aWdhdG9yO1xuICAgIH0sXG4gICAgXG4gICAgLyoqXG4gICAgICogR2V0cyBzZXJ2aWNlIHdvcmtlciBjYXBhYmlsaXRpZXNcbiAgICAgKi9cbiAgICBnZXRDYXBhYmlsaXRpZXMoKSB7XG4gICAgICAgIC8vIERlZmVuc2l2ZSBjaGVja3MgZm9yIHRlc3QgZW52aXJvbm1lbnRzIHdoZXJlIFNlcnZpY2VXb3JrZXJSZWdpc3RyYXRpb24gbWF5IGJlIHVuZGVmaW5lZFxuICAgICAgICBjb25zdCBzd1JlZ2lzdHJhdGlvblByb3RvID0gKHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnICYmIHdpbmRvdy5TZXJ2aWNlV29ya2VyUmVnaXN0cmF0aW9uICYmIHdpbmRvdy5TZXJ2aWNlV29ya2VyUmVnaXN0cmF0aW9uLnByb3RvdHlwZSkgPyB3aW5kb3cuU2VydmljZVdvcmtlclJlZ2lzdHJhdGlvbi5wcm90b3R5cGUgOiBudWxsO1xuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBzZXJ2aWNlV29ya2VyOiAnc2VydmljZVdvcmtlcicgaW4gbmF2aWdhdG9yLFxuICAgICAgICAgICAgcHVzaE1hbmFnZXI6ICdQdXNoTWFuYWdlcicgaW4gd2luZG93LFxuICAgICAgICAgICAgbm90aWZpY2F0aW9uOiAnTm90aWZpY2F0aW9uJyBpbiB3aW5kb3csXG4gICAgICAgICAgICBiYWNrZ3JvdW5kU3luYzogJ3NlcnZpY2VXb3JrZXInIGluIG5hdmlnYXRvciAmJiBzd1JlZ2lzdHJhdGlvblByb3RvID8gKCdzeW5jJyBpbiBzd1JlZ2lzdHJhdGlvblByb3RvKSA6IGZhbHNlLFxuICAgICAgICAgICAgYmFja2dyb3VuZEZldGNoOiAnc2VydmljZVdvcmtlcicgaW4gbmF2aWdhdG9yICYmICdCYWNrZ3JvdW5kRmV0Y2gnIGluIHdpbmRvdyxcbiAgICAgICAgICAgIHBlcmlvZGljQmFja2dyb3VuZFN5bmM6ICdzZXJ2aWNlV29ya2VyJyBpbiBuYXZpZ2F0b3IgJiYgc3dSZWdpc3RyYXRpb25Qcm90byA/ICgncGVyaW9kaWNTeW5jJyBpbiBzd1JlZ2lzdHJhdGlvblByb3RvKSA6IGZhbHNlXG4gICAgICAgIH07XG4gICAgfSxcbiAgICBcbiAgICAvKipcbiAgICAgKiBIYW5kbGVzIHNlcnZpY2Ugd29ya2VyIGVycm9yc1xuICAgICAqL1xuICAgIGhhbmRsZUVycm9yKGVycm9yLCBjb250ZXh0ID0gJ3Vua25vd24nKSB7XG4gICAgICAgIGNvbnN0IGVycm9yTWVzc2FnZSA9IGBTZXJ2aWNlIFdvcmtlciBlcnJvciBpbiAke2NvbnRleHR9OiAke2Vycm9yLm1lc3NhZ2V9YDtcbiAgICAgICAgXG4gICAgICAgIGlmICh3aW5kb3cuRGV2TG9nZ2VyPy5lcnJvcikge1xuICAgICAgICAgICAgd2luZG93LkRldkxvZ2dlci5lcnJvcignW1BXQV0nLCBlcnJvck1lc3NhZ2UsIGVycm9yKTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgLy8gQ291bGQgZGlzcGF0Y2ggY3VzdG9tIGV2ZW50IGZvciBlcnJvciBoYW5kbGluZ1xuICAgICAgICB3aW5kb3cuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoJ3N3LWVycm9yJywge1xuICAgICAgICAgICAgZGV0YWlsOiB7IGVycm9yLCBjb250ZXh0LCBtZXNzYWdlOiBlcnJvck1lc3NhZ2UgfVxuICAgICAgICB9KSk7XG4gICAgICAgIFxuICAgICAgICByZXR1cm4gZXJyb3JNZXNzYWdlO1xuICAgIH0sXG4gICAgXG4gICAgLyoqXG4gICAgICogVmFsaWRhdGVzIHNlcnZpY2Ugd29ya2VyIHNjcmlwdFxuICAgICAqL1xuICAgIGFzeW5jIHZhbGlkYXRlU2NyaXB0KHN3UGF0aCkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChzd1BhdGgsIHsgY2FjaGU6ICduby1jYWNoZScgfSk7XG4gICAgICAgICAgICByZXR1cm4gcmVzcG9uc2Uub2s7XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICB9LFxuICAgIFxuICAgIC8qKlxuICAgICAqIEdldHMgc2VydmljZSB3b3JrZXIgcGVyZm9ybWFuY2UgbWV0cmljc1xuICAgICAqL1xuICAgIGdldFBlcmZvcm1hbmNlTWV0cmljcyhyZWdpc3RyYXRpb24pIHtcbiAgICAgICAgaWYgKCFyZWdpc3RyYXRpb24pIHJldHVybiBudWxsO1xuICAgICAgICBcbiAgICAgICAgY29uc3QgbWV0cmljcyA9IHtcbiAgICAgICAgICAgIHJlZ2lzdHJhdGlvblRpbWU6IHJlZ2lzdHJhdGlvbi5pbnN0YWxsaW5nPy5zY3JpcHRVUkwgPyBEYXRlLm5vdygpIDogbnVsbCxcbiAgICAgICAgICAgIHNjb3BlOiByZWdpc3RyYXRpb24uc2NvcGUsXG4gICAgICAgICAgICB1cGRhdGVWaWFDYWNoZTogcmVnaXN0cmF0aW9uLnVwZGF0ZVZpYUNhY2hlXG4gICAgICAgIH07XG4gICAgICAgIFxuICAgICAgICAvLyBBZGQgbmF2aWdhdGlvbiBBUEkgdGltaW5nIGlmIGF2YWlsYWJsZVxuICAgICAgICBpZiAod2luZG93LnBlcmZvcm1hbmNlPy5nZXRFbnRyaWVzQnlUeXBlKSB7XG4gICAgICAgICAgICBjb25zdCBuYXZpZ2F0aW9uRW50cmllcyA9IHdpbmRvdy5wZXJmb3JtYW5jZS5nZXRFbnRyaWVzQnlUeXBlKCduYXZpZ2F0aW9uJyk7XG4gICAgICAgICAgICBpZiAobmF2aWdhdGlvbkVudHJpZXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgIGNvbnN0IGVudHJ5ID0gbmF2aWdhdGlvbkVudHJpZXNbMF07XG4gICAgICAgICAgICAgICAgbWV0cmljcy5wYWdlTG9hZFRpbWUgPSBlbnRyeS5sb2FkRXZlbnRFbmQgLSBlbnRyeS5sb2FkRXZlbnRTdGFydDtcbiAgICAgICAgICAgICAgICBtZXRyaWNzLmRvbUNvbnRlbnRMb2FkZWRUaW1lID0gZW50cnkuZG9tQ29udGVudExvYWRlZEV2ZW50RW5kIC0gZW50cnkuZG9tQ29udGVudExvYWRlZEV2ZW50U3RhcnQ7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIHJldHVybiBtZXRyaWNzO1xuICAgIH1cbn07XG5cbi8vIEV4cG9ydCBmb3IgdXNlIGluIG90aGVyIG1vZHVsZXNcbmlmICh0eXBlb2YgbW9kdWxlICE9PSAndW5kZWZpbmVkJyAmJiBtb2R1bGUuZXhwb3J0cykge1xuICAgIG1vZHVsZS5leHBvcnRzID0geyBwd2FTZXJ2aWNlV29ya2VyIH07XG59IGVsc2UgaWYgKHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgd2luZG93LnB3YVNlcnZpY2VXb3JrZXIgPSBwd2FTZXJ2aWNlV29ya2VyO1xufVxuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLE1BQU1BLGdCQUFnQixHQUFHO0VBQ3JCO0FBQ0o7QUFDQTtFQUNJLE1BQU1D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