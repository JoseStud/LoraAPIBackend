{% extends "base.html" %}

{% block title %}Import/Export{% endblock %}

{% block content %}
<div class="import-export-container" x-data="importExport()" x-init="init()">
    
    <!-- Page Header -->
    <div class="page-header">
        <div class="flex justify-between items-center">
            <div>
                <h1 class="page-title">Import/Export</h1>
                <p class="page-subtitle">Manage data migration, backups, and bulk operations</p>
            </div>
            <div class="header-actions">
                <div class="flex items-center space-x-3">
                    <!-- Quick Actions -->
                    <button @click="quickExportAll()" class="btn btn-primary btn-sm">
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-4-4m4 4l4-4m6-2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        Quick Export All
                    </button>
                    
                    <button @click="viewHistory()" class="btn btn-secondary btn-sm">
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        View History
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content Tabs -->
    <div class="card">
        <div class="card-header">
            <div class="border-b border-gray-200">
                <nav class="-mb-px flex space-x-8">
                    <button @click="activeTab = 'export'" 
                            :class="activeTab === 'export' ? 'tab-button active' : 'tab-button'">
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-4-4m4 4l4-4m6-2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        Export Data
                    </button>
                    
                    <button @click="activeTab = 'import'" 
                            :class="activeTab === 'import' ? 'tab-button active' : 'tab-button'">
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10"></path>
                        </svg>
                        Import Data
                    </button>
                    
                    <button @click="activeTab = 'backup'" 
                            :class="activeTab === 'backup' ? 'tab-button active' : 'tab-button'">
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3-3m0 0l-3 3m3-3v12"></path>
                        </svg>
                        Backup/Restore
                    </button>
                    
                    <button @click="activeTab = 'migration'" 
                            :class="activeTab === 'migration' ? 'tab-button active' : 'tab-button'">
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 9l4-4 4 4m0 6l-4 4-4-4"></path>
                        </svg>
                        Data Migration
                    </button>
                </nav>
            </div>
        </div>
        
        <div class="card-body">
            
            <!-- Export Tab -->
            <div x-show="activeTab === 'export'" class="space-y-6">
                
                <!-- Export Selection -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    
                    <!-- Data Types to Export -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="text-lg font-semibold">Select Data to Export</h3>
                        </div>
                        <div class="card-body space-y-4">
                            
                            <!-- LoRA Data -->
                            <div>
                                <label class="flex items-center">
                                    <input type="checkbox" 
                                           x-model="exportConfig.loras" 
                                           class="form-checkbox mr-3">
                                    <div>
                                        <div class="font-medium">LoRA Models</div>
                                        <div class="text-sm text-gray-600">All LoRA files, metadata, and configurations</div>
                                    </div>
                                </label>
                                
                                <div x-show="exportConfig.loras" 
                                     x-transition
                                     class="ml-6 mt-3 space-y-2">
                                    <label class="flex items-center">
                                        <input type="checkbox" 
                                               x-model="exportConfig.lora_files" 
                                               class="form-checkbox mr-2">
                                        <span class="text-sm">Include model files</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" 
                                               x-model="exportConfig.lora_metadata" 
                                               class="form-checkbox mr-2">
                                        <span class="text-sm">Include metadata only</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" 
                                               x-model="exportConfig.lora_embeddings" 
                                               class="form-checkbox mr-2">
                                        <span class="text-sm">Include embeddings</span>
                                    </label>
                                </div>
                            </div>
                            
                            <!-- Generation Results -->
                            <div>
                                <label class="flex items-center">
                                    <input type="checkbox" 
                                           x-model="exportConfig.generations" 
                                           class="form-checkbox mr-3">
                                    <div>
                                        <div class="font-medium">Generation Results</div>
                                        <div class="text-sm text-gray-600">Generated images and their parameters</div>
                                    </div>
                                </label>
                                
                                <div x-show="exportConfig.generations" 
                                     x-transition
                                     class="ml-6 mt-3 space-y-2">
                                    <div class="flex items-center space-x-4">
                                        <label class="flex items-center">
                                            <input type="radio" 
                                                   name="generation_range" 
                                                   value="all" 
                                                   x-model="exportConfig.generation_range" 
                                                   class="form-radio mr-2">
                                            <span class="text-sm">All generations</span>
                                        </label>
                                        <label class="flex items-center">
                                            <input type="radio" 
                                                   name="generation_range" 
                                                   value="date_range" 
                                                   x-model="exportConfig.generation_range" 
                                                   class="form-radio mr-2">
                                            <span class="text-sm">Date range</span>
                                        </label>
                                    </div>
                                    
                                    <div x-show="exportConfig.generation_range === 'date_range'" 
                                         x-transition
                                         class="grid grid-cols-2 gap-3">
                                        <div>
                                            <label class="form-label text-xs">From Date</label>
                                            <input type="date" 
                                                   x-model="exportConfig.date_from" 
                                                   class="form-input text-sm">
                                        </div>
                                        <div>
                                            <label class="form-label text-xs">To Date</label>
                                            <input type="date" 
                                                   x-model="exportConfig.date_to" 
                                                   class="form-input text-sm">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- User Data -->
                            <div>
                                <label class="flex items-center">
                                    <input type="checkbox" 
                                           x-model="exportConfig.user_data" 
                                           class="form-checkbox mr-3">
                                    <div>
                                        <div class="font-medium">User Data</div>
                                        <div class="text-sm text-gray-600">User preferences and settings</div>
                                    </div>
                                </label>
                            </div>
                            
                            <!-- System Configuration -->
                            <div>
                                <label class="flex items-center">
                                    <input type="checkbox" 
                                           x-model="exportConfig.system_config" 
                                           class="form-checkbox mr-3">
                                    <div>
                                        <div class="font-medium">System Configuration</div>
                                        <div class="text-sm text-gray-600">System settings and configurations</div>
                                    </div>
                                </label>
                            </div>
                            
                            <!-- Analytics Data -->
                            <div>
                                <label class="flex items-center">
                                    <input type="checkbox" 
                                           x-model="exportConfig.analytics" 
                                           class="form-checkbox mr-3">
                                    <div>
                                        <div class="font-medium">Analytics Data</div>
                                        <div class="text-sm text-gray-600">Performance metrics and usage statistics</div>
                                    </div>
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Export Options -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="text-lg font-semibold">Export Options</h3>
                        </div>
                        <div class="card-body space-y-4">
                            
                            <!-- Format Selection -->
                            <div>
                                <label class="form-label">Export Format</label>
                                <select x-model="exportConfig.format" class="form-input">
                                    <option value="zip">ZIP Archive</option>
                                    <option value="tar.gz">TAR.GZ Archive</option>
                                    <option value="folder">Folder Structure</option>
                                </select>
                            </div>
                            
                            <!-- Compression Level -->
                            <div>
                                <label class="form-label">Compression Level</label>
                                <select x-model="exportConfig.compression" class="form-input">
                                    <option value="none">No Compression</option>
                                    <option value="fast">Fast Compression</option>
                                    <option value="balanced">Balanced</option>
                                    <option value="maximum">Maximum Compression</option>
                                </select>
                            </div>
                            
                            <!-- Split Archives -->
                            <div>
                                <label class="flex items-center">
                                    <input type="checkbox" 
                                           x-model="exportConfig.split_archives" 
                                           class="form-checkbox mr-2">
                                    <span>Split large archives</span>
                                </label>
                                <div x-show="exportConfig.split_archives" 
                                     x-transition
                                     class="mt-2">
                                    <label class="form-label text-sm">Max size per archive (MB)</label>
                                    <input type="number" 
                                           x-model="exportConfig.max_size_mb" 
                                           min="100" 
                                           max="4096" 
                                           class="form-input text-sm">
                                </div>
                            </div>
                            
                            <!-- Encryption -->
                            <div>
                                <label class="flex items-center">
                                    <input type="checkbox" 
                                           x-model="exportConfig.encrypt" 
                                           class="form-checkbox mr-2">
                                    <span>Encrypt export</span>
                                </label>
                                <div x-show="exportConfig.encrypt" 
                                     x-transition
                                     class="mt-2">
                                    <label class="form-label text-sm">Password</label>
                                    <input type="password" 
                                           x-model="exportConfig.password" 
                                           class="form-input text-sm">
                                </div>
                            </div>
                            
                            <!-- Estimated Size -->
                            <div class="p-3 bg-gray-50 rounded">
                                <div class="text-sm font-medium">Estimated Export Size</div>
                                <div class="text-lg font-bold text-blue-600" x-text="estimatedSize"></div>
                                <div class="text-xs text-gray-600">
                                    Processing time: ~<span x-text="estimatedTime"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Export Actions -->
                <div class="flex justify-between items-center pt-6 border-t">
                    <div class="flex items-center space-x-4">
                        <button @click="validateExport()" class="btn btn-secondary">
                            Validate Selection
                        </button>
                        <button @click="previewExport()" class="btn btn-secondary">
                            Preview Contents
                        </button>
                    </div>
                    <button @click="startExport()" 
                            class="btn btn-primary"
                            :disabled="!canExport() || isExporting">
                        <template x-if="!isExporting">
                            <span>Start Export</span>
                        </template>
                        <template x-if="isExporting">
                            <div class="flex items-center">
                                <svg class="animate-spin w-4 h-4 mr-2" fill="none" viewBox="0 0 24 24">
                                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                    <path class="opacity-75" fill="currentColor" d="m 12 2 a 10,10 0 0,1 10,10 h -4 a 6,6 0 0,0 -6,-6 z"></path>
                                </svg>
                                Exporting...
                            </div>
                        </template>
                    </button>
                </div>
            </div>
            
            <!-- Import Tab -->
            <div x-show="activeTab === 'import'" class="space-y-6">
                
                <!-- Import Options -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    
                    <!-- File Upload -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="text-lg font-semibold">Select Import Source</h3>
                        </div>
                        <div class="card-body">
                            
                            <!-- File Upload Area -->
                            <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-gray-400 transition-colors"
                                 @drop.prevent="handleFileDrop($event)"
                                 @dragover.prevent
                                 @dragenter.prevent>
                                <svg class="mx-auto h-12 w-12 text-gray-400" stroke="currentColor" fill="none" viewBox="0 0 48 48">
                                    <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
                                </svg>
                                <div class="mt-4">
                                    <label class="cursor-pointer">
                                        <span class="mt-2 block text-sm font-medium text-gray-900">
                                            Drop files here or click to upload
                                        </span>
                                        <input type="file" 
                                               @change="handleFileSelect($event)" 
                                               multiple 
                                               accept=".zip,.tar.gz,.json,.csv"
                                               class="hidden">
                                    </label>
                                    <p class="mt-2 text-xs text-gray-500">
                                        Supports ZIP, TAR.GZ, JSON, CSV files
                                    </p>
                                </div>
                            </div>
                            
                            <!-- Selected Files -->
                            <div x-show="importFiles.length > 0" x-transition class="mt-4">
                                <h4 class="text-sm font-medium mb-2">Selected Files</h4>
                                <div class="space-y-2">
                                    <template x-for="file in importFiles" :key="file.name">
                                        <div class="flex items-center justify-between p-2 bg-gray-50 rounded">
                                            <div class="flex items-center space-x-2">
                                                <svg class="w-4 h-4 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                                </svg>
                                                <span class="text-sm" x-text="file.name"></span>
                                            </div>
                                            <div class="flex items-center space-x-2">
                                                <span class="text-xs text-gray-500" x-text="formatFileSize(file.size)"></span>
                                                <button @click="removeFile(file)" class="text-red-500 hover:text-red-700">
                                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                                    </svg>
                                                </button>
                                            </div>
                                        </div>
                                    </template>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Import Settings -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="text-lg font-semibold">Import Settings</h3>
                        </div>
                        <div class="card-body space-y-4">
                            
                            <!-- Import Mode -->
                            <div>
                                <label class="form-label">Import Mode</label>
                                <select x-model="importConfig.mode" class="form-input">
                                    <option value="merge">Merge with existing data</option>
                                    <option value="replace">Replace existing data</option>
                                    <option value="skip">Skip conflicting items</option>
                                </select>
                            </div>
                            
                            <!-- Conflict Resolution -->
                            <div>
                                <label class="form-label">Conflict Resolution</label>
                                <select x-model="importConfig.conflict_resolution" class="form-input">
                                    <option value="ask">Ask for each conflict</option>
                                    <option value="keep_existing">Keep existing</option>
                                    <option value="overwrite">Overwrite with imported</option>
                                    <option value="rename">Rename imported items</option>
                                </select>
                            </div>
                            
                            <!-- Validation -->
                            <div>
                                <label class="flex items-center">
                                    <input type="checkbox" 
                                           x-model="importConfig.validate" 
                                           class="form-checkbox mr-2">
                                    <span>Validate data before import</span>
                                </label>
                            </div>
                            
                            <!-- Backup Before Import -->
                            <div>
                                <label class="flex items-center">
                                    <input type="checkbox" 
                                           x-model="importConfig.backup_before" 
                                           class="form-checkbox mr-2">
                                    <span>Create backup before import</span>
                                </label>
                            </div>
                            
                            <!-- Encryption -->
                            <div x-show="hasEncryptedFiles" x-transition>
                                <label class="form-label">Archive Password</label>
                                <input type="password" 
                                       x-model="importConfig.password" 
                                       placeholder="Enter password for encrypted archives"
                                       class="form-input">
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Import Preview -->
                <div x-show="importPreview.length > 0" x-transition class="card">
                    <div class="card-header">
                        <h3 class="text-lg font-semibold">Import Preview</h3>
                        <p class="text-sm text-gray-600">Review what will be imported</p>
                    </div>
                    <div class="card-body">
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Type</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Name</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Action</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200">
                                    <template x-for="item in importPreview" :key="item.id">
                                        <tr>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900" x-text="item.type"></td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900" x-text="item.name"></td>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full"
                                                      :class="item.status === 'new' ? 'bg-green-100 text-green-800' : 
                                                              item.status === 'conflict' ? 'bg-yellow-100 text-yellow-800' : 
                                                              'bg-blue-100 text-blue-800'"
                                                      x-text="item.status">
                                                </span>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900" x-text="item.action"></td>
                                        </tr>
                                    </template>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <!-- Import Actions -->
                <div class="flex justify-between items-center pt-6 border-t">
                    <div class="flex items-center space-x-4">
                        <button @click="analyzeFiles()" 
                                class="btn btn-secondary"
                                :disabled="importFiles.length === 0">
                            Analyze Files
                        </button>
                        <button @click="validateImport()" 
                                class="btn btn-secondary"
                                :disabled="importFiles.length === 0">
                            Validate Import
                        </button>
                    </div>
                    <button @click="startImport()" 
                            class="btn btn-primary"
                            :disabled="importFiles.length === 0 || isImporting">
                        <template x-if="!isImporting">
                            <span>Start Import</span>
                        </template>
                        <template x-if="isImporting">
                            <div class="flex items-center">
                                <svg class="animate-spin w-4 h-4 mr-2" fill="none" viewBox="0 0 24 24">
                                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                    <path class="opacity-75" fill="currentColor" d="m 12 2 a 10,10 0 0,1 10,10 h -4 a 6,6 0 0,0 -6,-6 z"></path>
                                </svg>
                                Importing...
                            </div>
                        </template>
                    </button>
                </div>
            </div>
            
            <!-- Backup/Restore Tab -->
            <div x-show="activeTab === 'backup'" class="space-y-6">
                
                <!-- Quick Backup Actions -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <button @click="createFullBackup()" class="card card-interactive text-center p-6">
                        <svg class="w-12 h-12 mx-auto mb-4 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3-3m0 0l-3 3m3-3v12"></path>
                        </svg>
                        <h3 class="text-lg font-semibold mb-2">Full System Backup</h3>
                        <p class="text-sm text-gray-600">Complete backup of all data and settings</p>
                    </button>
                    
                    <button @click="createQuickBackup()" class="card card-interactive text-center p-6">
                        <svg class="w-12 h-12 mx-auto mb-4 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                        </svg>
                        <h3 class="text-lg font-semibold mb-2">Quick Backup</h3>
                        <p class="text-sm text-gray-600">Essential data only for fast backup</p>
                    </button>
                    
                    <button @click="scheduleBackup()" class="card card-interactive text-center p-6">
                        <svg class="w-12 h-12 mx-auto mb-4 text-purple-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                        </svg>
                        <h3 class="text-lg font-semibold mb-2">Schedule Backup</h3>
                        <p class="text-sm text-gray-600">Automatic recurring backups</p>
                    </button>
                </div>
                
                <!-- Backup History -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="text-lg font-semibold">Backup History</h3>
                        <p class="text-sm text-gray-600">Manage existing backups</p>
                    </div>
                    <div class="card-body">
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Type</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Size</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200">
                                    <template x-for="backup in backupHistory" :key="backup.id">
                                        <tr>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900" x-text="formatDate(backup.created_at)"></td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900" x-text="backup.type"></td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900" x-text="formatFileSize(backup.size)"></td>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full"
                                                      :class="backup.status === 'completed' ? 'bg-green-100 text-green-800' : 
                                                              backup.status === 'failed' ? 'bg-red-100 text-red-800' : 
                                                              'bg-yellow-100 text-yellow-800'"
                                                      x-text="backup.status">
                                                </span>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                                <div class="flex space-x-2">
                                                    <button @click="downloadBackup(backup.id)" class="text-blue-600 hover:text-blue-900">
                                                        Download
                                                    </button>
                                                    <button @click="restoreBackup(backup.id)" class="text-green-600 hover:text-green-900">
                                                        Restore
                                                    </button>
                                                    <button @click="deleteBackup(backup.id)" class="text-red-600 hover:text-red-900">
                                                        Delete
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                    </template>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Migration Tab -->
            <div x-show="activeTab === 'migration'" class="space-y-6">
                
                <!-- Migration Wizards -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    
                    <!-- Version Migration -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="text-lg font-semibold">Version Migration</h3>
                            <p class="text-sm text-gray-600">Migrate data between software versions</p>
                        </div>
                        <div class="card-body space-y-4">
                            <div>
                                <label class="form-label">From Version</label>
                                <select x-model="migrationConfig.from_version" class="form-input">
                                    <option value="1.0">Version 1.0</option>
                                    <option value="1.1">Version 1.1</option>
                                    <option value="2.0">Version 2.0</option>
                                </select>
                            </div>
                            <div>
                                <label class="form-label">To Version</label>
                                <select x-model="migrationConfig.to_version" class="form-input">
                                    <option value="2.1">Version 2.1 (Current)</option>
                                    <option value="3.0">Version 3.0 (Beta)</option>
                                </select>
                            </div>
                            <button @click="startVersionMigration()" class="btn btn-primary w-full">
                                Start Version Migration
                            </button>
                        </div>
                    </div>
                    
                    <!-- Platform Migration -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="text-lg font-semibold">Platform Migration</h3>
                            <p class="text-sm text-gray-600">Migrate from other LoRA management systems</p>
                        </div>
                        <div class="card-body space-y-4">
                            <div>
                                <label class="form-label">Source Platform</label>
                                <select x-model="migrationConfig.source_platform" class="form-input">
                                    <option value="automatic1111">Automatic1111</option>
                                    <option value="invokeai">InvokeAI</option>
                                    <option value="comfyui">ComfyUI</option>
                                    <option value="fooocus">Fooocus</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                            <div>
                                <label class="form-label">Data Location</label>
                                <input type="text" 
                                       x-model="migrationConfig.source_path" 
                                       placeholder="/path/to/source/data"
                                       class="form-input">
                            </div>
                            <button @click="startPlatformMigration()" class="btn btn-primary w-full">
                                Start Platform Migration
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Migration Progress -->
                <div x-show="migrationProgress.active" x-transition class="card">
                    <div class="card-header">
                        <h3 class="text-lg font-semibold">Migration Progress</h3>
                    </div>
                    <div class="card-body">
                        <div class="space-y-4">
                            <div>
                                <div class="flex justify-between text-sm mb-1">
                                    <span x-text="migrationProgress.current_step"></span>
                                    <span x-text="`${migrationProgress.completed} / ${migrationProgress.total}`"></span>
                                </div>
                                <div class="w-full bg-gray-200 rounded-full h-2">
                                    <div class="bg-blue-600 h-2 rounded-full transition-all duration-500"
                                         :style="`width: ${(migrationProgress.completed / migrationProgress.total) * 100}%`"></div>
                                </div>
                            </div>
                            
                            <div class="text-sm space-y-1">
                                <template x-for="log in migrationProgress.logs.slice(-5)" :key="log.id">
                                    <div class="flex items-center space-x-2">
                                        <span class="text-xs text-gray-500" x-text="log.timestamp"></span>
                                        <span x-text="log.message"></span>
                                    </div>
                                </template>
                            </div>
                            
                            <div class="flex space-x-3">
                                <button @click="pauseMigration()" 
                                        class="btn btn-secondary"
                                        :disabled="migrationProgress.status === 'paused'">
                                    Pause
                                </button>
                                <button @click="cancelMigration()" class="btn btn-danger">
                                    Cancel
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Progress Modal -->
    <div x-show="showProgress" 
         x-transition:enter="transition ease-out duration-300"
         x-transition:enter-start="opacity-0"
         x-transition:enter-end="opacity-100"
         x-transition:leave="transition ease-in duration-200"
         x-transition:leave-start="opacity-100"
         x-transition:leave-end="opacity-0"
         class="fixed inset-0 z-50 overflow-y-auto"
         style="display: none;">
        <div class="flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
            <div class="fixed inset-0 bg-gray-500 bg-opacity-75"></div>
            
            <div class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full">
                <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                    <h3 class="text-lg leading-6 font-medium text-gray-900 mb-4" x-text="progressTitle"></h3>
                    
                    <div class="space-y-4">
                        <div>
                            <div class="flex justify-between text-sm mb-1">
                                <span x-text="progressStep"></span>
                                <span x-text="`${progressPercent}%`"></span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2">
                                <div class="bg-blue-600 h-2 rounded-full transition-all duration-500"
                                     :style="`width: ${progressPercent}%`"></div>
                            </div>
                        </div>
                        
                        <div class="max-h-40 overflow-y-auto text-xs font-mono bg-gray-100 p-3 rounded">
                            <template x-for="message in progressMessages" :key="message.id">
                                <div x-text="message.text"></div>
                            </template>
                        </div>
                    </div>
                </div>
                <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                    <button @click="cancelOperation()" 
                            type="button" 
                            class="w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 sm:ml-3 sm:w-auto sm:text-sm">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div x-show="showToast" 
         x-transition:enter="transition ease-out duration-300"
         x-transition:enter-start="opacity-0 transform translate-y-2"
         x-transition:enter-end="opacity-100 transform translate-y-0"
         x-transition:leave="transition ease-in duration-200"
         x-transition:leave-start="opacity-100 transform translate-y-0"
         x-transition:leave-end="opacity-0 transform translate-y-2"
         class="fixed top-4 right-4 z-50 px-4 py-2 rounded-lg shadow-lg"
         :class="toastType === 'success' ? 'bg-green-500 text-white' : 
                 toastType === 'error' ? 'bg-red-500 text-white' : 
                 'bg-blue-500 text-white'"
         style="display: none;">
        <span x-text="toastMessage"></span>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', path='/js/components/import-export.js') }}"></script>
{% endblock %}
