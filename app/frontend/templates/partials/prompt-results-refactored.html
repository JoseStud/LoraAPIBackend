<!-- Prompt-based Recommendations Results -->
{% from 'macros/ui_components.html' import progress_bar, status_badge, similarity_score, card, error_message, empty_state, action_button, tag %}

{% if error %}
    {{ error_message(error) }}
{% elif recommendations and recommendations|length > 0 %}
    <div class="prompt-results-container">
        <!-- Results Header -->
        <div class="prompt-results-header">
            <div>
                <h4 class="prompt-results-title">
                    Recommended LoRAs
                    <span class="prompt-results-count">({{ recommendations|length }} found)</span>
                </h4>
                <p class="prompt-results-subtitle">
                    Based on prompt: <span class="prompt-text">{{ original_prompt }}</span>
                </p>
            </div>
            <div class="processing-time">
                Processing time: {{ processing_time_ms|round(1) }}ms
            </div>
        </div>

        <!-- Recommendations Grid -->
        <div class="recommendations-grid">
            {% for rec in recommendations %}
            {% call card(class="recommendation-card") %}
                <!-- LoRA Header -->
                <div class="recommendation-card-header">
                    <div class="flex-1">
                        <h5 class="recommendation-name">{{ rec.name }}</h5>
                        <p class="recommendation-description">
                            {{ rec.description or "No description available" }}
                        </p>
                    </div>
                    <div class="ml-3 flex-shrink-0">
                        {{ status_badge(rec.is_active) }}
                    </div>
                </div>

                <!-- Relevance Score -->
                <div class="relevance-section">
                    <div class="relevance-header">
                        <span class="relevance-label">Prompt Relevance</span>
                        <span class="relevance-score">
                            {{ (rec.relevance_score * 100)|round(1) }}%
                        </span>
                    </div>
                    {{ progress_bar(rec.relevance_score * 100, 100, "bg-gradient-to-r from-green-500 to-green-600", "h-3") }}
                </div>

                <!-- Explanation -->
                {% if rec.explanation %}
                <div class="explanation-box">
                    <h6 class="explanation-title">Why recommended:</h6>
                    <p class="explanation-text">{{ rec.explanation }}</p>
                </div>
                {% endif %}

                <!-- Key Match Reasons -->
                {% if rec.match_reasons and rec.match_reasons|length > 0 %}
                <div class="key-matches-section">
                    <h6 class="key-matches-title">Key Matches:</h6>
                    <div class="key-matches-list">
                        {% for reason in rec.match_reasons[:3] %}
                        <div class="key-match-item">
                            <svg class="key-match-icon" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                            </svg>
                            {{ reason }}
                        </div>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}

                <!-- Similarity Breakdown -->
                {% if rec.semantic_similarity is defined %}
                <div class="similarity-breakdown-section">
                    <h6 class="similarity-breakdown-title">Similarity Breakdown:</h6>
                    <div class="similarity-breakdown-list">
                        {{ similarity_score(rec.semantic_similarity, "Semantic", "bg-blue-500") }}
                        {{ similarity_score(rec.style_similarity, "Style", "bg-purple-500") }}
                        {{ similarity_score(rec.context_similarity, "Context", "bg-orange-500") }}
                    </div>
                </div>
                {% endif %}

                <!-- Suggested Usage -->
                {% if rec.usage_suggestion %}
                <div class="usage-suggestion-box">
                    <h6 class="usage-suggestion-title">Suggested Usage:</h6>
                    <p class="usage-suggestion-text">{{ rec.usage_suggestion }}</p>
                </div>
                {% endif %}

                <!-- Tags -->
                {% if rec.tags and rec.tags|length > 0 %}
                <div class="mb-4">
                    <div class="flex flex-wrap gap-1">
                        {% for tag_name in rec.tags %}
                            {{ tag(tag_name) }}
                        {% endfor %}
                    </div>
                </div>
                {% endif %}

                <!-- Actions -->
                <div class="card-actions">
                    {{ action_button(url_for('lora_details_page', lora_id=rec.id), "View Details", "sm", "secondary") }}
                </div>
            {% endcall %}
            {% endfor %}
        </div>
    </div>
{% else %}
    {{ empty_state(
        "No Recommendations Found", 
        "Could not find any LoRAs matching your prompt. Try being more specific or using different keywords.",
        icon="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"
    ) }}
{% endif %}

<script src="/static/js/common.js"></script>
