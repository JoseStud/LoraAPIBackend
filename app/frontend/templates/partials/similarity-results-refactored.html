<!-- Similarity Recommendations Results -->
{% from 'macros/ui_components.html' import progress_bar, status_badge, similarity_score, card, error_message, empty_state, action_button, tag %}

{% if error %}
    {{ error_message(error) }}
{% elif recommendations and recommendations|length > 0 %}
    <div class="similarity-results-container">
        <!-- Results Header -->
        <div class="similarity-results-header">
            <h4 class="similarity-results-title">
                Similar LoRAs
                <span class="similarity-results-count">({{ recommendations|length }} found)</span>
            </h4>
            <div class="processing-time">
                Processing time: {{ processing_time_ms|round(1) }}ms
            </div>
        </div>

        <!-- Recommendations Grid -->
        <div class="recommendations-grid">
            {% for rec in recommendations %}
            {% call card(class="recommendation-card") %}
                <!-- LoRA Header -->
                <div class="recommendation-card-header">
                    <div class="flex-1">
                        <h5 class="recommendation-name">{{ rec.name }}</h5>
                        <p class="recommendation-description">
                            {{ rec.description or "No description available" }}
                        </p>
                    </div>
                    <div class="ml-3 flex-shrink-0">
                        {{ status_badge(rec.is_active) }}
                    </div>
                </div>

                <!-- Overall Similarity -->
                <div class="relevance-section">
                    <div class="relevance-header">
                        <span class="relevance-label">Overall Similarity</span>
                        <span class="relevance-score text-blue-600">
                            {{ (rec.similarity_score * 100)|round(1) }}%
                        </span>
                    </div>
                    {{ progress_bar(rec.similarity_score * 100, 100, "bg-blue-600") }}
                </div>

                <!-- Component Scores -->
                <div class="similarity-breakdown-section">
                    {{ similarity_score(rec.semantic_similarity, "Semantic", "bg-blue-500") }}
                    {{ similarity_score(rec.artistic_similarity, "Artistic", "bg-purple-500") }}
                    {{ similarity_score(rec.technical_similarity, "Technical", "bg-orange-500") }}
                </div>

                <!-- Explanation -->
                {% if rec.explanation %}
                <div class="explanation-box-subtle">
                    <p class="text-xs text-gray-600">
                        <span class="font-medium">Why similar:</span> {{ rec.explanation }}
                    </p>
                </div>
                {% endif %}

                <!-- Tags -->
                {% if rec.tags and rec.tags|length > 0 %}
                <div class="mb-4">
                    <div class="flex flex-wrap gap-1">
                        {% for tag_name in rec.tags[:3] %}
                            {{ tag(tag_name, 'purple') }}
                        {% endfor %}
                        {% if rec.tags|length > 3 %}
                        <span class="tag tag-sm tag-gray">
                            +{{ rec.tags|length - 3 }}
                        </span>
                        {% endif %}
                    </div>
                </div>
                {% endif %}

                <!-- Actions -->
                <div class="card-actions-bordered">
                    {{ action_button(
                        onclick="viewLoraDetails('" + rec.id + "')",
                        text="View",
                        icon_svg='<svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path></svg>',
                        variant="secondary",
                        size="sm"
                    ) }}
                    
                    {% set toggle_text = "Deactivate" if rec.is_active else "Activate" %}
                    {% set toggle_variant = "warning" if rec.is_active else "success" %}
                    {% set toggle_icon = '<svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>' if rec.is_active else '<svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.828 14.828a4 4 0 01-5.656 0M9 10h1m4 0h1m-6 4h1m4 0h1m6-7a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>' %}
                    
                    {{ action_button(
                        onclick="toggleLoraActive('" + rec.id + "', " + (rec.is_active|lower) + ")",
                        text=toggle_text,
                        icon_svg=toggle_icon,
                        variant=toggle_variant,
                        size="sm"
                    ) }}
                </div>
            {% endcall %}
            {% endfor %}
        </div>
    </div>
{% else %}
    {{ empty_state(
        "No Similar LoRAs Found", 
        "Could not find any LoRAs similar to the selected one.",
        icon="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
    ) }}
{% endif %}

<script src="/static/js/common.js"></script>
